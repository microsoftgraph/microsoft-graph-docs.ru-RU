---
ms.localizationpriority: medium
ms.openlocfilehash: 99402a333e6bef49f372d264452c681193d2339d
ms.sourcegitcommit: f99b4d365ba381f8f1997d3857ab43da03528924
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/13/2022
ms.locfileid: "66768236"
---
<!-- markdownlint-disable MD002 MD041 -->

Следующим шагом является использование Фабрика данных Azure для создания конвейера для извлечения данных из Microsoft 365 в учетную запись хранения Azure с помощью подключения к данным Microsoft Graph.

## <a name="create-an-azure-data-factory-pipeline"></a>Создание конвейера Фабрика данных Azure конвейера

1. Откройте браузер и перейдите на портал [Azure](https://portal.azure.com/).

1. Войдите с помощью учетной **записи с глобальный администратор** правами на доступ к клиентам Azure и Microsoft 365.

1. На боковой панели навигации выберите **"Создать ресурс"**.

1. Найдите **тип ресурса фабрики** данных и используйте следующие значения, чтобы создать его, а затем нажмите кнопку **"Создать"**.

    1. **Подписка**: выберите подписку Azure.
    2. **Группа ресурсов**: GraphDataConnect
    3. **Регион**: выберите регион Azure в том же регионе, что и ваш регион Microsoft 365
    4. **Имя**: dfM365toBlobStorage
    5. **Версия**: V2

        ![Снимок экрана: успешное создание новой Фабрика данных Azure в портал Azure.](../concepts/images/data-connect-adf-create.png)

    6. На **вкладке "Конфигурация Git** " убедитесь, что вы настроите Git или выберите параметр _"Настроить Git" позже_.

1. После создания Фабрика данных Azure выберите плитку **"** Автор" и "Монитор", чтобы запустить Фабрика данных Azure полноэкранный редактор.

    ![Снимок экрана: пользовательский интерфейс портала Azure для службы фабрики данных. Пользователь нажимает кнопку "Автор" и "Монитор".](../concepts/images/data-connect-adf-auth-and-mon.png)

1. Переключитесь с **обзора** на интерфейс **управления** , выбрав его в области навигации слева.

1. По умолчанию Фабрика данных Azure будет использовать среду выполнения интеграции, которая автоматически разрешает регион. Так как Data Connect требует, чтобы источник и назначение, а также среда выполнения интеграции существовали в одном регионе Microsoft 365, рекомендуется создать новую среду выполнения интеграции с фиксированным регионом.

    1. Выберите **"Новые среды выполнения интеграции** > **"**.
    2. Выберите **"Azure", "Self-Hosted" (** Локальная среда) и " **Continue" (Продолжить**).
    3. Выберите **Azure** для сетевой среды и нажмите кнопку **"Продолжить"**.

        ![Снимок экрана: пользовательский интерфейс портала Azure для службы фабрики данных. Пользователь выбирает параметр Azure для сетевой среды.](../concepts/images/data-connect-adf-network.png)

    4. Используйте следующие сведения, чтобы завершить форму на последнем экране, а затем нажмите кнопку **"Создать"**.

        - **Имя**: имя среды выполнения интеграции
        - **Описание**: введите описание
        - **Регион**: выберите регион, соответствующий вашему региону Microsoft 365
        - **Конфигурация виртуальной сети (предварительная версия)**: отключено

1. Переключитесь с **интерфейса "** Управление" на **"Автор** ", выбрав его в области навигации слева.
1. Создайте конвейер, щелкни значок **"плюс** ", а затем **конвейер**.

    ![Снимок экрана: портал Azure пользовательского интерфейса для службы фабрики данных. Пользователь создает конвейер.](../concepts/images/data-connect-adf-pipeline-create.png)

    - **Перетащите действие копирования** данных из раздела **"Перемещение и** преобразование" в область конструктора.

        ![Снимок экрана: портал Azure пользовательского интерфейса для службы фабрики данных. Пользователь перетаскивает действие копирования данных в редактор в правой части экрана.](../concepts/images/data-connect-adf-pipeline-copy-data.png)

    - Выберите действие в конструкторе.
    - Выберите **вкладку "** Общие" и присвойте ему имя и описание.

      - **Имя**: CopyFromM365toBlobStorage
      - **Описание**: необходимое описание.

    - В области редактора действий под конструктором выберите вкладку **"** Источник" и нажмите кнопку **"Создать"**.
    - Найдите набор данных **Office 365**, выберите его и нажмите кнопку "**Продолжить**".

        ![Снимок экрана: портал Azure пользовательского интерфейса для службы фабрики данных. Пользователь выбирает набор данных Office 365 пользовательского интерфейса и затем нажмет кнопку "Продолжить".](../concepts/images/data-connect-adf-pipeline-dataset.png)

    - Конструктор обно сведения обновит вкладку **"** Источник" с помощью параметров соединителя Microsoft 365.
    - Выберите параметр **"Открыть** " рядом с полем **"Исходный набор данных** ".
    - В параметрах таблицы выберите вкладку **"Подключение** " и нажмите **кнопку "Создать** ".
    - В отобразившемся диалоговом окне введите ранее созданные Azure AD  и секретный идентификатор  приложения в полях идентификатора субъекта-службы и ключа субъекта-службы соответственно, а затем нажмите кнопку **"Создать"**. 
    - Выберите среду выполнения интеграции, созданную ранее в раскрывающемся списке **"Подключение через среду выполнения интеграции** ".

        ![Снимок экрана: портал Azure пользовательского интерфейса для службы фабрики данных. Пользователь настраивает среду выполнения интеграции с помощью ключа субъекта-службы.](../concepts/images/data-connect-adf-linked-service.png)

    - После создания подключения Microsoft 365 в поле "Таблица  **" выберите BasicDataSet_v0. Message_v0**.
    - Переключитесь с **Office365Table** на **pipeline > источника**. Используйте следующие значения для фильтра **даты**.

      - **Имя столбца**: CreatedDateTime
      - **Время начала (UTC)**: выберите дату, которая предвеает текущую дату.
      - **Время окончания (UTC)**: выберите текущую дату
      - Выберите **"Импорт схемы** " в разделе _"Выходные столбцы_ ".

    - Выберите действие **копирования данных** на вкладке конвейера, а затем — вкладку **"Приемник** ".

      - Нажмите **кнопку "** Создать"**, Хранилище BLOB-объектов Azure и** нажмите кнопку "**Продолжить**".
      - Выберите **двоичный** файл в качестве формата данных, а затем нажмите кнопку **"Продолжить** ".
      - Присвойте набору данных имя **M365JsonFile** и создайте связанную службу, если она еще не существует.

    - В таблице выберите вкладку **"Подключение** ", а затем нажмите кнопку **"Создать"**.
    - Задайте следующие значения в диалоговом окне, а затем нажмите кнопку **"Готово"**.

        - **Метод проверки подлинности**: субъект-служба
        - **Подписка Azure**: выберите все
        - **Имя учетной записи** хранения: mgdcm365datastore
          - Это учетная запись хранения, созданная ранее в этом упражнении.
        - **Клиент**: введите идентификатор клиента Azure.
        - **Идентификатор субъекта-службы**: введите идентификатор созданного Azure AD приложения.
        - **Ключ субъекта-службы**: введите хэш-ключ созданного ранее Azure AD приложения.

    - Рядом с полем **"Путь к файлу** " нажмите кнопку " **Обзор"**.
    - Выберите имя контейнера хранилища, созданного ранее.

      ![Снимок экрана: портал Azure пользовательского интерфейса для службы фабрики данных. Пользователь настраивает путь к контейнеру и файлу в свойствах приемника.](../concepts/images/data-connect-adf-sa-fp-config.png)

1. После создания конвейера нажмите кнопку **"Проверить все** " в верхней части конструктора.

1. После проверки (и устранения всех найденных проблем) нажмите кнопку **"Опубликовать** все" в верхней части конструктора.

## <a name="run-the-azure-data-factory-pipeline"></a>Запуск конвейера Фабрика данных Azure конвейера

Теперь, когда конвейер создан, его можно запустить.

> [!NOTE]
> Отображение запроса на согласие может занять несколько минут, и в этом случае для всего процесса (запуск, запрос согласия и после утверждения согласия после завершения выполнения конвейера) может потребоваться более 40 минут.

1. В конструкторе Фабрика данных Azure, где открыт конвейер, выберите "Добавить триггер **> trigger now"**.

    ![Снимок экрана: портал Azure пользовательского интерфейса для службы фабрики данных, на котором показано, как активировать триггер в конвейере.](../concepts/images/data-connect-adf-run-trigger.png)

1. После запуска задания в меню боковой панели **выберите "Монитор** ", чтобы просмотреть текущие выполняемые задания.

1. На панели навигации слева найдите вкладку **"Запуски** конвейера" и выберите ее. Выберите конвейер в столбце **имени конвейера** , чтобы просмотреть **запуски действий**. Этот конвейер будет отображаться как _выполняется_.

    ![Снимок экрана: портал Azure пользовательского интерфейса фабрики данных, на котором показан список запусков конвейера.](../concepts/images/data-connect-adf-pipeline-runs.png)

1. В представлении выполнения действий перейдите к разделу _"_ Запуски действий", который находится в нижней части страницы.

1. Наведите **указатель мыши на имя действия** и выберите переключатель. Откроется вкладка **"Сведения** ".

    ![Снимок экрана: пользовательский интерфейс портала Azure для выполнения действий фабрики данных. Пользователь выбирает googles в имени действия, чтобы открыть вкладку сведений.](../concepts/images/data-connect-adf-pipeline-details.png)

1. На экране **сведений** найдите состояние действия конвейера, как показано на следующем рисунке. В этом случае вы увидите, что он находится в состоянии **RequestingConsent**.

    ![Снимок экрана, портал Azure пользовательского интерфейса для службы фабрики данных, где для состояния загрузки запроса задано значение RequestingConsent.](../concepts/images/data-connect-adf-wait-for-approval.png)

1. На этом этапе выполнение действия внутренне приостановлено до тех пор, пока кто-то вручную не утвердит запрос на согласие через Центр администрирования Microsoft 365 или с помощью PowerShell.
