---
title: Советы по использованию подключения к данным Microsoft Graph
description: Советы, помогающие воспользоваться преимуществами подключения к данным Microsoft Graph.
author: tlenig
localization_priority: Priority
ms.prod: data-connect
ms.openlocfilehash: d9a87c629a80bc94c57e77bd0f2c0b1e7438c935
ms.sourcegitcommit: d700b7e3b411e3226b5adf1f213539f05fe802e8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2021
ms.locfileid: "52547606"
---
# <a name="tips-for-using-microsoft-graph-data-connect"></a><span data-ttu-id="b1886-103">Советы по использованию подключения к данным Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="b1886-103">Tips for using Microsoft Graph data connect</span></span>

<span data-ttu-id="b1886-104">Подключение к данным Microsoft Graph позволяет разработчикам создавать приложения, которым пользователи смогут предоставлять управляемый доступ к масштабным наборам данных Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="b1886-104">Microsoft Graph data connect allows developers to create applications that customers can provide managed access to their at-scale Microsoft Graph datasets.</span></span> <span data-ttu-id="b1886-105">Эта статья содержит советы, помогающие воспользоваться преимуществами функции подключения к данным.</span><span class="sxs-lookup"><span data-stu-id="b1886-105">This article provides tips that will help you take advantage of the data connect feature.</span></span> <span data-ttu-id="b1886-106">Для знакомства с подключением к данным Microsoft Graph см. статью [Обзор](data-connect-concept-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b1886-106">For an introduction to Microsoft Graph data connect, see the [Overview](data-connect-concept-overview.md) article.</span></span>

## <a name="is-microsoft-graph-data-connect-right-for-you"></a><span data-ttu-id="b1886-107">Подходит ли вам подключение к данным Microsoft Graph?</span><span class="sxs-lookup"><span data-stu-id="b1886-107">Is Microsoft Graph data connect right for you?</span></span>

<span data-ttu-id="b1886-108">Подключение к данным и API Microsoft Graph обеспечивают доступ к одинаковым базовым данным, но очень разными способами.</span><span class="sxs-lookup"><span data-stu-id="b1886-108">Data connect and the Microsoft Graph APIs provide access to the same underlying data but in very different ways.</span></span> <span data-ttu-id="b1886-109">Подключение к данным предназначено для массового извлечения больших объемов данных, а API Microsoft Graph больше подходит для доступа к отдельным наборам данных в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="b1886-109">Data connect is designed to extract large amounts of data in bulk while the Microsoft Graph APIs are more suitable for accessing discrete sets of data in real time.</span></span> <span data-ttu-id="b1886-110">В некоторых случаях можно даже объединить их.</span><span class="sxs-lookup"><span data-stu-id="b1886-110">In some cases, it might even make sense to combine them.</span></span> <span data-ttu-id="b1886-111">Например, может потребоваться использовать подключение к данным, чтобы выполнить начальное извлечение данных электронной почты за последний год, а затем применить API Microsoft Graph для дальнейшего анализа писем в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="b1886-111">For example, you might want use data connect to do an initial extraction of the last year of email data, and then use the Microsoft Graph APIs to analyze emails in real time moving forward.</span></span> <span data-ttu-id="b1886-112">Подключение к данным и API Microsoft Graph — это разные средства для разных задач.</span><span class="sxs-lookup"><span data-stu-id="b1886-112">Data connect and the Microsoft Graph APIs are different tools for different jobs.</span></span> <span data-ttu-id="b1886-113">Важно продумать, какой метод лучше подходит к вашему сценарию.</span><span class="sxs-lookup"><span data-stu-id="b1886-113">It's important to think about which access method best fits your scenario.</span></span>

## <a name="expect-an-initial-overhead"></a><span data-ttu-id="b1886-114">Ожидайте дополнительные затраты времени на начальном этапе </span><span class="sxs-lookup"><span data-stu-id="b1886-114">Expect an initial overhead</span></span>

<span data-ttu-id="b1886-115">Так как подключение к данным предназначено для массового извлечения больших объемов данных, возникают дополнительные затраты времени перед тем, как можно будет извлечь данные.</span><span class="sxs-lookup"><span data-stu-id="b1886-115">Because data connect is designed to extract large amounts of data in bulk, some overhead is incurred before the data can be extracted.</span></span> <span data-ttu-id="b1886-116">Эти затраты составляют около 45 минут. Это означает, что этот период потребуется для всех конвейеров вне зависимости от размера данных.</span><span class="sxs-lookup"><span data-stu-id="b1886-116">This overhead is around 45 minutes, meaning all pipelines will take at least that long regardless of the data size.</span></span> <span data-ttu-id="b1886-117">Этими затратами можно пренебречь для больших объемов данных, но если такой промежуток времени недопустим в вашем сценарии, API Microsoft Graph может обеспечить более подходящий способ.</span><span class="sxs-lookup"><span data-stu-id="b1886-117">This might be a negligible cost for large amounts of data, but if this time is unacceptable for your scenario, the Microsoft Graph APIs might provide a better approach.</span></span>

## <a name="data-must-stay-within-the-organizations-subscription"></a><span data-ttu-id="b1886-118">Данные должны оставаться в рамках подписки организации</span><span class="sxs-lookup"><span data-stu-id="b1886-118">Data must stay within the organization's subscription</span></span>

<span data-ttu-id="b1886-119">Конвейеры подключения к данным управляются фабрикой данных Azure, являющейся службой интеграции данных, работающей в рамках подписки Azure.</span><span class="sxs-lookup"><span data-stu-id="b1886-119">Data connect pipelines are orchestrated by Azure Data Factory, a data integration service that runs in an Azure subscription.</span></span> <span data-ttu-id="b1886-120">Подписка Azure [связана только с одним клиентом Microsoft 365](/azure/active-directory/fundamentals/active-directory-how-subscriptions-associated-directory).</span><span class="sxs-lookup"><span data-stu-id="b1886-120">The Azure subscription is [associated with exactly one Microsoft 365 tenant](/azure/active-directory/fundamentals/active-directory-how-subscriptions-associated-directory).</span></span> <span data-ttu-id="b1886-121">Таким образом, данные должны сначала направляться в связанную подписку Azure.</span><span class="sxs-lookup"><span data-stu-id="b1886-121">This way, the data must initially flow to an associated Azure subscription.</span></span> <span data-ttu-id="b1886-122">После дальнейшей минимизации и агрегации данные можно использовать в другом месте.</span><span class="sxs-lookup"><span data-stu-id="b1886-122">After further minimalization and aggregation, the data can be used elsewhere.</span></span>

<span data-ttu-id="b1886-123">Если нужно создать приложение для других пользователей, чтобы извлекать данные Microsoft 365, можно упаковать приложение как [управляемое приложение Azure](/azure/managed-applications/overview) и опубликовать его в Azure Marketplace.</span><span class="sxs-lookup"><span data-stu-id="b1886-123">If you want to build an app for others to use to extract their Microsoft 365 data, you can package the app as an [Azure managed application](/azure/managed-applications/overview) and publish it to the Azure Marketplace.</span></span> <span data-ttu-id="b1886-124">Затем другой пользователь сможет развернуть ваше приложение в своей подписке Azure, и приложение получит доступ к данным в клиенте.</span><span class="sxs-lookup"><span data-stu-id="b1886-124">Then someone can deploy your app into their own Azure subscription, and the app can access data in their tenant.</span></span> 

## <a name="use-of-service-principals"></a><span data-ttu-id="b1886-125">Используйте субъекты-службы</span><span class="sxs-lookup"><span data-stu-id="b1886-125">Use of service principals</span></span>

<span data-ttu-id="b1886-126">При создании конвейера фабрики данных необходимо предоставить субъект-службу для связанной службы Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="b1886-126">When creating the Data Factory pipeline, you will have to provide a service principal to the Microsoft 365 linked service.</span></span> <span data-ttu-id="b1886-127">В Azure субъект-служба — это объект безопасности, представляющий приложение или службу (в отличие от пользователя).</span><span class="sxs-lookup"><span data-stu-id="b1886-127">In Azure, a service principal is a security identity that represents an application/service (as opposed to a user).</span></span> <span data-ttu-id="b1886-128">Подключение к данным использует этот субъект-службу в качестве удостоверения при получении авторизованного доступа к вашим данным Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="b1886-128">Data connect uses this service principal as its identity when getting authorized access to your Microsoft 365 data.</span></span>
<span data-ttu-id="b1886-129">Если вы создаете управляемое приложение Azure для других пользователей с целью применения в клиентах, вам также нужно предоставить субъект-службу для использования приложением.</span><span class="sxs-lookup"><span data-stu-id="b1886-129">If you create an Azure Managed Application for others to use in their tenants, you'll still provide a service principal for the app to use.</span></span> <span data-ttu-id="b1886-130">Этот субъект-служба будет существовать в вашем клиенте (издателя).</span><span class="sxs-lookup"><span data-stu-id="b1886-130">This service principal will exist in your (the publisher's) tenant.</span></span> <span data-ttu-id="b1886-131">Но если приложению требуются другие субъекты-службы, пользователю (установщику) нужно будет создать их в собственном клиенте.</span><span class="sxs-lookup"><span data-stu-id="b1886-131">However, if the app needs other service principals, your customer (the installer) will create them in their own tenant.</span></span> <span data-ttu-id="b1886-132">Например, вашему конвейеру фабрики данных, скорее всего, потребуется доступ к ресурсу хранилища в Azure.</span><span class="sxs-lookup"><span data-stu-id="b1886-132">For example, your Data Factory pipeline will likely need access to a storage resource in Azure.</span></span> <span data-ttu-id="b1886-133">Пользователю потребуется создать субъект-службу с разрешениями на доступ к учетной записи хранилища для использования конвейером.</span><span class="sxs-lookup"><span data-stu-id="b1886-133">The customer would create the service principal with permissions to the storage account for the pipeline to use.</span></span>

## <a name="check-for-pending-privileged-access-management-requests"></a><span data-ttu-id="b1886-134">Проверяйте ожидающие запросы управления привилегированным доступом</span><span class="sxs-lookup"><span data-stu-id="b1886-134">Check for pending Privileged Access Management requests</span></span>

<span data-ttu-id="b1886-135">Прежде чем подключение к данным сможет скопировать ваши данные администратор должен утвердить запрос на управление привилегированным доступом (PAM).</span><span class="sxs-lookup"><span data-stu-id="b1886-135">Before data connect can copy your data, an administrator must approve a Privileged Access Management (PAM) request.</span></span> <span data-ttu-id="b1886-136">Управление привилегированным доступом — это механизм, используемый для разрешения доступа вашего конвейера данных к данным в Microsoft 365.</span><span class="sxs-lookup"><span data-stu-id="b1886-136">PAM is the mechanism used to authorize your data pipeline access to the data in Microsoft 365.</span></span> <span data-ttu-id="b1886-137">При первом запуске конвейера ожидается утверждение запроса на доступ администратором Microsoft 365 (или назначенным делегатом).</span><span class="sxs-lookup"><span data-stu-id="b1886-137">The first time you trigger a pipeline, it will wait on a Microsoft 365 administrator (or appointed delegate) to approve the access request.</span></span> <span data-ttu-id="b1886-138">Хотя состояние конвейера отображается как **Выполняется**, базовому действию копирования будет соответствовать состояние **ConsentPending** до получения утверждения, как показано на снимке экрана ниже.</span><span class="sxs-lookup"><span data-stu-id="b1886-138">Although the pipeline status shows **In progress**, the underlying copy activity will have a status of **ConsentPending** until approval is granted, as shown in the following screenshot.</span></span>

![Снимок экрана: область состояния работы конвейера с состоянием ConsentPending](images/data-connect-tips.png)

<span data-ttu-id="b1886-140">При разработке рекомендуется проверять, что канал не застрял в состоянии **ConsentPending**, особенно после внесения изменений в конвейер.</span><span class="sxs-lookup"><span data-stu-id="b1886-140">During development, it's a good idea to make sure your pipeline runs aren't stuck on **ConsentPending**, especially after you make a change to your pipeline.</span></span> <span data-ttu-id="b1886-141">Например, при добавлении дополнительного поля в схему следующий запуск конвейера приведет к созданию запроса PAM, требующего утверждения.</span><span class="sxs-lookup"><span data-stu-id="b1886-141">For example, if you add an additional field to the schema, the next pipeline run will issue a new PAM request that has to be approved.</span></span> <span data-ttu-id="b1886-142">Не теряйте время с конвейером, ожидающим вашего утверждения.</span><span class="sxs-lookup"><span data-stu-id="b1886-142">Don't waste time waiting on a pipeline that's waiting for your approval.</span></span>

## <a name="approve-pam-requests-via-microsoft-365-admin-portal"></a><span data-ttu-id="b1886-143">Утверждайте запросы PAM через портал администрирования Microsoft 365</span><span class="sxs-lookup"><span data-stu-id="b1886-143">Approve PAM requests via Microsoft 365 admin portal</span></span>

<span data-ttu-id="b1886-144">В документации по подключению данных показано, как использовать PowerShell и пользовательский интерфейс PAM, чтобы утверждать запросы PAM.</span><span class="sxs-lookup"><span data-stu-id="b1886-144">The data connect documentation shows you how to use PowerShell and the PAM UX to approve PAM requests.</span></span> <span data-ttu-id="b1886-145">Для утверждения с помощью пользовательского интерфейса PAM откройте пользовательский интерфейс PAM на [портале администрирования Microsoft 365](https://admin.microsoft.com/Adminportal/Home?source=applauncher#/Settings/PrivilegedAccess).</span><span class="sxs-lookup"><span data-stu-id="b1886-145">To approve using the PAM UX, visit the PAM interface in the [Microsoft 365 admin portal](https://admin.microsoft.com/Adminportal/Home?source=applauncher#/Settings/PrivilegedAccess).</span></span> <span data-ttu-id="b1886-146">Портал предоставляет простой и понятный способ просмотра, утверждения, отклонения или отзыва запросов PAM.</span><span class="sxs-lookup"><span data-stu-id="b1886-146">The portal provides an easy and user-friendly way to view and approve/deny/revoke PAM requests.</span></span> <span data-ttu-id="b1886-147">Ссылка на надстройку подключения к данным Microsoft Graph находится в разделе **Параметры** > **Службы и надстройки** > **Подключение к данным Microsoft Graph**.</span><span class="sxs-lookup"><span data-stu-id="b1886-147">You can find a link to it in the Microsoft Graph data connect add-in under **Settings** > **Services & Add-ins** > **Microsoft Graph data connect**.</span></span>

## <a name="use-a-second-user-to-approve-pam-requests"></a><span data-ttu-id="b1886-148">Используйте второго пользователя для утверждения запросов PAM</span><span class="sxs-lookup"><span data-stu-id="b1886-148">Use a second user to approve PAM requests</span></span>

<span data-ttu-id="b1886-149">Если вы запускаете конвейер и запрос PAM, запрос вкладывается в вашу учетную запись, которой принадлежит субъект-служба, используемая конвейером.</span><span class="sxs-lookup"><span data-stu-id="b1886-149">When you run a pipeline and trigger a PAM request, the request is attached to your user account that owns the service principal used by the pipeline.</span></span> <span data-ttu-id="b1886-150">Но даже если эта учетная запись состоит в настроенной вами группе утверждающих, вы не сможете использовать ее для утверждения запроса PAM, так как самостоятельные утверждения не разрешаются.</span><span class="sxs-lookup"><span data-stu-id="b1886-150">But even if this account is part of the approver group you set up, you can't use it to approve the PAM request because self-approvals are not allowed.</span></span> <span data-ttu-id="b1886-151">При попытке появится сообщение об ошибке в портале PAM: "Запрашивающий и утверждающий совпадают.</span><span class="sxs-lookup"><span data-stu-id="b1886-151">If you try, you'll get an error message in the PAM portal: "Requestor and approver are the same.</span></span> <span data-ttu-id="b1886-152">Самостоятельное утверждение запрещено".</span><span class="sxs-lookup"><span data-stu-id="b1886-152">Self-approval is not allowed."</span></span> <span data-ttu-id="b1886-153">При разработке рекомендуется использовать вторую учетную запись помимо администратора, утверждающего запросы.</span><span class="sxs-lookup"><span data-stu-id="b1886-153">For development, you'll want to have a second account in addition to the admin who approves requests.</span></span> <span data-ttu-id="b1886-154">Как отправитель, так и утверждающий должны иметь активные учетные записи Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="b1886-154">Both the submitter and the approver must have active Exchange Online accounts.</span></span>

## <a name="deduplicate-emails-when-needed"></a><span data-ttu-id="b1886-155">При необходимости выполняйте дедупликацию сообщений электронной почты</span><span class="sxs-lookup"><span data-stu-id="b1886-155">Deduplicate emails when needed</span></span>

<span data-ttu-id="b1886-156">При извлечении сообщений электронной почты из набора данных `Message` часто создается несколько объектов JSON одного сообщения.</span><span class="sxs-lookup"><span data-stu-id="b1886-156">When you extract emails from the `Message` dataset, there will often be multiple JSON objects for the same email.</span></span> <span data-ttu-id="b1886-157">Эти дубликаты существуют, так как при отправке сообщения нескольким пользователям создается его копия в почтовом ящике каждого получателя.</span><span class="sxs-lookup"><span data-stu-id="b1886-157">These duplicates exist because when an email is sent to multiple people, there is a copy of the email in every recipient's mailbox.</span></span> <span data-ttu-id="b1886-158">Так как набор данных извлекается из каждого почтового ящика, он будет содержать все копии от разных пользователей.</span><span class="sxs-lookup"><span data-stu-id="b1886-158">Because the dataset is extracted from every mailbox, it will contain all copies across users.</span></span> <span data-ttu-id="b1886-159">В некоторых случаях может требоваться сохранение всех копий, но в остальных случаях рекомендуется удалять дубликаты.</span><span class="sxs-lookup"><span data-stu-id="b1886-159">In some scenarios, it might be necessary to keep every copy but in others, you may want to remove the duplicates.</span></span>
<span data-ttu-id="b1886-160">Выполнить дедупликацию экспортированных объектов JSON можно на основе параметра `internetMessageId` сообщений: два сообщения с одинаковым значением `internetMessageId` являются копиями одного экземпляра.</span><span class="sxs-lookup"><span data-stu-id="b1886-160">You can deduplicate the exported JSON objects based on the `internetMessageId` of the messages: Two messages with the same `internetMessageId` are duplicate copies of the same instance.</span></span> <span data-ttu-id="b1886-161">Так как дубликаты могут существовать в разных BLOB-объектах, дедупликацию необходимо выполнять во всех BLOB-объектах, а не в отдельных BLOB-объектах.</span><span class="sxs-lookup"><span data-stu-id="b1886-161">Because the duplicates can exist in different blobs, you must deduplicate across all blobs rather than deduplicating in each blob separately.</span></span>

## <a name="use-puser-field-to-determine-the-relevant-user"></a><span data-ttu-id="b1886-162">Используйте поле puser, чтобы определить соответствующего пользователя</span><span class="sxs-lookup"><span data-stu-id="b1886-162">Use puser field to determine the relevant user</span></span>

<span data-ttu-id="b1886-163">Извлеченные данные содержат некоторые свойства Meta, не существующие при использовании соответствующего API Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="b1886-163">The extracted data includes some meta properties that don't exist when using the corresponding Microsoft Graph APIs.</span></span> <span data-ttu-id="b1886-164">В частности, поле `puser` может быть полезно для определения пользователя, данные о котором извлечены.</span><span class="sxs-lookup"><span data-stu-id="b1886-164">Specifically, the `puser` field can be useful for determining which user the data was extracted from.</span></span> <span data-ttu-id="b1886-165">В сценарии с двумя копиями одного сообщения электронной почты в разных почтовых ящиках вы можете использовать поле `puser`, чтобы определить, из какого почтового ящика получена каждая копия.</span><span class="sxs-lookup"><span data-stu-id="b1886-165">In the scenario where you have two copies of the same email in different mailboxes, you can use the `puser` field to determine which copy came from which mailbox.</span></span>
<span data-ttu-id="b1886-166">Поле `puser` также удобно применять для наборов данных, например для набора данных `Manager`.</span><span class="sxs-lookup"><span data-stu-id="b1886-166">The `puser` field is also useful for datasets such as the `Manager` dataset.</span></span> <span data-ttu-id="b1886-167">Экспортированные объекты JSON содержат сведения о руководителе, но они полезны, только если вы знаете, кем он руководит.</span><span class="sxs-lookup"><span data-stu-id="b1886-167">The exported JSON will contain information about a manager, but this is only useful if you know whose manager they are.</span></span> <span data-ttu-id="b1886-168">Поле `puser` указывает, чей руководитель соответствует этому объекту JSON.</span><span class="sxs-lookup"><span data-stu-id="b1886-168">The `puser` field will tell you whose manager that JSON object corresponds to.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b1886-169">Дальнейшие действия</span><span class="sxs-lookup"><span data-stu-id="b1886-169">Next Steps</span></span>

<span data-ttu-id="b1886-170">Обратитесь на [форум идей платформы для разработчиков Microsoft 365](https://techcommunity.microsoft.com/t5/microsoft-365-developer-platform/idb-p/Microsoft365DeveloperPlatform/label-name/Microsoft%20Graph), чтобы запросить функции.</span><span class="sxs-lookup"><span data-stu-id="b1886-170">Reach out on the [Microsoft 365 Developer Platform ideas forum](https://techcommunity.microsoft.com/t5/microsoft-365-developer-platform/idb-p/Microsoft365DeveloperPlatform/label-name/Microsoft%20Graph) for feature requests.</span></span>