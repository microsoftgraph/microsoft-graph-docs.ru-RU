---
title: Добавление пользовательских данных в ресурсы с помощью расширений
description: Microsoft Graph предоставляет одну конечную точку API для доступа к наглядным и аналитическим данным о пользователях с помощью ряда ресурсов, например user и message. Теперь существует способ дополнить Microsoft Graph, используя собственные данные приложения. Вы можете добавить специальные свойства в ресурсы Microsoft Graph, и при этом не потребуется внешнее хранилище данных.
author: dkershaw10
localization_priority: Priority
ms.custom: graphiamtop20
ms.openlocfilehash: 411e73a84e3b96cd0053e7f9cbff5f2842e8851c44d29d8826e17b1636c84ed0
ms.sourcegitcommit: 986c33b848fa22a153f28437738953532b78c051
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2021
ms.locfileid: "54146190"
---
# <a name="add-custom-data-to-resources-using-extensions"></a>Добавление пользовательских данных в ресурсы с помощью расширений

Microsoft Graph предоставляет одну конечную точку API для доступа к наглядным и аналитическим данным о пользователях с помощью ряда ресурсов, например [user](/graph/api/resources/user?view=graph-rest-1.0) и [message](/graph/api/resources/message?view=graph-rest-1.0). Теперь существует способ дополнить Microsoft Graph, используя собственные данные приложения. Вы можете добавить специальные свойства в ресурсы Microsoft Graph, и при этом не потребуется внешнее хранилище данных.

Например, можно хранить данные профиля пользователя не в самом приложении, а в Microsoft Graph, дополнив ресурс **user**. Кроме того, вы можете оставить существующее хранилище для профилей пользователей приложения и просто добавить идентификатор хранилища приложения в ресурс **user**.

В Microsoft Graph есть два типа расширений. Выберите тип с учетом особенностей вашего приложения:

- **Открытые расширения**. Отличный способ начать для разработчиков.
- **Расширения схемы**. Более универсальный механизм для разработчиков, которых интересует хранение типизированных данных, возможность совместного доступа к схеме, фильтрации, а также проверки и авторизации входных данных.

> **Важно!** Не используйте расширения для хранения данных учетных записей, государственных идентификационных номеров, данных держателей карт, данных финансовых счетов, медицинских сведений и конфиденциальных биографических данных.

## <a name="supported-resources"></a>Поддерживаемые ресурсы

В приведенной ниже таблице перечислены ресурсы, которые поддерживают открытые расширения и расширения схемы. Кроме того, в ней указано, общедоступны эти расширения (в конечных точках бета-версии и версии 1.0) или предварительно доступны (только в конечной точке бета-версии).

|Ресурс |Открытые расширения |Расширения схемы |
|:------- |:------ |:------ |
| [Административная единица](/graph/api/resources/administrativeunit?view=graph-rest-beta) | Только предварительная версия | Только предварительная версия |
| [Событие календаря](/graph/api/resources/event?view=graph-rest-1.0) | Общедоступная версия | Общедоступная версия |
| [Устройство](/graph/api/resources/device?view=graph-rest-1.0) | Общедоступная версия | Общедоступная версия |
| [Группа](/graph/api/resources/group?view=graph-rest-1.0) | Общедоступная версия | Общедоступная версия |
| [Событие календаря группы](/graph/api/resources/event?view=graph-rest-1.0) | Общедоступная версия | Общедоступная версия |
| [Запись беседы группы](/graph/api/resources/post?view=graph-rest-1.0) | Общедоступная версия | Общедоступная версия |
| [Сообщение](/graph/api/resources/message?view=graph-rest-1.0) | Общедоступная версия | Общедоступная версия |
| [Организация](/graph/api/resources/organization?view=graph-rest-1.0) | Общедоступная версия | Общедоступная версия |
| [Личный контакт](/graph/api/resources/contact?view=graph-rest-1.0)| Общедоступная версия | Общедоступная версия |
| [Пользователь](/graph/api/resources/user?view=graph-rest-1.0) | Общедоступная версия | Общедоступная версия |
| [Задача](/graph/api/resources/todotask?view=graph-rest-beta) | Общедоступная версия | Общедоступная версия |
| [Список задач](/graph/api/resources/todotasklist?view=graph-rest-beta) | Общедоступная версия | Общедоступная версия |

Расширения всех этих ресурсов можно использовать, выполнив вход с помощью рабочей или учебной учетной записи. Кроме того, выполнив вход с помощью личной учетной записи, можно использовать расширения для следующих ресурсов: **event**, **post**, **group**, **message**, **contact**, **user**.

## <a name="open-extensions"></a>Открытые расширения

[Открытые расширения](/graph/api/resources/opentypeextension?view=graph-rest-1.0) (прежнее название — расширения данных Office 365) относятся к [открытым типам](https://www.odata.org/getting-started/advanced-tutorial/#openType) и позволяют добавлять нетипизированные данные приложений непосредственно в экземпляр ресурса.

> [!VIDEO https://www.youtube-nocookie.com/embed/ibdlADb8IZc]

Открытые расширения, наряду с их пользовательскими данными, доступны через свойство навигации **extensions** экземпляра ресурса.
Свойство **extensionName** — это единственное _предварительно определенное_ записываемое свойство в открытом расширении. При создании открытого расширения нужно назначить свойству **extensionName** имя, которое уникально для клиента.

Для этого можно использовать формат обратных DNS, который зависит от _принадлежащего вам домена_, например `Com.Contoso.ContactInfo`.

Не указывайте домен Майкрософт (`Com.Microsoft` или `Com.OnMicrosoft`) в имени расширения.

Вы можете [создать открытое расширение](/graph/api/opentypeextension-post-opentypeextension?view=graph-rest-1.0) в экземпляре ресурса и сохранить в нем все пользовательские данные с помощью одной операции (обратите внимание на [приведенные ниже ограничения](known-issues.md#extensions) для некоторых поддерживаемых ресурсов).

Позже возможно [считывание](/graph/api/opentypeextension-get?view=graph-rest-1.0), [обновление](/graph/api/opentypeextension-update?view=graph-rest-1.0) или [удаление](/graph/api/opentypeextension-delete?view=graph-rest-1.0) расширения и его данных.

Пример открытого расширения см. в статье [Добавление пользовательских данных в ресурсы user с помощью открытых расширений](extensibility-open-users.md).

## <a name="schema-extensions"></a>Расширения схемы


[Расширения схемы](/graph/api/resources/schemaextension?view=graph-rest-1.0) позволяют определять схему, используемую для расширения типа ресурса. Вначале создайте определение расширения схемы, чтобы позже воспользоваться им для расширения экземпляров ресурса, применяя строго типизированные пользовательские данные. Кроме того, вы можете контролировать [состояние](#schema-extensions-lifecycle) расширения схемы и сделать его доступным другим приложениям. Эти приложения смогут применить расширение к собственным данным и создать на его основе другие типы взаимодействия.


> [!VIDEO https://www.youtube-nocookie.com/embed/3MOAlUFNus0]

При создании определения расширения схемы необходимо присвоить уникальное имя его свойству **id**. Есть два варианта:

- Если у вас уже есть личный домен `.com`, `.net`, `.gov`, `.edu` или `.org`, который вы проверили для клиента, можете использовать это доменное имя вместе с именем схемы, чтобы задать уникальное имя в следующем формате: \{_&#65279;доменноеИмя_\}\_\{_&#65279;имяСхемы_\}. Например, если у вас есть личный домен contoso.com, можете задать **идентификатор** `contoso_mySchema`. Это предпочтительный способ.
- Если у вас нет подтвержденного личного домена, можете присвоить свойству **id** имя схемы (без префикса в виде доменного имени), например `mySchema`. Microsoft Graph присвоит ему идентификатор строки на основе предоставленного имени в следующем формате: ext\{_&#65279;8-random-alphanumeric-chars_\}\_\{_&#65279;schema-name_\}.  Например, `extkvbmkofy_mySchema`.

Это уникальное имя будет указано в **идентификаторе** как имя сложного типа, который будет хранить ваши пользовательские данные в экземпляре расширенного ресурса.

В отличие от открытых расширений, для управления определениями расширений схемы ([list](/graph/api/schemaextension-list?view=graph-rest-1.0), [create](/graph/api/schemaextension-post-schemaextensions?view=graph-rest-1.0), [get](/graph/api/schemaextension-get?view=graph-rest-1.0), [update](/graph/api/schemaextension-update?view=graph-rest-1.0) и [delete](/graph/api/schemaextension-delete?view=graph-rest-1.0)) и их данными (для добавления, получения, обновления и удаления данных) нужны отдельные наборы операций API.

Так как расширения схемы доступны как сложные типы в экземплярах целевых ресурсов, вы можете выполнять операции CRUD над пользовательскими данными в расширении схемы следующими способами:

- Указывать пользовательские данные при создании нового экземпляра ресурса с помощью метода `POST`. Обратите внимание, что с ресурсами **contact**, **event**, **message** и **post** связана [известная проблема](known-issues.md#creating-a-resource-instance-and-adding-schema-extension-data-at-the-same-time), из-за которой нужно создавать расширение схемы с помощью операции `PATCH`.
- Читать пользовательские данные с помощью метода `GET`.
- Добавлять или обновлять пользовательские данные в существующем экземпляре ресурса с помощью метода `PATCH`.
- Устанавливать значение null для сложного типа с помощью метода `PATCH` для удаления пользовательских данных в экземпляре ресурса.

Пример расширения схемы см. в статье [Добавление пользовательских данных в группы с помощью расширений схемы](extensibility-schema-groups.md).

### <a name="schema-extensions-lifecycle"></a>Жизненный цикл расширений схемы

Когда приложение создает определение расширения схемы, оно помечается как владелец такого расширения.

Приложение-владелец может перемещать расширение из одного состояния в другое, используя операцию PATCH для свойства **status**. В зависимости от текущего состояния приложение-владелец может обновлять или удалять расширение. Любые обновления расширения схемы должны всегда быть только дополнительными и не прерывающими.

|Состояние |Поведение в состоянии жизненного цикла |
|:-------------|:------------|
| InDevelopment | <ul><li>Начальное состояние после создания. Идет разработка расширения схемы, которую выполняет приложение-владелец. </li><li>В этом состоянии любое приложение в том каталоге, в котором зарегистрировано приложение-владелец, может расширять экземпляры ресурса с использованием этого определения схемы (при наличии у приложения разрешений для данного ресурса). </li><li>Только приложение-владелец может добавить изменения в определение расширения или удалить его. </li><li>Приложение-владелец может заменить состояние **InDevelopment** расширения на **Available**.</li></ul> |
| Available | <ul><li>Расширение схемы доступно для всех приложений в любом клиенте. </li><li>После того как приложение-владелец задаст **Available** в качестве состояния расширения, любое приложение сможет просто добавлять пользовательские данные в экземпляры ресурсов, типы которых указаны в расширении (если у приложения есть соответствующие разрешения). Приложение может назначать пользовательские данные при создании нового экземпляра или обновлении существующего. </li><li>Только приложение-владелец может добавлять изменения в определение расширения. Если указано это состояние, удалить определение расширения не может никакое приложение. </li><li>Приложение-владелец может обновить состояние расширения схемы, заменив **Available** на **Deprecated**.</li></ul> |
| Deprecated | <ul><li>Определение расширения схемы больше не доступно для чтения или изменения. </li><li>Приложения не могут просмотреть, обновить, добавить свойства или удалить расширение. </li><li>Но они по-прежнему могут читать, обновлять и удалять _значения свойств_ расширения. </li></ul> |

> **Примечание.** Определения расширений схемы (помеченных как `Available`), созданные другими разработчиками из других клиентов, отображаются для всех разработчиков (в списке всех расширений схемы). Это отличается от других API-интерфейсов, возвращающих только данные определенного клиента. С другой стороны, данные расширения, созданные на основе определений расширений схемы, относятся к конкретному клиенту и доступны только приложениям, которым явным образом предоставлено разрешение. 

### <a name="supported-property-data-types"></a>Поддерживаемые типы данных свойств

При определении свойства в расширении схемы поддерживаются следующие типы данных:

| Тип свойства | Примечания |
|:-------------|:------------|
| Binary | Не более 256 байт. |
| Boolean | Не поддерживается для ресурсов message, event и post. |
| DateTime | Должен быть указан в формате ISO 8601. Данные времени будут храниться в формате UTC. |
| Целое число | 32-разрядное значение. Не поддерживается для ресурсов message, event и post. |
| String | Не более 256 символов |

> **Примечание.** Многозначные свойства не поддерживаются.

### <a name="azure-ad-directory-schema-extensions"></a>Расширения схемы каталога Azure AD

Azure AD поддерживает схожий тип расширения, известный как [расширения схемы каталога](/previous-versions/azure/ad/graph/howto/azure-ad-graph-api-directory-schema-extensions), для нескольких ресурсов [directoryObject](/graph/api/resources/directoryobject?view=graph-rest-1.0). Вы можете использовать API Microsoft Graph для управления [определениями свойств расширений](/graph/api/resources/extensionproperty?view=graph-rest-1.0) и для добавления, получения, обновления и удаления _данных_ в свойствах этих расширений.

## <a name="permissions"></a>Разрешения

Для чтения или записи данных для расширений в ресурсе необходимы те же [разрешения](./permissions-reference.md), что и для чтения или записи ресурса. Например, чтобы приложение могло добавить специальные данные в профиль вошедшего пользователя, у него должно быть разрешение *User.ReadWrite.All*.

Кроме того, для создания определений расширения схемы и управления ими приложению необходимо разрешение *Directory.AccessAsUser.All*.

## <a name="data-limits"></a>Ограничения данных

### <a name="open-extension-limits"></a>Ограничения открытых расширений

К ресурсам каталогов, таким как **user**, **group**, **device**, применимы следующие ограничения:

- Каждое открытое расширение может содержать до 2 КБ данных (включая само определение расширения).
- Приложение может добавлять до двух открытых расширений для каждого экземпляра ресурса.

Следующие ограничения распространяются на ресурсы Outlook (такие как **message**, **event**, и **contact**):

- Каждое открытое расширение хранится в [именованном свойстве MAPI](/office/client-developer/outlook/mapi/mapi-named-properties), являющемся ограниченным ресурсом в почтовом ящике пользователя. Дополнительные сведения см. в статье [Тип ресурса openTypeExtension](/graph/api/resources/opentypeextension?view=graph-rest-1.0).

### <a name="schema-extension-limits"></a>Ограничения расширений схемы

Приложение может создать не более пяти определений **расширений схемы**.

## <a name="known-limitations"></a>Известные ограничения

Об известных ограничениях на использование расширений можно узнать в [соответствующем разделе](known-issues.md#extensions) статьи об известных проблемах.

## <a name="extension-examples"></a>Примеры расширений

- [Добавление пользовательских данных в ресурсы user с помощью открытых расширений](extensibility-open-users.md)

- [Добавление пользовательских данных в группы с помощью расширений схемы](extensibility-schema-groups.md)

## <a name="see-also"></a>См. также

- [Домены Microsoft 365](/office365/servicedescriptions/office-365-platform-service-description/domains)

- [Добавление и проверка домена для клиента Microsoft 365](https://office365support.ca/adding-and-verifying-a-domain-for-the-new-office-365/)