---
title: Обработка ошибок для Excel API в Microsoft Graph
description: Инструкции по обработке ошибок для Excel API в Microsoft Graph
author: grangeryy
localization_priority: Normal
ms.prod: excel
ms.openlocfilehash: 30273bcc7e408f0a1e9deb465ecb7114456023e33ac685dfec54e96623401628
ms.sourcegitcommit: 986c33b848fa22a153f28437738953532b78c051
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2021
ms.locfileid: "54225582"
---
# <a name="error-handling-for-excel-apis-in-microsoft-graph"></a>Обработка ошибок для Excel API в Microsoft Graph

В этой статье данная статья содержит общие инструкции и рекомендации по обработке ошибок, возвращающихся Excel API в Microsoft Graph при сбой запроса, отправленного через API.

## <a name="types-of-error-responses"></a>Типы ответов на ошибки

Excel API в Microsoft Graph возвращают два типа ошибок. Один из них — это регулярный ответ на ошибку, который выглядит следующим образом.

```http
HTTP/1.1 <HTTP status code>
Content-type: application/json

{
  "error": <Error object>
}
```

Второй — из длительной схемы операции, которая может возвращать код состояния HTTP и состояние операции в тексте ответа, как в `200 OK` `failed` следующем примере.

```http
HTTP/1.1 200 OK
Content-type: application/json

{
  "status": "failed",
  "error": <Error object>
}
```

Для обоих этих ответов на ошибки объект ошибки имеет следующую структуру.

>**Примечание:** Ответы на ошибки следуют определению в [спецификации OData v4](https://docs.oasis-open.org/odata/odata-json-format/v4.0/os/odata-json-format-v4.0-os.html#_Toc372793091) для ответов на ошибки.

```json
{
  "code": "string",
  "message": "string",
  "innerError": { "@odata.type": "odata.error" }
}
```

Объект `innerError` может рекурсивно содержать дополнительные объекты `innerError` с другими, более подробными кодами ошибок. Например, объект ошибки может содержать более подробные сведения об ошибках в коде ошибки второго уровня и сообщении, как показано.

```json
{
  "code": "Top-level error code",
  "message": "Top-level error message",
  "innerError": {
    "code": "Second-level error code",
    "message": "Second-level error message",
    "innerError": { "@odata.type": "odata.error" }
  }
}
```

## <a name="steps-to-handle-error-responses"></a>Действия по обработке ответов на ошибки

Клиенты Graph Майкрософт могут использовать следующие действия для обработки ошибок, которые происходят с Excel API.

### <a name="1-determine-whether-it-is-a-long-running-operation-error"></a>1. Определите, является ли это длительной ошибкой операции

Перед обработкой ошибки сначала необходимо определить, является ли ответ на ошибку длительным шаблоном операции или регулярным шаблоном. Из-за длительной ошибки операции код состояния HTTP и состояние операции будут возвращены `200 OK` `failed` в тексте ответа. Регулярный ответ на ошибку возвращает соответствующий код состояния http-ошибки. 

### <a name="2-parse-second-level-error-code"></a>2. Код ошибки второго уровня Parse

Для длительной операции и регулярного шаблона рекомендуется сначала выполнять инструкции по ошибкам второго уровня. Код ошибки нечувствительн. В следующей таблице перечислены инструкции по некоторым ошибкам. Служба может добавлять новые коды ошибок в любое время.

| Код                               | Инструкции
|:-----------------------------------|:---------------------------------------------
| **accessConflict**   | Неудачный запрос конфликтуется с другими клиентами, которые имеют доступ к книге (например, другой клиент заблокировал книгу для редактирования). Клиент microsoft Graph не должен повторно запрашивать сбой до тех пор, пока конфликт не будет разрешен. Конечный пользователь может вручную выполнять те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **accessDenied**   | Вы не можете выполнить запрашиваемую операцию (например, выполняется изменение заблокированных ячеек). Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **badRequestUncategorized**    | В неустановленном запросе обнаружена неустановленная ошибка. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **conflictUncategorized**                   | Сбой запроса конфликтуется с определенным состоянием сервера. Клиент microsoft Graph не должен повторно запрашивать сбой до тех пор, пока конфликт не будет разрешен. Конечный пользователь может вручную выполнять те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **filteredRangeConflict**                   | Операция не удалась из-за конфликта с фильтрованным диапазоном. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **forbiddenUncategorized**                    | Сбой запроса не допускается. Клиент microsoft Graph не должен повторно задать неудачный запрос. Конечный пользователь может вручную выполнять те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| **gatewayTimeoutUncategorized**         | Служба не смогла выполнить запрос в течение срока.
| **generalException**         | При обработке запроса возникла внутренняя ошибка. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **insertDeleteConflict**         | Операция вставки или удаления привела к конфликту. Клиент microsoft Graph не должен повторно задать неудачный запрос. Конечный пользователь может вручную выполнять те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **internalServerErrorUncategorized**       | Произошла неуказанная ошибка. Клиент microsoft Graph не должен повторно задать неудачный запрос. Если сеанс указан в неудачном запросе, дополнительный доступ к сеансу также не ожидается.
| **invalidArgument**         | Аргумент недопустим, отсутствует или имеет неправильный формат. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **invalidReference**         | Эта ссылка недопустима для текущей операции. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **invalidSessionAccessConflict**             | Сеанс, указанный в запросе, недействителен из-за конфликтов с другими клиентами, которые имеют доступ к книге (например, другой клиент заблокировал книгу для редактирования). Дальнейший доступ к сеансу, указанному в сбойном запросе, не ожидается. Воссоздание сеансов с тем же **запросом createSession** не ожидается до разрешения конфликта. Воссоздание сеансов с помощью другого **запроса createSession может** или не увенчаться успехом. Конечный пользователь может вручную выполнять те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **invalidSessionAuthentication**         | Сеанс, указанный в запросе, недействителен из-за ошибки проверки подлинности. Дальнейший доступ к сеансу, указанному в сбойном запросе, не ожидается. Воссоздание сеансов с тем же **запросом createSession** не ожидается до тех пор, пока не будут предоставлены соответствующие сведения о проверке подлинности.
| **invalidSessionNotFound**         | Сеанс, указанный в запросе, недействителен, так как книгу не найти. Дальнейший доступ к сеансу, указанному в сбойном запросе, не ожидается. Воссоздание сеансов с тем же **запросом createSession** не ожидается.
| **invalidSessionReCreatable**             | Сеанс, указанный в запросе, не существует или недействителен из-за преходящей ошибки. Клиент microsoft Graph может попытаться воссоздать сеанс и возобновить работу. Дальнейший доступ к сеансу, указанному в сбойном запросе, не ожидается.
| **invalidSessionRestricted**          | Сеанс, указанный в запросе, недействителен из-за конфигураций служб или ограничений. Дальнейший доступ к сеансу, указанному в сбойном запросе, не ожидается. Воссоздание сеансов с тем же **запросом createSession** не ожидается до тех пор, пока ограничения или конфигурации не прекратятся. Воссоздание сеансов с помощью другого **запроса createSession может** или не увенчаться успехом. Конечный пользователь может вручную выполнять те же операции Excel Online, чтобы получить дополнительные сведения об ограничениях.
| **invalidSessionUnexpected**                | Сеанс, указанный в запросе, недействителен из-за неожиданной проблемы. Дальнейший доступ к сеансу, указанному в сбойном запросе, не ожидается. Воссоздание сеансов с тем же **запросом createSession** не ожидается. Воссоздание сеансов с помощью другого **запроса createSession может** или не увенчаться успехом.
| **invalidSessionUnsupportedWorkbook**              | Сеанс, указанный в запросе, недействителен, так как книга содержит неподтверченные функции или превышает ограничение размера. Обычно неподтверченные факторы вводятся другим клиентом, который получает доступ к книге. Дальнейший доступ к сеансу, указанному в сбойном запросе, не ожидается. Воссоздание сеансов с тем же **запросом createSession** не ожидается, пока не будут удалены неподтвержденные факторы. Воссоздание сеансов с помощью другого запроса createSession может или не увенчаться успехом. Конечный пользователь может вручную выполнять те же операции с Excel Online, чтобы получить дополнительные сведения о неподдергиваемом факторе, или с Excel Desktop, где книга может поддерживаться.
| **itemAlreadyExists**         | Создаваемый ресурс уже существует. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **itemNotFound**         | Запрашиваемый ресурс не существует. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **methodNotAllowed**         | Метод HTTP, указанный в запросе, не разрешен на ресурсе. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **methodNotAllowedUncategorized**              | Метод HTTP, указанный в запросе, не разрешен на ресурсе. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **nonBlankCellOffSheet**         | Не может вставить новые ячейки, так как это отодвигает непустые ячейки с конца таблицы. Клиент microsoft Graph не должен повторно задать неудачный запрос. Конечный пользователь может удалить строки или столбцы, чтобы вставить содержимое, а затем попробовать еще раз.
| **notFoundUncategorized**             | Запрашиваемый ресурс не может быть найден. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **notImplementedUncategorized**            | Запрашиваемая функция в настоящее время не реализована. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **payloadTooLargeUncategorized**              | Нагрузка запроса превышает предельный размер. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **rangeExceedsLimit**         | Количество ячейки в диапазоне превысило максимально поддерживаемый номер. Клиент microsoft Graph может попытаться отправить запрос с небольшим размером диапазона. Дополнительные сведения см. в дополнительных сведениях об ограничениях ресурсов и оптимизации [производительности для Office надстройки.](/office/dev/add-ins/concepts/resource-limits-and-performance-optimization#excel-add-ins)
| **requestAborted**         | Запрос был прерван во время запуска, что обычно было вызвано длительным вычислением времени из функций в книге. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **serviceUnavailableUncategorized**      | Служба временно недоступна или перегружена. Клиент microsoft Graph не должен повторно задать неудачный запрос до тех пор, пока не пройдет указанная продолжительность охлаждения.
| **tooManyRequestsUncategorized**             | Сбойный запрос превышает определенное ограничение частоты. Клиент microsoft Graph не должен повторно задать неудачный запрос до тех пор, пока не пройдет указанная продолжительность охлаждения.
| **transientFailure**           | Запрос не удалось из-за преходящей ошибки. Клиент microsoft Graph не должен повторно задать неудачный запрос до тех пор, пока не пройдет указанная продолжительность охлаждения.
| **unauthorizedUncategorized**         | Необходимые сведения о проверке подлинности для ресурса отсутствуют или недействительны. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **unsupportedOperation**         | Выполняемая операция не поддерживается. Клиент microsoft Graph не должен повторно задать неудачный запрос.
| **unsupportedWorkbook**         | Запрос не удалось. Книга содержит неподтверченные функции или превышает ограничение размера. Клиент microsoft Graph не должен повторно задать неудачный запрос, пока не будут удалены неподтвердимые факторы.

>**Примечание:** Для обычного шаблона неудачный запрос определяется как запрос, соответствующий ответу. Для шаблона длительной операции сбойный запрос вызывает сбойную операцию.

### <a name="3-parse-the-top-level-error-code"></a>3. Размыть код ошибки верхнего уровня

Если вы не можете найти код ошибки [](workbook-error-codes.md#detailed-error-code) второго уровня, указанный в разделе Подробные коды ошибок, рекомендуем следовать инструкциям, предусмотренным для ошибок верхнего уровня. Коды ошибок верхнего уровня привязаны к коду состояния, и вы можете принять меры в соответствии с соответствующими кодами состояния. Подробные сведения об ошибках верхнего уровня и кодах сообщений см. в [материале Error codes.](workbook-error-codes.md#error-code)

### <a name="4-parse-the-status-code"></a>4. Размыть код состояния

Если код ошибки, с которым вы столкнулись, не находится в списке второго уровня или в списке верхнего уровня, рекомендуем принять меры в соответствии с кодом состояния HTTP.

### <a name="5-error-recovery-cooldown"></a>5. Охлаждение восстановления ошибок

Для некоторых ответов в обычном шаблоне длительность охлаждения восстановления в секундах может быть предоставлена через `Retry-After` загон. При длительном охлаждении восстановления клиент Microsoft Graph не будет отправлять запросы на последующие действия до завершения указанной продолжительности.

## <a name="special-case-handling"></a>Обработка специальных кейсов

Для [](excel-manage-sessions.md#request-types)сессионных запросов, если вы столкнулись с ошибкой или ошибкой, когда код ошибки второго уровня указан в подробных кодах ошибок, выполните анализ кода второго уровня и выполните соответствующие инструкции; в противном случае мы повторно воссоздаем сеанс `502/badGateway` `503/serviceUnavailable` непосредственно. [](workbook-error-codes.md#detailed-error-code)
<!-- {
  "type": "#page.annotation",
  "description": "Error handling in Excel Graph.",
  "keywords": "error response, error object, error codes, innerError, error handling",
  "section": "documentation",
  "tocPath": ""
} -->
