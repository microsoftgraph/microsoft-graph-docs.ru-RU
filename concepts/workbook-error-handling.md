---
title: Обработка ошибок для API Excel в Microsoft Graph
description: Инструкции по обработке ошибок для API Excel в Microsoft Graph
author: grangeryy
localization_priority: Normal
ms.prod: excel
ms.openlocfilehash: 5d5a420b4968b0a944ac192de5654692678663c8
ms.sourcegitcommit: b0194231721c68053a0be6d8eb46687574eb8d71
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/18/2021
ms.locfileid: "50293080"
---
# <a name="error-handling-for-excel-apis-in-microsoft-graph"></a>Обработка ошибок для API Excel в Microsoft Graph

В этой статье данная статья содержит общие инструкции и рекомендации по обработке ошибок, возвращаемой API Excel в Microsoft Graph при сбойе запроса, отправленного через API.

## <a name="types-of-error-responses"></a>Типы ответов об ошибках

API Excel в Microsoft Graph возвращают два типа ошибок. Первый — это обычный ответ об ошибке, который выглядит следующим образом.

```http
HTTP/1.1 <HTTP status code>
Content-type: application/json

{
  "error": <Error object>
}
```

Второй — из шаблона длительных операций, который может возвращать код состояния HTTP и состояние операции в тексте отклика, как в `200 OK` `failed` следующем примере.

```http
HTTP/1.1 200 OK
Content-type: application/json

{
  "status": "failed",
  "error": <Error object>
}
```

Для обоих этих ответов об ошибках объект ошибки имеет следующую структуру.

>**Примечание.** Ответы на ошибки следуют определению в [спецификации OData v4](https://docs.oasis-open.org/odata/odata-json-format/v4.0/os/odata-json-format-v4.0-os.html#_Toc372793091) для ответов на ошибки.

```json
{
  "code": "string",
  "message": "string",
  "innerError": { "@odata.type": "odata.error" }
}
```

Объект `innerError` может рекурсивно содержать дополнительные объекты `innerError` с другими, более подробными кодами ошибок. Например, объект ошибки может содержать более подробные сведения об ошибке в коде ошибки второго уровня и сообщении, как показано ниже.

```json
{
  "code": "Top-level error code",
  "message": "Top-level error message",
  "innerError": {
    "code": "Second-level error code",
    "message": "Second-level error message",
    "innerError": { "@odata.type": "odata.error" }
  }
}
```

## <a name="steps-to-handle-error-responses"></a>Действия по обработке ответов на ошибки

Клиенты Microsoft Graph могут использовать следующие действия для обработки ошибок, которые возникают с помощью API Excel.

### <a name="1-determine-whether-it-is-a-long-running-operation-error"></a>1. Определите, является ли это длительной ошибкой операции

Прежде чем обрабатывать ошибку, сначала необходимо определить, является ли ответ на ошибку из долгосрочного шаблона операции или регулярного шаблона. При длительной ошибке операции код состояния HTTP и состояние операции будут возвращены `200 OK` `failed` в тексте отклика. Обычный ответ об ошибке возвращает соответствующий код состояния HTTP-ошибки. 

### <a name="2-parse-second-level-error-code"></a>2. Разчет кода ошибки второго уровня

Для шаблона длительных операций и обычного шаблона рекомендуется сначала следовать инструкциям для ошибок второго уровня. Код ошибки нечувствительн к делу. В следующей таблице перечислены инструкции по некоторым ошибкам. Служба может добавлять новые коды ошибок в любое время.

| Код                               | Инструкции
|:-----------------------------------|:---------------------------------------------
| **accessConflict**   | Неудачный запрос конфликтует с другими клиентами, которые имеют доступ к книге (например, другой клиент заблокировал книгу для редактирования). Клиент Microsoft Graph не должен повторно запрашивать неудачный запрос, пока конфликт не будет устранен. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **accessDenied**   | Вы не можете выполнить запрашиваемую операцию (например, внести изменения в заблокированные ячейки). Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **badRequestUncategorized**    | В неудачном запросе обнаружена неустановленная ошибка. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **conflictUncategorized**                   | Неудачный запрос конфликтует с определенным состоянием сервера. Клиент Microsoft Graph не должен повторно запрашивать неудачный запрос, пока конфликт не будет устранен. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **filteredRangeConflict**                   | Операция не удалась, так как она конфликтует с отфильтрованным диапазоном. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **forbiddenUncategorized**                    | Неудачный запрос не разрешен. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| **gatewayTimeoutUncategorized**         | Службе не удалось выполнить запрос в течение этого времени.
| **generalException**         | При обработке запроса произошла внутренняя ошибка. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **insertDeleteConflict**         | Операция вставки или удаления привела к конфликту. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **internalServerErrorUncategorized**       | Произошла неуказанная ошибка. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос. Если сеанс указан в неудачном запросе, дальнейший доступ к сеансу также не ожидается.
| **invalidArgument**         | Аргумент недопустим, отсутствует или имеет неправильный формат. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **invalidReference**         | Эта ссылка недопустима для текущей операции. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **invalidSessionAccessConflict**             | Сеанс, указанный в запросе, недействителен из-за конфликтов с другими клиентами, которые имеют доступ к книге (например, другой клиент заблокировал книгу для редактирования). Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается, пока конфликт не будет устранен. Повторное создание сеансов с помощью другого **запроса createSession может** быть успешным или не удастся. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **invalidSessionAuthentication**         | Сеанс, указанный в запросе, является недопустимым из-за ошибки проверки подлинности. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается до тех пор, пока не будут предоставлены соответствующие сведения о проверке подлинности.
| **invalidSessionNotFound**         | Сеанс, указанный в запросе, недействителен, так как книгу не удалось найти. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же **запросом createSession** не ожидается.
| **invalidSessionReCreatable**             | Сеанс, указанный в запросе, не существует или является недопустимым из-за временных ошибок. Клиент Microsoft Graph может попытаться воссоздать сеанс и возобновить работу. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается.
| **invalidSessionRestricted**          | Сеанс, указанный в запросе, недействителен из-за конфигураций служб или ограничений. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается до тех пор, пока ограничения или конфигурации, блокирующие запрос, не изменится. Повторное создание сеансов с помощью другого **запроса createSession может** быть успешным или не удастся. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| **invalidSessionUnexpected**                | Сеанс, указанный в запросе, является недопустимым из-за неожиданной проблемы. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же **запросом createSession** не ожидается. Повторное создание сеансов с помощью другого **запроса createSession может** быть успешным или не удастся.
| **invalidSessionUnsupportedWorkbook**              | Сеанс, указанный в запросе, недействителен, так как книга содержит неподтверченные функции или превышает предельный размер. Обычно неподтверченные факторы вводятся другим клиентом, который получает доступ к книге. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается, пока не будут удалены неподтвержденные факторы. Повторное создание сеансов с помощью другого запроса createSession может быть успешным или не удастся. Конечный пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о неподдергиваемом факторе или в настольном компьютере Excel, где может поддерживаться книга.
| **itemAlreadyExists**         | Создаваемый ресурс уже существует. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **itemNotFound**         | Запрашиваемый ресурс не существует. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **methodNotAllowed**         | Метод HTTP, указанный в запросе, не разрешен для ресурса. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **methodNotAllowedUncategorized**              | Метод HTTP, указанный в запросе, не разрешен для ресурса. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **nonBlankCellOffSheet**         | Не может вставлять новые ячейки, так как они будут отставлять непустые ячейки с конца таблицы. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **notFoundUncategorized**             | Не удается найти запрашиваемую базу. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **notImplementedUncategorized**            | Запрашиваемая функция в настоящее время не реализована. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **payloadTooLargeUncategorized**              | Объем полезной нагрузки запроса превышает ограничение на размер. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **rangeExceedsLimit**         | Число ячеок в диапазоне превысило максимальное поддерживаемые числа. Клиент Microsoft Graph может попытаться отправить запрос с небольшим размером диапазона.
| **requestAborted**         | Запрос был прерван во время работы, что обычно было вызвано длительным вычислением функций в книге. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **serviceUnavailableUncategorized**      | Служба временно недоступна или перегружена. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос, пока не пройдет указанный срок хладнокровия.
| **tooManyRequestsUncategorized**             | Неудачный запрос превышает определенное ограничение частоты. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос, пока не пройдет указанный срок хладнокровия.
| **transientFailure**           | Сбой запроса из-за временных ошибок. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос, пока не пройдет указанный срок хладнокровия.
| **unauthorizedUncategorized**         | Необходимые сведения для проверки подлинности ресурса отсутствуют или недействительны. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **unsupportedOperation**         | Выполняемая операция не поддерживается. Ожидается, что клиент Microsoft Graph не будет повторно запрашивать неудачный запрос.
| **unsupportedWorkbook**         | Сбой запроса. Книга содержит неподтверченные функции или превышает предельный размер. Клиент Microsoft Graph не должен повторно запрашивать неудачный запрос, пока не будут удалены неподтверченные факторы.

>**Примечание.** Для обычного шаблона неудачный запрос определяется как запрос, соответствующий ответу. Для шаблона длительной операции неудачный запрос запускает неудачную операцию.

### <a name="3-parse-the-top-level-error-code"></a>3. Раз parse the top-level error code

Если вы не можете найти код ошибки [](workbook-error-codes.md#detailed-error-code) второго уровня, указанный в разделе "Подробные коды ошибок", рекомендуется следовать инструкциям для ошибок верхнего уровня. Коды ошибок верхнего уровня привязаны к коду состояния, и вы можете принять меры в соответствии с соответствующими кодами состояния. Подробные сведения о кодах ошибок верхнего уровня и сообщениях см. в [коде ошибок.](workbook-error-codes.md#error-code)

### <a name="4-parse-the-status-code"></a>4. Раз parse the status code

Если код ошибки не находится в списке второго или верхнего уровня, рекомендуется действовать в соответствии с кодом состояния HTTP.

### <a name="5-error-recovery-cooldown"></a>5. Остов восстановления ошибки

Для некоторых ответов в обычном шаблоне длительность восстановления в секундах может быть предоставлена через `Retry-After` загон. При длительности хладок восстановления клиент Microsoft Graph не должен отправлять запросы на последующие действия до завершения указанной длительности.

## <a name="special-case-handling"></a>Обработка особых обращений

В случае запросов с последующим сеансом [,](excel-manage-sessions.md#request-types)если вы столкнулись с ошибкой или ошибкой, когда код ошибки второго уровня указан в подробных кодах ошибок, выполните анализ кода второго уровня и следуйте соответствующим инструкциям; в противном случае мы заново воссоздаем сеанс `502/badGateway` `503/serviceUnavailable` напрямую. [](workbook-error-codes.md#detailed-error-code)
<!-- {
  "type": "#page.annotation",
  "description": "Error handling in Excel Graph.",
  "keywords": "error response, error object, error codes, innerError, error handling",
  "section": "documentation",
  "tocPath": ""
} -->
