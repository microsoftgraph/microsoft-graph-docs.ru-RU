---
title: Обработка ошибок для API Excel
description: Найдите общие инструкции и рекомендации по обработке ошибок, возвращаемых API Excel в Microsoft Graph при сбое запроса, отправленного через API.
author: grangeryy
ms.localizationpriority: medium
ms.prod: excel
ms.openlocfilehash: 074dfaab5fc4ddda07ea1d70117666e80825a9fd
ms.sourcegitcommit: b2b3c3ae00f9e2e0bb2dcff30e97b60ccdebf170
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2022
ms.locfileid: "66437361"
---
# <a name="error-handling-for-excel-apis"></a>Обработка ошибок для API Excel

В этой статье приводятся общие инструкции и рекомендации по обработке ошибок, возвращаемых [интерфейсами API Excel](/graph/api/resources/excel) в Microsoft Graph при сбое запроса, отправленного через API.

## <a name="types-of-error-responses"></a>Типы ответов на ошибки

API Excel в Microsoft Graph возвращают два типа ошибок. Один из них — это обычный ответ об ошибке, который выглядит следующим образом.

```http
HTTP/1.1 <HTTP status code>
Content-type: application/json

{
  "error": <Error object>
}
```

Второй — из шаблона длительных операций, `200 OK` который может возвращать код состояния HTTP `failed` и состояние операции в тексте отклика, как показано в следующем примере.

```http
HTTP/1.1 200 OK
Content-type: application/json

{
  "status": "failed",
  "error": <Error object>
}
```

Для обоих этих ответов на ошибки объект ошибки имеет следующую структуру.

> [!NOTE]
> Сообщения об ошибках соответствуют определению в спецификации [OData версии 4](https://docs.oasis-open.org/odata/odata-json-format/v4.0/os/odata-json-format-v4.0-os.html#_Toc372793091).

```json
{
  "code": "string",
  "message": "string",
  "innerError": { "@odata.type": "odata.error" }
}
```

Объект `innerError` может рекурсивно содержать дополнительные объекты `innerError` с другими, более подробными кодами ошибок. Например, объект ошибки может содержать более подробные сведения об ошибке во втором коде ошибки и сообщении, как показано ниже.

```json
{
  "code": "Top-level error code",
  "message": "Top-level error message",
  "innerError": {
    "code": "Second-level error code",
    "message": "Second-level error message",
    "innerError": { "@odata.type": "odata.error" }
  }
}
```

## <a name="steps-to-handle-error-responses"></a>Действия по обработке ответов на ошибки

Клиенты Microsoft Graph могут использовать следующие шаги для обработки ошибок, которые возникают с API Excel.

### <a name="1-determine-whether-it-is-a-long-running-operation-error"></a>1. Определите, является ли это длительной ошибкой операции.

Прежде чем обрабатывать ошибку, сначала необходимо определить, является ли ответ на ошибку длительным шаблоном операции или обычным шаблоном. Ошибка длительной операции вернет `200 OK` код состояния HTTP `failed` и состояние операции в тексте отклика. Обычный ответ об ошибке возвращает соответствующий код состояния ошибки HTTP. 

### <a name="2-parse-second-level-error-code"></a>2. Анализ кода ошибки второго уровня

Для шаблона длительных операций и обычного шаблона рекомендуется сначала выполнить инструкции по ошибкам второго уровня. Код ошибки не учитывает регистр. В следующей таблице перечислены инструкции по некоторым ошибкам. Служба может в любое время добавить новые коды ошибок.

| Код                               | Инструкции
|:-----------------------------------|:---------------------------------------------
| **accessConflict**   | Неудачный запрос конфликтует с другими клиентами, которые имеют доступ к книге (например, другой клиент блокирует книгу для редактирования). Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока конфликт не будет разрешен. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **accessDenied**   | Невозможно выполнить запрашиваемую операцию (например, внесение изменений в заблокированные ячейки). Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **badRequestUncategorized**    | В неудачном запросе обнаружена неуказанная ошибка. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **conflictUncategorized**                   | Неудачный запрос конфликтует с определенным состоянием сервера. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока конфликт не будет разрешен. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **filteredRangeConflict**                   | Не удалось выполнить операцию, так как она конфликтует с отфильтрованным диапазоном. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **forbiddenUncategorized**                    | Неудачный запрос не разрешен. Клиент Microsoft Graph не должен повторно отправить неудачный запрос. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| **gatewayTimeoutUncategorized**         | Службе не удалось выполнить запрос в течение указанного времени.
| **generalException**         | При обработке запроса произошла внутренняя ошибка. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **insertDeleteConflict**         | Операция вставки или удаления привела к конфликту. Клиент Microsoft Graph не должен повторно отправить неудачный запрос. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **internalServerErrorUncategorized**       | Произошла неуказанная ошибка. Клиент Microsoft Graph не должен повторно отправить неудачный запрос. Если сеанс указан в неудачном запросе, дальнейший доступ к сеансу также не ожидается.
| **invalidArgument**         | Аргумент недопустим, отсутствует или имеет неправильный формат. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **invalidReference**         | Эта ссылка недопустима для текущей операции. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **invalidSessionAccessConflict**             | Указанный в запросе сеанс недопустим из-за конфликтов с другими клиентами, которые имеют доступ к книге (например, другой клиент заблокнул книгу для редактирования). Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторная сборка сеансов с тем же **запросом createSession** не ожидается, пока конфликт не будет разрешен. Повторное создание сеансов с другим запросом **createSession** может завершиться или завершиться сбоем. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| **invalidSessionAuthentication**         | Указанный в запросе сеанс недопустим из-за ошибки проверки подлинности. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается, пока не будут предоставлены соответствующие сведения для проверки подлинности.
| **invalidSessionNotFound**         | Сеанс, указанный в запросе, недопустим, так как не удается найти книгу. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же **запросом createSession** не ожидается.
| **invalidSessionReCreatable**             | Сеанс, указанный в запросе, не существует или недопустим из-за временной ошибки. Клиент Microsoft Graph может попытаться повторно создать сеанс и возобновить работу. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается.
| **invalidSessionRestricted**          | Сеанс, указанный в запросе, недопустим из-за конфигураций службы или ограничений. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается, пока ограничения или конфигурации, блокирующие запрос, не изменится. Повторное создание сеансов с другим запросом **createSession** может завершиться или завершиться сбоем. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| **invalidSessionUnexpected**                | Сеанс, указанный в запросе, недопустим из-за непредвиденной проблемы. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же **запросом createSession** не ожидается. Повторное создание сеансов с другим запросом **createSession** может завершиться или завершиться сбоем.
| **invalidSessionUnsupportedWorkbook**              | Указанный в запросе сеанс недопустим, так как книга содержит неподдерживаемые функции или превышает ограничение размера. Обычно неподдерживаемые факторы представлены другим клиентом, который имеет доступ к книге. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается, пока не будут удалены неподдерживаемые факторы. Повторное создание сеансов с другим запросом createSession может завершиться или завершиться сбоем. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о неподдерживаемых факторах, или в Классическом приложении Excel, где может поддерживаться книга.
| **itemAlreadyExists**         | Создаваемый ресурс уже существует. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **itemNotFound**         | Запрашиваемый ресурс не существует. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **methodNotAllowed**         | Метод HTTP, указанный в запросе, недопустим для ресурса. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **methodNotAllowedUncategorized**              | Метод HTTP, указанный в запросе, недопустим для ресурса. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **nonBlankCellOffSheet**         | Не удается вставить новые ячейки, так как это приведет к отправке непустых ячеек с конца листа. Клиент Microsoft Graph не должен повторно отправить неудачный запрос. Пользователь может удалить строки или столбцы, чтобы указать место для вставки содержимого, а затем повторить попытку.
| **notFoundUncategorized**             | Не удается найти запрашиваемый ресурс. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **notImplementedUncategorized**            | Запрашиваемая функция в настоящее время не реализована. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **payloadTooLargeUncategorized**              | Полезные данные запроса превышают ограничение размера. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **rangeExceedsLimit**         | Число ячеек в диапазоне превысило максимальное поддерживаемое число. Клиент Microsoft Graph может попытаться отправить запрос с меньшим размером диапазона. Дополнительные сведения см. в статье об ограничениях ресурсов и оптимизации производительности [для надстроек Office](/office/dev/add-ins/concepts/resource-limits-and-performance-optimization#excel-add-ins).
| **requestAborted**         | Запрос был прерван во время выполнения, что обычно было вызвано длительным вычислением функций в книге. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **serviceUnavailableUncategorized**      | Служба временно недоступна или перегружена. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока не пройдет указанный период ожидания.
| **tooManyRequestsUncategorized**             | Неудачный запрос превышает определенное ограничение частоты. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока не пройдет указанный период ожидания. Рекомендации по сокращению регулирования см. в статье "Уменьшение количества ошибок [регулирования"](workbook-best-practice.md#reduce-throttling-errors).
| **transientFailure**           | Сбой запроса из-за временной ошибки. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока не пройдет указанный период ожидания.
| **unauthorizedUncategorized**         | Обязательные сведения для проверки подлинности для ресурса отсутствуют или недопустимы. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **unsupportedOperation**         | Выполняемая операция не поддерживается. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| **unsupportedWorkbook**         | Сбой запроса. Книга содержит неподдерживаемые функции или превышает ограничение размера. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока не будут удалены неподдерживаемые факторы.

> [!NOTE]
> Для обычного шаблона неудачный запрос определяется как запрос, соответствующий ответу. В случае с длительным шаблоном операции неудачный запрос активирует неудачную операцию.

### <a name="3-parse-the-top-level-error-code"></a>3. Анализ кода ошибки верхнего уровня

Если не удается найти код ошибки второго уровня, указанный в статье "[](workbook-error-codes.md#detailed-error-codes)Подробные коды ошибок", рекомендуется следовать инструкциям, приведенным для ошибок верхнего уровня. Коды ошибок верхнего уровня привязаны к коду состояния, и вы можете выполнить действия в соответствии с соответствующими кодами состояния. Дополнительные сведения о кодах ошибок верхнего уровня и сообщениях см. в разделе ["Коды ошибок и сообщения"](workbook-error-codes.md#error-codes-and-messages).

### <a name="4-parse-the-status-code"></a>4. Анализ кода состояния

Если код ошибки отсутствует в списке второго уровня или в списке верхнего уровня, рекомендуется выполнить действия в соответствии с кодом состояния HTTP.

### <a name="5-error-recovery-cooldown"></a>5. Отключение восстановления после ошибки

Для некоторых ответов в обычном шаблоне длительность охлаждения восстановления в секундах может быть предоставлена через заголовок `Retry-After` . При наличии периода ожидания восстановления клиент Microsoft Graph не должен отправлять запросы на выполнение до истечения указанной длительности.

## <a name="special-case-handling"></a>Обработка особых регистров

Если в запросах с сеансом возникает ошибка или ошибка, если код ошибки второго уровня указан в подробных кодах [](excel-manage-sessions.md#request-types)[ошибок](workbook-error-codes.md#detailed-error-codes), выполните синтаксический анализ кода второго уровня и следуйте соответствующим инструкциям. В противном случае рекомендуется повторно создать сеанс напрямую.`502/badGateway` `503/serviceUnavailable`
<!-- {
  "type": "#page.annotation",
  "description": "Error handling in Excel Graph.",
  "keywords": "error response, error object, error codes, innerError, error handling",
  "section": "documentation",
  "tocPath": ""
} -->

## <a name="see-also"></a>См. также

- [Использование REST API для Excel](/graph/api/resources/excel)