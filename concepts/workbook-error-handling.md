---
title: Обработка ошибок для API Excel
description: Найдите общие инструкции и рекомендации по обработке ошибок, возвращаемых API Excel в Microsoft Graph при сбое запроса, отправленного через API.
author: grangeryy
ms.localizationpriority: medium
ms.prod: excel
ms.openlocfilehash: dcdbb5cd741a5264b6727201057d2c2b17f515ab
ms.sourcegitcommit: e48fe05125fe1e857225d20ab278352ff7f0911a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/30/2022
ms.locfileid: "66554969"
---
# <a name="error-handling-for-excel-apis"></a>Обработка ошибок для API Excel

В этой статье приводятся общие инструкции и рекомендации по обработке ошибок, возвращаемых [интерфейсами API Excel](/graph/api/resources/excel) в Microsoft Graph при сбое запроса, отправленного через API.

## <a name="types-of-error-responses"></a>Типы ответов на ошибки

API Excel в Microsoft Graph возвращают два типа ошибок. Один из них — это обычный ответ об ошибке, который выглядит следующим образом.

```http
HTTP/1.1 <HTTP status code>
Content-type: application/json
Retry-After: <Cooldown duration in seconds> (optional)

{
  "error": <Error object>
}
```

Второй — из шаблона длительных операций, `200 OK` который может возвращать код состояния HTTP `failed` и состояние операции в тексте отклика, как показано в следующем примере.

```http
HTTP/1.1 200 OK
Content-type: application/json

{
  "status": "failed",
  "error": <Error object>
}
```

Для обоих этих ответов на ошибки объект ошибки имеет следующую структуру.

> [!NOTE]
> Сообщения об ошибках соответствуют определению в спецификации [OData версии 4](https://docs.oasis-open.org/odata/odata-json-format/v4.0/os/odata-json-format-v4.0-os.html#_Toc372793091).

```json
{
  "code": "string",
  "message": "string",
  "innerError": { "@odata.type": "odata.error" }
}
```

Объект **innerError может** рекурсивно содержать больше объектов **innerError** с дополнительными более конкретными кодами ошибок. Например, объект ошибки может содержать более подробные сведения об ошибке во втором коде ошибки и сообщении, как показано ниже.

```json
{
  "code": "Top-level error code",
  "message": "Top-level error message",
  "innerError": {
    "code": "Second-level error code",
    "message": "Second-level error message",
    "innerError": { "@odata.type": "odata.error" }
  }
}
```

## <a name="steps-to-handle-error-responses"></a>Действия по обработке ответов на ошибки

Предполагается, что клиенты Microsoft Graph будут использовать следующие шаги для обработки ошибок, которые возникают с API Excel.

### <a name="1-determine-whether-it-is-a-long-running-operation-error"></a>1. Определите, является ли это длительной ошибкой операции.

Прежде чем обрабатывать ошибку, сначала необходимо определить, является ли ответ на ошибку длительным шаблоном операции или обычным шаблоном. Ошибка длительной операции вернет `200 OK` код состояния HTTP `failed` и состояние операции в тексте отклика. Обычный ответ об ошибке возвращает соответствующий код состояния ошибки HTTP. 

### <a name="2-parse-second-level-error-code"></a>2. Анализ кода ошибки второго уровня

Для шаблона длительных операций и обычного шаблона клиент должен сначала проанализировать необходимые коды ошибок второго уровня и обработать их в соответствии с инструкциями. При необходимости клиент также может обрабатывать другие коды ошибок второго уровня или вернуться к кодам ошибок верхнего уровня [или](#3-parse-the-top-level-error-code) [кодам состояния](#4-parse-the-status-code).

Коды ошибок не учитывают регистр.

#### <a name="required-second-level-error-codes"></a>Обязательные коды ошибок второго уровня

В следующей таблице перечислены инструкции для обязательных кодов ошибок второго уровня, которые должны обрабатывать клиенты Microsoft Graph. Служба может в любое время добавить новые коды ошибок.

| Код                               | Инструкции
|:-----------------------------------|:---------------------------------------------
| `accessConflict`   | Неудачный запрос конфликтует с другими клиентами, которые имеют доступ к книге (например, другой клиент блокирует книгу для редактирования). Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока конфликт не будет разрешен. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| `badRequestUncategorized`    | В неудачном запросе обнаружена неуказанная ошибка. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| `conflictUncategorized`                   | Неудачный запрос конфликтует с определенным состоянием сервера. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока конфликт не будет разрешен. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| `forbiddenUncategorized`                    | Неудачный запрос не разрешен. Клиент Microsoft Graph не должен повторно отправить неудачный запрос. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| `gatewayTimeoutUncategorized`         | Службе не удалось выполнить запрос в течение указанного времени.
| `internalServerErrorUncategorized`       | Произошла неуказанная ошибка. Клиент Microsoft Graph не должен повторно отправить неудачный запрос. Если сеанс указан в неудачном запросе, дальнейший доступ к сеансу также не ожидается.
| `invalidSessionAccessConflict`             | Указанный в запросе сеанс недопустим из-за конфликтов с другими клиентами, которые имеют доступ к книге (например, другой клиент заблокнул книгу для редактирования). Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторная сборка сеансов с тем же **запросом createSession** не ожидается, пока конфликт не будет разрешен. Повторное создание сеансов с другим запросом **createSession** может завершиться или завершиться сбоем. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.
| `invalidSessionAuthentication`         | Указанный в запросе сеанс недопустим из-за ошибки проверки подлинности. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается, пока не будут предоставлены соответствующие сведения для проверки подлинности.
| `invalidSessionNotFound`         | Сеанс, указанный в запросе, недопустим, так как не удается найти книгу. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же **запросом createSession** не ожидается.
| `invalidSessionReCreatable`             | Сеанс, указанный в запросе, не существует или недопустим из-за временной ошибки. Клиент Microsoft Graph может попытаться повторно создать сеанс и возобновить работу. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается.
| `invalidSessionRestricted`          | Сеанс, указанный в запросе, недопустим из-за конфигураций службы или ограничений. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается, пока ограничения или конфигурации, блокирующие запрос, не изменится. Повторное создание сеансов с другим запросом **createSession** может завершиться или завершиться сбоем. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения об ограничениях.
| `invalidSessionUnexpected`                | Сеанс, указанный в запросе, недопустим из-за непредвиденной проблемы. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же **запросом createSession** не ожидается. Повторное создание сеансов с другим запросом **createSession** может завершиться или завершиться сбоем.
| `invalidSessionUnsupportedWorkbook`              | Указанный в запросе сеанс недопустим, так как книга содержит неподдерживаемые функции или превышает ограничение размера. Обычно неподдерживаемые факторы представлены другим клиентом, который имеет доступ к книге. Дальнейший доступ к сеансу, указанному в неудачном запросе, не ожидается. Повторное создание сеансов с тем же запросом **createSession** не ожидается, пока не будут удалены неподдерживаемые факторы. Повторное создание сеансов с другим запросом createSession может завершиться или завершиться сбоем. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о неподдерживаемых факторах, или в Классическом приложении Excel, где может поддерживаться книга.
| `methodNotAllowedUncategorized`              | Метод HTTP, указанный в запросе, недопустим для ресурса. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| `notFoundUncategorized`             | Не удается найти запрашиваемый ресурс. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| `notImplementedUncategorized`            | Запрашиваемая функция в настоящее время не реализована. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| `payloadTooLargeUncategorized`              | Полезные данные запроса превышают ограничение размера. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| `serviceUnavailableUncategorized`      | Служба временно недоступна или перегружена. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока не пройдет указанный период ожидания.
| `tooManyRequestsUncategorized`             | Неудачный запрос превышает определенное ограничение частоты. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока не пройдет указанный период ожидания. Рекомендации по сокращению регулирования см. в статье "Уменьшение количества ошибок [регулирования"](workbook-best-practice.md#reduce-throttling-errors).
| `transientFailure`           | Сбой запроса из-за временной ошибки. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока не пройдет указанный период ожидания.
| `unauthorizedUncategorized`         | Обязательные сведения для проверки подлинности для ресурса отсутствуют или недопустимы. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.
| `unsupportedWorkbook`         | Сбой запроса. Книга содержит неподдерживаемые функции или превышает ограничение размера. Клиент Microsoft Graph не должен повторно отправить неудачный запрос, пока не будут удалены неподдерживаемые факторы.

> [!NOTE]
> Для обычного шаблона неудачный запрос определяется как запрос, соответствующий ответу. В случае с длительным шаблоном операции неудачный запрос активирует неудачную операцию.

#### <a name="optional-second-level-error-code-examples"></a>Необязательные примеры кода ошибок второго уровня

В следующей таблице перечислены примеры необязательных кодов ошибок второго уровня, включая соответствующие инструкции по обработке для каждого кода ошибки. Служба может в любое время добавить новые коды ошибок.

| Код                      | Инструкции                                                                                                                                                                                                                                                                                                                           |
|:--------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `accessDenied`          | Невозможно выполнить запрашиваемую операцию (например, внесение изменений в заблокированные ячейки). Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                 |
| `filteredRangeConflict` | Не удалось выполнить операцию, так как она конфликтует с отфильтрованным диапазоном. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                                              |
| `generalException`      | При обработке запроса произошла внутренняя ошибка. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                                                      |
| `insertDeleteConflict`  | Операция вставки или удаления привела к конфликту. Клиент Microsoft Graph не должен повторно отправить неудачный запрос. Пользователь может вручную выполнить те же операции с Excel Online, чтобы получить дополнительные сведения о конфликте.                                                                     |
| `invalidArgument`       | Аргумент недопустим, отсутствует или имеет неправильный формат. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                                                |
| `invalidReference`      | Эта ссылка недопустима для текущей операции. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                                                        |
| `itemAlreadyExists`     | Создаваемый ресурс уже существует. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                                                                    |
| `itemNotFound`          | Запрашиваемый ресурс не существует. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                                                                         |
| `methodNotAllowed`      | Метод HTTP, указанный в запросе, недопустим для ресурса. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                                      |
| `nonBlankCellOffSheet`  | Не удается вставить новые ячейки, так как это приведет к отправке непустых ячеек с конца листа. Клиент Microsoft Graph не должен повторно отправить неудачный запрос. Пользователь может удалить строки или столбцы, чтобы указать место для вставки содержимого, а затем повторить попытку.                                                                 |
| `rangeExceedsLimit`     | Число ячеек в диапазоне превысило максимальное поддерживаемое число. Клиент Microsoft Graph может попытаться отправить запрос с меньшим размером диапазона. Дополнительные сведения см. [в разделе "Ограничения ресурсов и оптимизация производительности для надстроек Office"](/office/dev/add-ins/concepts/resource-limits-and-performance-optimization#excel-add-ins). |
| `requestAborted`        | Запрос был прерван во время выполнения, что обычно было вызвано длительным вычислением функций в книге. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                    |
| `unsupportedOperation`  | Выполняемая операция не поддерживается. Клиент Microsoft Graph не должен повторно отправить неудачный запрос.                                                                                                                                                                                                               |

> [!NOTE]
> Для обычного шаблона неудачный запрос определяется как запрос, соответствующий ответу. В случае с длительным шаблоном операции неудачный запрос активирует неудачную операцию.

### <a name="3-parse-the-top-level-error-code"></a>3. Анализ кода ошибки верхнего уровня

Если не удается найти известный код ошибки второго уровня, следуйте инструкциям, приведенным для ошибок верхнего уровня. Коды ошибок верхнего уровня привязаны к коду состояния, и вы можете выполнить действия в соответствии с соответствующими кодами состояния. Дополнительные сведения о кодах ошибок верхнего уровня и сообщениях см. в разделе ["Коды ошибок и сообщения"](workbook-error-codes.md#error-codes-and-messages).

### <a name="4-parse-the-status-code"></a>4. Анализ кода состояния

Если в обычном шаблоне не удается найти известный код ошибки второго уровня или код ошибки верхнего уровня, необходимо выполнить действия в соответствии с кодом состояния HTTP.

### <a name="5-error-recovery-cooldown"></a>5. Отключение восстановления после ошибки

Для некоторых ответов в обычном шаблоне длительность охлаждения восстановления в секундах может быть предоставлена через заголовок `Retry-After` . При наличии длительности охлаждения восстановления клиент Microsoft Graph не должен отправлять дальнейшие запросы до истечения указанной длительности. Рекомендации, связанные с `Retry-After` заголовком и регулированием, см. в статье "Уменьшение количества ошибок [регулирования"](workbook-best-practice.md#reduce-throttling-errors).

## <a name="diagnostic-information"></a>Диагностические сведения

Все содержимое в ответе, не используемое на предыдущих шагах, предназначено только для диагностики (включая строки в **полях сообщения** ). Мы не повторяем, что вы принимаете зависимость от этого содержимого, так как они могут измениться без предварительного уведомления.

## <a name="special-case-handling"></a>Обработка особых регистров

Если [в запросах](excel-manage-sessions.md#request-types)`502/badGateway` `503/serviceUnavailable` с поддержкой сеанса возникает ошибка или возникает ошибка, при обнаружении известного кода ошибки второго уровня следуйте соответствующим инструкциям. В противном случае следует повторно создать сеанс напрямую.
<!-- {
  "type": "#page.annotation",
  "description": "Error handling in Excel Graph.",
  "keywords": "error response, error object, error codes, innerError, error handling",
  "section": "documentation",
  "tocPath": ""
} -->

## <a name="see-also"></a>См. также

- [Использование REST API для Excel](/graph/api/resources/excel)
