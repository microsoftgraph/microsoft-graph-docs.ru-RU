---
title: Получение неизменяемых идентификаторов для ресурсов Outlook
description: Неизменяемые идентификаторы позволяют вашему приложению получить идентификатор для элемента Outlook, который не изменяется в течение всего времени существования элемента.
author: abheek-das
localization_priority: Priority
ms.prod: outlook
ms.openlocfilehash: 572804950148e0cf2b5dcbb35842195123698c49
ms.sourcegitcommit: d014f72cf2cd130bedb02651092c0be12967b679
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "50473660"
---
# <a name="get-immutable-identifiers-for-outlook-resources"></a>Получение неизменяемых идентификаторов для ресурсов Outlook

Элементы Outlook (сообщения, события, контакты, задачи) ведут себя довольно интересно, и вы этого либо никогда не замечали, либо это вызывало серьезные затруднения: их идентификаторы изменяются. Это происходит нечасто (только при перемещении элемента), но может привести к серьезным проблемам для приложений, сохраняющих идентификаторы в автономном режиме для дальнейшего использования. Неизменяемые идентификаторы позволяют вашему приложению получить идентификатор, который не изменяется в течение всего времени существования элемента.

> [!NOTE]
> В неизменяемых идентификаторах, как и во всех других идентификаторах в Microsoft Graph, учитывается регистр. Об этом следует помнить при сравнении идентификаторов.

## <a name="how-it-works"></a>Принципы работы

Неизменяемый идентификатор — это необязательная функция для Microsoft Graph. Чтобы согласиться на ее использование, ваше приложение должно отправить дополнительный заголовок HTTP в запросах API:

```http
Prefer: IdType="ImmutableId"
```

Этот заголовок относится только к запросу, в который он входит. Если вы хотите всегда использовать неизменяемые идентификаторы, необходимо включать этот заголовок в каждый запрос API.

## <a name="lifetime-of-immutable-ids"></a>Время существования неизменяемых идентификаторов

Неизменяемый идентификатор элемента не изменится до тех пор, пока элемент остается в том же почтовом ящике. Это означает, что неизменяемый идентификатор НЕ изменится, если элемент перемещается в другую папку почтового ящика. Однако неизменяемый идентификатор изменится, если:

- пользователь перемещает элемент в архивный почтовый ящик;
- пользователь экспортирует элемент (в PST-файл, в виде MSG-файла и т. д.) и повторно импортирует его в свой почтовый ящик;

## <a name="items-that-support-immutable-id"></a>Элементы, поддерживающие неизменяемый идентификатор

Приведенные ниже элементы поддерживают неизменяемые идентификаторы.

- [Тип ресурса message](/graph/api/resources/message)
- [Тип ресурса attachment](/graph/api/resources/attachment)
- [Тип ресурса event](/graph/api/resources/event)
- [Тип ресурса eventMessage](/graph/api/resources/eventmessage)
- [Тип ресурса contact](/graph/api/resources/contact)
- [Тип ресурса outlookTask](/graph/api/resources/outlooktask)

Типы контейнеров (mailFolder, calendar и т. д.) не поддерживают неизменяемый идентификатор, но их обычные идентификаторы являются постоянными.

## <a name="immutable-id-with-sending-mail"></a>Неизменяемый идентификатор с отправляемой почтой

Вы можете использовать неизменяемые идентификаторы для поиска сообщения в папке "Отправленные" после его отправки с помощью следующих действий:

1. [Создайте черновик сообщения](/graph/api/user-post-messages), используя заголовок `Prefer: IdType="ImmutableId"`, и сохраните свойство `id` сообщения в отклике.
1. [Отправьте сообщение](/graph/api/message-send), используя идентификатор из предыдущего действия.
1. [Получите сообщение](/graph/api/message-get), используя идентификатор из первого действия. Это копия из папки "Отправленные".

> [!NOTE]
> Получение сообщения из папки "Отправленные" сразу после отправки сообщения может завершиться неудачей. Копия сообщения не создается, пока сообщение не будет успешно отправлено, что может занять некоторое время.

## <a name="immutable-id-with-change-notifications"></a>Неизменяемый идентификатор с уведомлением об изменениях

Можно запросить, чтобы Microsoft Graph отправлял неизменяемые идентификаторы в уведомлениях об изменениях путем включения заголовка `Prefer: IdType="ImmutableId"` при [создании подписки](/graph/api/subscription-post-subscriptions). Существующие подписки, созданные без заголовка, продолжат использовать формат идентификатора по умолчанию. Чтобы переключить существующие подписки на использование неизменяемых идентификаторов, их нужно удалить и заново создать с использованием заголовка.

## <a name="immutable-id-with-delta-query"></a>Неизменяемый идентификатор с запросом изменений

Можно запросить, чтобы Microsoft Graph возвращал неизменяемые идентификаторы в [ответах на запросы изменений](delta-query-overview.md) для поддерживаемых типов ресурсов путем включения заголовка `Prefer: IdType="ImmutableId"`. Значения `nextLink` и `deltaLink`, возвращаемые запросами изменений, совместимы с обоими форматами идентификаторов, поэтому вашему приложению не требуется повторно выполнять синхронизацию, чтобы воспользоваться преимуществами неизменяемого идентификатора. С помощью заголовка можно получить неизменяемые идентификаторы в дальнейшем и можно отдельно [обновить хранилище вашего приложения](#updating-existing-data).

## <a name="updating-existing-data"></a>Обновление существующих данных

Если уже имеется база данных, заполненная тысячами обычных идентификаторов, можно перенести эти идентификаторы в неизменяемый формат с помощью функции [translateExchangeIds](/graph/api/user-translateexchangeids). Вы можете обеспечить массив для перевода в нужный формат с количеством идентификаторов до 1000.

> [!NOTE]
> Можно также использовать `translateExchangeIds` для переноса приложений веб-служб Exchange в Microsoft Graph.

### <a name="example"></a>Пример

В приведенном ниже примере обычный идентификатор Graph преобразуется в неизменяемый идентификатор Graph.

#### <a name="request"></a>Запрос

```http
POST https://graph.microsoft.com/v1.0/me/translateExchangeIds

{
  "inputIds" :
  [
    "AQMkAGM2…"
  ],
  "targetIdType" : "restImmutableEntryId",
  "sourceIdType" : "restId"
}
```

#### <a name="response"></a>Отклик

```http
HTTP 200 OK

{
  "value": [
    {
      "targetId": "AAkALgAA...",
      "sourceId": "AQMkAGM2..."
    }
  ]
}
```
