---
title: Требования к лицензированию и оплате API Microsoft Teams
description: 'Узнайте о моделях лицензирования и оплаты, которые применяются к API Microsoft Teams в Microsoft Graph: модель = A, модель = B и режим оценки.'
author: nkramer
ms.localizationpriority: high
ms.prod: microsoft-teams
ms.openlocfilehash: 8af425ddb80405197730de7e1568d68ec292b53b
ms.sourcegitcommit: e48fe05125fe1e857225d20ab278352ff7f0911a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/30/2022
ms.locfileid: "66556313"
---
# <a name="licensing-and-payment-requirements-for-the-microsoft-teams-api"></a>Требования к лицензированию и оплате для Microsoft Teams API

В этой статье описываются требования к лицензированию и оплате для API Microsoft Teams в Microsoft Graph.

Некоторые интерфейсы API предоставляют возможность выбора модели лицензирования и оплаты с помощью параметра запроса `model`; другие поддерживают только одну модель или не поддерживают модели лицензирования и оплаты.

Доступны следующие модели лицензирования:

- [`model=A`](#modela-requirements) применяется только в приложениях, которые выполняют [функцию безопасности или соответствия требованиям](https://www.microsoft.com/licensing/terms/productoffering/MicrosoftAzure/MCA#ServiceSpecificTerms), и требует наличия [поддерживаемой лицензии](#required-licenses-for-modela). В будущем приложения также будут должны оплачивать сообщения, потребляемые сверх [заложенной емкости](#seeded-capacity).

- [`model=B`](#modelb-requirements) ограничивается приложениями, не выполняющими функции безопасности или соответствия. С 5 июля 2022 г. события выставления счетов [`model=B`](#modelb-requirements) становятся общедоступными. Требования к лицензированию для `model=B` отсутствуют.

- [Режим оценки (по умолчанию)](#evaluation-mode-default-requirements) разрешает доступ к API с ограниченным использованием для каждого запрашивающего приложения в целях оценки. Уведомления об изменениях не отправляются, если лимит превышен.

## <a name="modela-requirements"></a>Требования для `model=A`

`model=A` применяется только в приложениях, которые выполняют функцию безопасности или соответствия требованиям. Подробные сведения см. в разделе "Условия использования API для приложений безопасности и соответствия требованиям" [условий использования служб Microsoft Azure](https://www.microsoft.com/licensing/terms/productoffering/MicrosoftAzure/MCA#ServiceSpecificTerms).

|API                   | Для кого нужна [лицензия](#required-licenses-for-modela)  | Заложенная емкость | [Стоимость сверхлимитного использования](#price-for-additional-use) | Заметки |
|:-----------------------------|:--------------------------------------------|:----------------|:-------|:------|
| [Уведомления об изменении chatMessage](/graph/api/subscription-post-subscriptions) | Отправитель сообщений | 800 сообщений на одного пользователя в месяц на приложение | 0,00075 доллара США за каждое сообщение | Заложенная емкость распределяется по уведомлениям об изменении conversationMember |
| [Уведомления об изменении conversationMember](/graph/api/subscription-post-subscriptions) | Для каждого пользователя в составе клиента | 800 уведомлений на одного пользователя в месяц на приложение  | 0,00075 доллара США за каждое уведомление | Заложенная емкость распределяется по уведомлениям об изменении chatMessage |
| [Получение сообщений во всех чатах для пользователя](/graph/api/chats-getallmessages) | Для именованного пользователя | 1600 сообщений на одного пользователя в месяц на приложение | 0,00075 доллара США за каждое сообщение | Именованный пользователь — это пользователь, идентифицированный в URL-адресе запроса GET. Минимальная плата за 1 сообщение на запрос API. Заложенная емкость распределяется по экспорту канала. |
| [Получение сообщений по всем каналам](/graph/api/channel-getallmessages).| Для каждого участника команды | 1600 сообщений на одного пользователя в месяц на приложение | 0,00075 доллара США за каждое сообщение |  Минимальная плата за 1 сообщение на запрос API. Заложенная емкость распределяется по экспорту чата. |
| [Обновление policyViolation для chatMessage](/graph/api/chatmessage-update) |  Отправитель сообщений |  800 сообщений на одного пользователя в месяц на приложение | 0,00075 доллара США за каждое сообщение |

## <a name="modelb-requirements"></a>Требования для `model=B`

`model=B` ограничивается приложениями, не связанными с обеспечением безопасности или соответствия требованиям. Дополнительные сведения см. в разделе [Условия использования API для приложений, обеспечивающих безопасность и соответствие требованиям](https://www.microsoft.com/licensing/terms/productoffering/MicrosoftAzure/MCA#ServiceSpecificTerms), условий продукта для служб Microsoft Azure.

> [!NOTE]
> С 5 июля 2022 г. события выставления счетов [`model=B`](#modelb-requirements) для этих API становятся общедоступными.

|API   | Для кого нужна [лицензия](#required-licenses-for-modela)  | Заложенная емкость | [Стоимость сверхлимитного использования](#price-for-additional-use) | Заметки |
|:-----------------------------|:--------------------------------------------|:----------------|:-------|:------|
| [Уведомления об изменении chatMessage](/graph/api/subscription-post-subscriptions) | Недоступно | Отсутствует | 0,00075 доллара США за каждое сообщение |  |
| [Уведомления об изменении conversationMember](/graph/api/subscription-post-subscriptions) | Недоступно | Нет  | 0,00075 доллара США за каждое уведомление | |
| [Получение сообщений во всех чатах для пользователя](/graph/api/chats-getallmessages) |  Недоступно | Отсутствует | 0,00075 доллара США за каждое сообщение |  Минимальная плата за 1 сообщение на запрос API. |
|  [Получение сообщений по всем каналам](/graph/api/channel-getallmessages).|  Недоступно | Отсутствует | 0,00075 доллара США за каждое сообщение | Минимальная плата за 1 сообщение на запрос API. |

## <a name="evaluation-mode-default-requirements"></a>Требования режима оценки (по умолчанию)

|API   | Для кого нужна [лицензия](#required-licenses-for-modela)  | Заложенная емкость | [Стоимость сверхлимитного использования](#price-for-additional-use) | Заметки |
|:-----------------------------|:--------------------------------------------|:----------------|:-------|:------|
| [Уведомления об изменении chatMessage](/graph/api/subscription-post-subscriptions) |  Недоступно | 500 сообщений в месяц на приложение | Недоступно |
| [Уведомления об изменении conversationMember](/graph/api/subscription-post-subscriptions) | Недоступно | 500 сообщений в месяц на приложение | Недоступно | 
| [Получение сообщений во всех чатах для пользователя](/graph/api/chats-getallmessages) |  Недоступно | 500 сообщений в месяц на приложение | Недоступно |  Минимальная плата за 1 сообщение на запрос API. |
| [Получение сообщений по всем каналам](/graph/api/channel-getallmessages).|  Недоступно | 500 сообщений в месяц на приложение | Недоступно |  Минимальная плата за 1 сообщение на запрос API. |
| [Обновление policyViolation для chatMessage](/graph/api/chatmessage-update) |   Недоступно |  500 сообщений в месяц на приложение | Недоступно |

В режиме оценки заложенная емкость распределяется между всеми API. При превышении заложенной емкости в вызовах API с требованиями лицензирования и оплаты возникает сбой с возвратом кода ошибки 402, а подписки с требованиями лицензирования и оплаты не отправляют уведомления об изменениях.

| Тип "ошибка" | Код состояния | Сообщение об ошибке |
|:-----------|:-----------|:-----------------|
|Не выполнены требования к лицензии E5| 402 (требуется оплата) |`User '{userId}' needs a valid license to access this API.`, `Tenant {tenantId} needs a valid license to access this API.`|
|Модель Б не поддерживается для API исправлений| 402 (требуется оплата) |`Query parameter 'model' does not support value 'B' for this API. Use billing model 'A'.`|
|Превышены возможности оценки|402 (требуется оплата)|`Evaluation mode capacity has been exceeded. Use a valid billing model.`|

> [!NOTE]
> Успешный вызов API не означает наличие надлежащего лицензирования. Не все нарушения лицензирования обнаруживаются, а в некоторых случаях может быть предоставлен льготный период.

## <a name="required-licenses-for-modela"></a>Требуемые лицензии для `model=A` 

Пользователю потребуется лицензия, поддерживающая [план обслуживания](/azure/active-directory/enterprise-users/licensing-service-plan-reference) защиты от потери данных Microsoft Communications, например одну из этих [поддерживаемых лицензий](/office365/servicedescriptions/microsoft-365-service-descriptions/microsoft-365-tenantlevel-services-licensing-guidance/microsoft-365-security-compliance-licensing-guidance#microsoft-graph-apis-for-teams-data-loss-prevention-dlp-and-for-teams-export).
Какому именно пользователю нужна лицензия, зависит от API; подробнее см. [Требования `model=A`](#modela-requirements).

Эти требования лицензирования не распространяются на гостевых пользователей.
Они также не распространяются на сообщения, отправленные из-за пределов клиента (в федеративном чате).
Счетчики потребления применяются по-прежнему.

За надлежащее лицензирование пользователей отвечает владелец клиента (а не владелец приложения).
Администраторы могут использовать отчет о лицензиях для защиты информации в [центре администрирования Teams](https://admin.teams.microsoft.com/analytics/reports), чтобы узнать, у каких пользователей нет поддерживаемой лицензии.

Для многих поддерживаемых лицензий предлагаются бесплатные пробные версии. 
Например, в [Office 365 E5](https://www.microsoft.com/microsoft-365/enterprise/office-365-e5?activetab=pivot%3aoverviewtab) имеется ссылка `Free trial` под кнопкой `Buy`.

Бесплатную подписку на песочницу для разработчиков Microsoft 365 E5 с 25 лицензиями пользователей можно получить через [Программу для разработчиков Microsoft 365](https://developer.microsoft.com/microsoft-365/dev-program).

## <a name="improper-licensing-and-evaluation-mode-seeded-capacity-exceeded"></a>Неправильное лицензирование, превышена заложенная емкость режима оценки

При обнаружении неправильного лицензирования вызов API не выполняется и данные не возвращаются.
В частности, в большинстве интерфейсов API попытка вызова GET для пользователя без лицензии возвращает код ошибки 402. Для сообщений, отправленных пользователями без лицензий, не генерируются уведомления об изменении. Кроме того, вызовы API и уведомления об изменении в режиме оценки, превышающие заложенную емкость, не выполняются и не генерируются.

> [!NOTE]
> Успешный вызов API не означает наличие надлежащего лицензирования. Не все нарушения лицензирования обнаруживаются, а в некоторых случаях может быть предоставлен льготный период.
> Точно так же успешное выполнение API в ознакомительном режиме не гарантирует, что вызов находится в пределах выделенной емкости, поскольку в некоторых случаях могут быть предоставлены льготные периоды.

## <a name="seeded-capacity"></a>Заложенная емкость

Заложенная емкость — это объем ресурса, который приложение может использовать до того, как начнет работать счетчик потребления. Емкость объединяется на уровне клиента&mdash;заданная емкость для всех пользователей в клиенте суммируется и сравнивается с использованием приложения в клиенте. Заданная емкость предназначена для каждого приложения для каждого&mdash;клиента. У приложений не будет исчерпана заполненная емкость, если закончится другое приложение.

Заложенная емкость зависит от API, см. [`model=A`требования](#modela-requirements) и [`model=B`требования](#modelb-requirements)

## <a name="price-for-additional-use"></a>Стоимость сверхлимитного использования

В дальнейшем корпорация Майкрософт будет взимать плату за использование сверх заложенной емкости. Вы также сможете связать подписку Azure с регистрацией приложения. Организация, которой принадлежит регистрация приложения, несет ответственность за платеж, который для многоклиентских приложений может отличаться от организации, которая запускает приложение.

## <a name="see-also"></a>См. также

- [Обзор API Microsoft Teams](teams-concept-overview.md)