---
title: Устранение ошибок авторизации в Microsoft Graph
description: Узнайте, как устранить ошибки авторизации в Microsoft Graph 401 и 403.
author: davidmu1
localization_priority: Priority
ms.prod: applications
ms.openlocfilehash: ecc8929c0671cbafed4baa5fc242a9f8515c7652
ms.sourcegitcommit: 32c83957ee69f21a10cd5f759adb884ce4b41c52
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2021
ms.locfileid: "51921681"
---
# <a name="resolve-microsoft-graph-authorization-errors"></a>Устранение ошибок авторизации в Microsoft Graph

Ошибки авторизации могут возникать в результате ряда различных неполадок, большая часть которых приводит к возникновению ошибки 403 (за некоторыми исключениями). Например, ошибки авторизации могут возникнуть в результате следующих неполадок:

* Некорректные [потоки получения маркеров доступа](/azure/active-directory/develop/active-directory-authentication-scenarios)
* Неправильно настроенные [области разрешений](/azure/active-directory/develop/active-directory-v2-scopes)
* Отсутствие [согласия](/azure/active-directory/develop/active-directory-devhowto-multi-tenant-overview#understanding-user-and-admin-consent)
* Отсутствие [разрешений](/azure/active-directory/develop/v2-permissions-and-consent)

## <a name="steps-to-resolve-common-errors"></a>Действия по устранению распространенных ошибок

Чтобы устранить распространенные ошибки авторизации, попробуйте действия, описанные для ошибки, которая больше всего похожа на вашу. Можно использовать описание для нескольких ошибок. Кроме того, можно ознакомиться с ответами, которые уже доступны в разделе «Вопросы и ответы Майкрософт», для [ошибки 401](/answers/search.html?c=&f=&includeChildren=&q=%5bmicrosoft-graph%5d+401+&redirect=search%2fsearch&sort=relevance&type=question+OR+idea+OR+kbentry+OR+answer+OR+topic+OR+user) и [ошибки 403](/answers/search.html?c=&f=&includeChildren=&q=%5bmicrosoft-graph%5d+403&redirect=search%2fsearch&sort=relevance&type=question+OR+idea+OR+kbentry+OR+answer+OR+topic+OR+user). Если вам не удается найти решение проблемы, задайте[ новый вопрос на через раздел «Вопросы и ответы Майкрософт»](/answers/products/m365#microsoft-graph) с тегом *microsoft-graph**.

**Ошибка "401 — недостаточно прав": является ли маркер допустимым?** <br>

Убедитесь, что приложение выводит допустимый маркер доступа к Microsoft Graph в рамках запроса. Эта ошибка часто означает, что маркер доступа отсутствует в заголовке HTTP-запроса на проверку подлинности, что он недопустим или срок его действия истек. Мы настоятельно рекомендуем использовать [Библиотеку проверки подлинности Майкрософт (MSAL)](/azure/active-directory/develop/msal-overview) для получения маркеров доступа. Кроме того, эта ошибка может возникать при попытке использовать маркер делегированного доступа, предоставленный личной учетной записи Майкрософт, для доступа к API, который поддерживает только рабочие или учебные учетные записи (учетные записи организации). 

**Ошибка "403 — запрещено": выбран ли соответствующий набор разрешений?**<br>

Убедитесь, что вы запросили правильный набор разрешений на основе API Microsoft Graph, который вызывает приложение. Минимальные разрешения, которые мы рекомендуем, рассматриваются во всех статьях, посвященных методу API Microsoft Graph. Кроме того, эти разрешения должны быть предоставлены приложению пользователем или администратором. Для предоставления разрешений обычно используется страница подтверждения или колонка "Регистрация приложений" на портале Azure. В колонке для приложения **Параметры** выберите **Необходимые разрешения** > **Предоставить разрешения**. <br>

* [Разрешения Microsoft Graph](./permissions-reference.md) <br>
* [Общие сведения о разрешениях Azure AD и согласии](/azure/active-directory/develop/v2-permissions-and-consent) <br>

**Ошибка "403 — запрещено": получило ли приложение маркер для соответствия выбранным разрешениям?** <br>

Убедитесь, что тип запрошенных или предоставленных разрешений совпадает с типом маркера доступа, который получает приложение. Возможно, вы запрашиваете и предоставляете разрешения для приложения, но используете маркеры потоков делегированного интерактивного кода вместо маркеров потоков учетных данных клиента, или запрашиваете и предоставляете делегированные разрешения, но используете маркеры потоков учетных данных клиента вместо маркеров потоков делегированного кода. <br>
* [Получение доступа от имени пользователей и делегированные разрешения](/graph/auth_v2_user) 
* [Azure AD версии 2.0 — поток кода авторизации OAuth 2.0](/azure/active-directory/develop/v2-oauth2-auth-code-flow)
* [Получение доступа без пользователя (служба управляющей программы) и разрешения приложения](/graph/auth_v2_service)
* [Azure AD версии 2.0 — поток учетных данных клиента OAuth 2.0](/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow)

**Ошибка "403 — запрещено": сброс пароля** <br>

В настоящее время нет разрешений для служб программы, управляющей разрешениями приложения, которые позволяют сбросить пароли пользователей. Эти API поддерживаются только с помощью потоков интерактивного делегированного кода для администратора, выполнившего вход.

* [Разрешения Microsoft Graph](./permissions-reference.md) <br>

**Ошибка "403 — запрещено": есть ли доступ у пользователя, и имеет ли он лицензию?** <br>

Microsoft Graph определяет, разрешено ли выполнение запроса для потоков делегированного кода, на основании разрешений, предоставленных приложению, и разрешений, имеющихся у пользователя, выполнившего вход. Как правило, эта ошибка указывает на то, что пользователь не обладает достаточными правами для выполнения запроса **или** что у пользователя нет лицензии на доступ к данным. Только пользователи с необходимыми разрешениями или лицензиями могут успешно выполнить запрос.

**Ошибка "403 — запрещено": выбран ли правильный API ресурсов?** <br>

Службы API, такие как Microsoft Graph, проверяют, чтобы утверждение *aud* (audience) в полученном маркере доступа соответствовало ожидаемому значению, в противном случае возникает ошибка `403 Forbidden`. Чаще всего эта ошибка возникает при попытке использовать маркер, полученный для API Azure AD Graph, API Outlook или API SharePoint/OneDrive, для вызова Microsoft Graph (или наоборот). Убедитесь, что ресурс (или область), для которого приложение получает маркер, соответствует API, который вызывает приложение.

**Ошибка "400 — ошибочный запрос" или "403 — запрещено": выполняет ли пользователь требования политики условного доступа своей организации?**<br>

На основании политик условного доступа организации у пользователя, получающего доступ к ресурсам Microsoft Graph через ваше приложение, могут быть запрошены дополнительные сведения, отсутствующие в маркере доступа, который изначально был получен вашим приложением. В этом случае приложение получает сообщение об ошибке 400 с *interaction_required* при получении маркера доступа или сообщение об ошибке 403 с *insufficient_claims* при вызове Microsoft Graph. В обоих случаях сообщение об ошибке содержит дополнительные сведения, которые могут быть представлены в конечную точку авторизации, чтобы запросить у пользователя дополнительную информацию (например, многофакторная проверка подлинности или регистрация устройства).

* [Обработка запросов условного доступа с помощью MSAL](/azure/active-directory/develop/msal-handling-exceptions#conditional-access-and-claims-challenges)
* [Руководство для разработчиков по условному доступу в Azure Active Directory](/azure/active-directory/develop/conditional-access-dev-guide)
