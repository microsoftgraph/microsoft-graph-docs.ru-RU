---
title: Отслеживание изменений в данных Microsoft Graph с помощью разностного запроса
description: Запросы изменений позволяют приложениям обнаруживать новые, обновленные и удаленные сущности, не считывая целевой ресурс полностью при каждом запросе. Приложения Microsoft Graph могут использовать запросы изменений, чтобы эффективно синхронизировать изменения с локальным хранилищем данных.
author: davidmu1
localization_priority: Priority
ms.custom: graphiamtop20
ms.openlocfilehash: cceab6a803b403560c6a72831584c99202d65618
ms.sourcegitcommit: 34891a1c601976166958be1aa04bab5936592b44
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2021
ms.locfileid: "52231992"
---
# <a name="use-delta-query-to-track-changes-in-microsoft-graph-data"></a><span data-ttu-id="21e6f-104">Отслеживание изменений в данных Microsoft Graph с помощью разностного запроса</span><span class="sxs-lookup"><span data-stu-id="21e6f-104">Use delta query to track changes in Microsoft Graph data</span></span>

<span data-ttu-id="21e6f-p102">Запросы изменений позволяют приложениям обнаруживать новые, обновленные и удаленные сущности, не считывая целевой ресурс полностью при каждом запросе. Приложения Microsoft Graph могут использовать запросы изменений, чтобы эффективно синхронизировать изменения с локальным хранилищем данных.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p102">Delta query enables applications to discover newly created, updated, or deleted entities without performing a full read of the target resource with every request. Microsoft Graph applications can use delta query to efficiently synchronize changes with a local data store.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="21e6f-107">Руководство. Использование уведомлений об изменениях и функции отслеживания изменений в Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="21e6f-107">Tutorial: Use Change Notifications and Track Changes with Microsoft Graph</span></span>](/learn/modules/msgraph-changenotifications-trackchanges)

## <a name="use-delta-query-to-track-changes-in-a-resource-collection"></a><span data-ttu-id="21e6f-108">Отслеживание изменений в коллекции ресурсов с помощью запроса изменений</span><span class="sxs-lookup"><span data-stu-id="21e6f-108">Use delta query to track changes in a resource collection</span></span>

<span data-ttu-id="21e6f-109">Ниже представлен типичный шаблон вызова.</span><span class="sxs-lookup"><span data-stu-id="21e6f-109">The typical call pattern is as follows:</span></span>

1. <span data-ttu-id="21e6f-110">Для начала приложение выполняет запрос GET с функцией delta для нужного ресурса.</span><span class="sxs-lookup"><span data-stu-id="21e6f-110">The application begins by calling a GET request with the delta function on the desired resource.</span></span>
2. <span data-ttu-id="21e6f-111">Microsoft Graph отправит ответ, содержащий нужный ресурс и [маркер состояния](#state-tokens).</span><span class="sxs-lookup"><span data-stu-id="21e6f-111">Microsoft Graph sends a response containing the requested resource and a [state token](#state-tokens).</span></span>

     <span data-ttu-id="21e6f-p103">-  Если возвращается URL-адрес `nextLink`, это означает, что во время сеанса могли быть получены не все страницы данных. Для получения всех страниц данных приложение продолжает отправлять запросы, используя URL-адрес `nextLink`, пока в отклик не будет включен URL-адрес `deltaLink`.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p103">a.  If a `nextLink` URL is returned, there may be additional pages of data to be retrieved in the session. The application continues making requests using the `nextLink` URL to retrieve all pages of data until a `deltaLink` URL is returned in the response.</span></span>

     <span data-ttu-id="21e6f-p104">- Если возвращается URL-адрес `deltaLink`, это означает, что больше нет данных о текущем состоянии ресурса. В последующих запросах приложение использует URL-адрес `deltaLink`, чтобы узнавать об изменениях ресурса.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p104">b.  If a `deltaLink` URL is returned, there is no more data about the existing state of the resource to be returned. For future requests, the application uses the `deltaLink` URL to learn about changes to the resource.</span></span>

3. <span data-ttu-id="21e6f-p105">Когда приложению требуется узнать об изменениях ресурса, оно совершает новый запрос, используя URL-адрес `deltaLink`, полученный на шаге 2. Этот запрос *может* быть совершен сразу по завершении шага 2 или когда приложение проверяет наличие изменений.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p105">When the application needs to learn about changes to the resource, it makes a new request using the `deltaLink` URL received in step 2. This request *may* be made immediately after completing step 2 or when the application checks for changes.</span></span>
4. <span data-ttu-id="21e6f-120">Microsoft Graph возвращает описание изменений ресурса с момента последнего запроса вместе с URL-адресом `nextLink` или `deltaLink`.</span><span class="sxs-lookup"><span data-stu-id="21e6f-120">Microsoft Graph returns a response describing changes to the resource since the previous request, and either a `nextLink` URL or a `deltaLink` URL.</span></span>

><span data-ttu-id="21e6f-121">**Примечание.** Ресурсы, хранящиеся в Azure Active Directory (например, пользователи и группы), поддерживают сценарии "синхронизировать с этого момента".</span><span class="sxs-lookup"><span data-stu-id="21e6f-121">**Note:** Resources stored in Azure Active Directory (such as users and groups) support "sync from now" scenarios.</span></span> <span data-ttu-id="21e6f-122">Это позволит пропустить действия 1 и 2 (если вы не хотите получать полное состояние ресурса) и запросить последнюю `deltaLink`.</span><span class="sxs-lookup"><span data-stu-id="21e6f-122">This allows you to skip steps 1 and 2 (if you're not interested in retrieving the full state of the resource) and ask for the latest `deltaLink` instead.</span></span> <span data-ttu-id="21e6f-123">Добавьте `$deltaToken=latest` к функции `delta`, и ответ будет содержать ссылку `deltaLink`, но не будет содержать данные ресурсов.</span><span class="sxs-lookup"><span data-stu-id="21e6f-123">Append `$deltaToken=latest` to the `delta` function and the response will contain a `deltaLink` and no resource data.</span></span> <span data-ttu-id="21e6f-124">Ресурсы в OneDrive и SharePoint также поддерживают эту функцию.</span><span class="sxs-lookup"><span data-stu-id="21e6f-124">Resources in OneDrive and SharePoint also support this feature.</span></span> <span data-ttu-id="21e6f-125">Для ресурсов в OneDrive и SharePoint вместо этого добавьте `token=latest`.</span><span class="sxs-lookup"><span data-stu-id="21e6f-125">For resources in OneDrive and SharePoint, append `token=latest` instead.</span></span>

><span data-ttu-id="21e6f-126">**Примечание:** Функция запроса изменений обычно упоминается путем добавления `/delta` к имени ресурса.</span><span class="sxs-lookup"><span data-stu-id="21e6f-126">**Note:** The delta query function is generally referred to by appending `/delta` to the resource name.</span></span> <span data-ttu-id="21e6f-127">Тем не менее, `/delta` - это сокращение для полного имени`/microsoft.graph.delta`, которое вы видите в запросах, генерируемых Microsoft Graph SDK.</span><span class="sxs-lookup"><span data-stu-id="21e6f-127">However, `/delta` is a shortcut for the fully qualified name `/microsoft.graph.delta` that you see in requests generated by the Microsoft Graph SDKs.</span></span>

><span data-ttu-id="21e6f-128">**Примечание.** Исходный запрос к функции разностного запроса (без разностного маркера или с игнорируемым маркером) возвращает ресурсы, которые в настоящее время существуют в коллекции.</span><span class="sxs-lookup"><span data-stu-id="21e6f-128">**Note:** The initial request to the delta query function (no delta or skip token) will return the resources that currently exist in the collection.</span></span> <span data-ttu-id="21e6f-129">Ресурсы, созданные и удаленные до исходного разностного запроса, не возвращаются.</span><span class="sxs-lookup"><span data-stu-id="21e6f-129">Resources that have been created and deleted prior to the initial delta query won't be returned.</span></span> <span data-ttu-id="21e6f-130">Обновления, внесенные до исходного запроса, обобщаются в возвращаемом ресурсе в их последнем состоянии. </span><span class="sxs-lookup"><span data-stu-id="21e6f-130">Updates made before the initial request are summarized on the resource returned as its latest state.</span></span>

### <a name="state-tokens"></a><span data-ttu-id="21e6f-131">Маркеры состояния</span><span class="sxs-lookup"><span data-stu-id="21e6f-131">State tokens</span></span>

<span data-ttu-id="21e6f-p109">Ответ GET на запрос изменений всегда включает URL-адрес, указанный в заголовке `nextLink` или `deltaLink`. URL-адрес `nextLink` включает маркер _skipToken_, а URL-адрес `deltaLink` — _deltaToken_.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p109">A delta query GET response always includes a URL specified in a `nextLink` or `deltaLink` response header. The `nextLink` URL includes a _skipToken_, and a `deltaLink` URL includes a _deltaToken_.</span></span>

<span data-ttu-id="21e6f-p110">Эти маркеры непрозрачны для клиента. Вот что вам нужно знать о них:</span><span class="sxs-lookup"><span data-stu-id="21e6f-p110">These tokens are opaque to the client. The following details are what you need to know about them:</span></span>

- <span data-ttu-id="21e6f-136">Каждый маркер отражает состояние и представляет моментальный снимок ресурса в этом цикле отслеживания изменений.</span><span class="sxs-lookup"><span data-stu-id="21e6f-136">Each token reflects the state and represents a snapshot of the resource in that round of change tracking.</span></span>

- <span data-ttu-id="21e6f-p111">Маркеры состояния также кодируют и включают другие параметры запроса (такие как `$select`), указанные в исходном запросе изменений. Таким образом, не обязательно повторять их в последующих запросах изменений.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p111">The state tokens also encode and include other query parameters (such as `$select`) specified in the initial delta query request. Therefore, it's not required to repeat them in subsequent delta query requests.</span></span>

- <span data-ttu-id="21e6f-139">Совершая запрос изменений, вы можете скопировать и применить URL-адрес `nextLink` или `deltaLink` при следующем вызове функции **delta**, не проверяя содержимое URL-адреса, в том числе маркер состояния.</span><span class="sxs-lookup"><span data-stu-id="21e6f-139">When carrying out delta query, you can copy and apply the `nextLink` or `deltaLink` URL to the next **delta** function call without having to inspect the contents of the URL, including its state token.</span></span>

### <a name="optional-query-parameters"></a><span data-ttu-id="21e6f-140">Необязательные параметры запросов</span><span class="sxs-lookup"><span data-stu-id="21e6f-140">Optional query parameters</span></span>

<span data-ttu-id="21e6f-p112">Если клиент использует параметр запроса, он должен быть указан в исходном запросе. Microsoft Graph автоматически кодирует указанный параметр в ссылке `nextLink` или `deltaLink`, указанной в ответе. Вызывающему приложению достаточно один раз указать параметры запроса. Microsoft Graph автоматически добавляет указанные параметры для всех последующих запросов.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p112">If a client uses a query parameter, it must be specified in the initial request. Microsoft Graph automatically encodes the specified parameter into the `nextLink` or `deltaLink` provided in the response. The calling application only needs to specify the query parameters once upfront. Microsoft Graph adds the specified parameters automatically for all subsequent requests.</span></span>

<span data-ttu-id="21e6f-145">Обратите внимание на общую ограниченную поддержку следующих необязательных параметров запроса:</span><span class="sxs-lookup"><span data-stu-id="21e6f-145">Note the general limited support of the following optional query parameters:</span></span>

- `$orderby`

    <span data-ttu-id="21e6f-146">Не считайте, что разностный запрос возвращает определенную последовательность ответов.</span><span class="sxs-lookup"><span data-stu-id="21e6f-146">Do not assume a specific sequence of the responses returned from a delta query.</span></span> <span data-ttu-id="21e6f-147">Предполагайте, что один и тот же элемент может встречаться в любом месте последовательности `nextLink`, и учитывайте это в логике объединения.</span><span class="sxs-lookup"><span data-stu-id="21e6f-147">Assume that the same item can show up anywhere in the `nextLink` sequence and handle that in your merge logic.</span></span>
- `$top`

    <span data-ttu-id="21e6f-148">Число объектов на каждой странице зависит от типа ресурса и типа изменений, внесенных в ресурс.</span><span class="sxs-lookup"><span data-stu-id="21e6f-148">The number of objects in each page can vary depending on the resource type and the type of changes made to the resource.</span></span>

<span data-ttu-id="21e6f-149">См. сведения о [поддержке параметров разностного запроса](delta-query-messages.md#use-query-parameters-in-a-delta-query-for-messages) для ресурса [message](/graph/api/resources/message?view=graph-rest-1.0).</span><span class="sxs-lookup"><span data-stu-id="21e6f-149">For the [message](/graph/api/resources/message?view=graph-rest-1.0) resource, see details for [query parameters support in a delta query](delta-query-messages.md#use-query-parameters-in-a-delta-query-for-messages).</span></span>

<span data-ttu-id="21e6f-150">Для ресурсов [user](/graph/api/resources/user?view=graph-rest-1.0) и [group](/graph/api/resources/group?view=graph-rest-1.0) действуют ограничения на применение некоторых параметров запроса:</span><span class="sxs-lookup"><span data-stu-id="21e6f-150">For the [user](/graph/api/resources/user?view=graph-rest-1.0) and [group](/graph/api/resources/group?view=graph-rest-1.0) resources, there are restrictions on using some query parameters:</span></span>

- <span data-ttu-id="21e6f-151">Параметр `$expand` не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="21e6f-151">`$expand` is not supported.</span></span>
- <span data-ttu-id="21e6f-152">Параметр `$top` не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="21e6f-152">`$top` is not supported.</span></span>
- <span data-ttu-id="21e6f-153">Параметр `$orderby` не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="21e6f-153">`$orderby` is not supported.</span></span>
- <span data-ttu-id="21e6f-p114">Если используется параметр запроса `$select`, это означает, что клиент предпочитает отслеживать изменения только для тех свойств или связей, которые указаны в операторе `$select`. При изменении свойства, которое не было выбрано, соответствующий ресурс не появится в отклике с различиями при последующем запросе.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p114">If a `$select` query parameter is used, the parameter indicates that the client prefers to only track changes on the properties or relationships specified in the `$select` statement. If a change occurs to a property that is not selected, the resource for which that property changed does not appear in the delta response after a subsequent request.</span></span>
- <span data-ttu-id="21e6f-156">`$select` также поддерживает навигационные свойства `manager` и `members` для пользователей и групп соответственно.</span><span class="sxs-lookup"><span data-stu-id="21e6f-156">`$select` also supports `manager` and `members` navigational property for users and groups respectively.</span></span> <span data-ttu-id="21e6f-157">Выбор этих свойств позволяет отслеживать изменения руководства и участия в группах для пользователя.</span><span class="sxs-lookup"><span data-stu-id="21e6f-157">Selecting those properties allows tracking of changes to user's manager and group memberships.</span></span>

- <span data-ttu-id="21e6f-p116">Фильтры области позволяют отслеживать изменения одного или нескольких конкретных пользователей или групп с помощью идентификатора объекта. Например, следующий запрос возвращает изменения для групп, соответствующих идентификаторам, указанным в фильтре запроса.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p116">Scoping filters allow you to track changes to one or more specific users or groups by object ID. For example, the following request returns changes for the groups matching the IDs specified in the query filter.</span></span>

<!-- {
  "blockType": "request",
  "name": "group_delta"
}-->
```http
https://graph.microsoft.com/beta/groups/delta/?$filter=id eq '477e9fc6-5de7-4406-bb2a-7e5c83c9ae5f' or id eq '004d6a07-fe70-4b92-add5-e6e37b8acd8e'
```

## <a name="resource-representation-in-the-delta-query-response"></a><span data-ttu-id="21e6f-160">Представление ресурсов в отклике на разностный запрос</span><span class="sxs-lookup"><span data-stu-id="21e6f-160">Resource representation in the delta query response</span></span>

- <span data-ttu-id="21e6f-161">Новые экземпляры поддерживаемого ресурса представлены в ответе на запрос изменений с помощью стандартных свойств.</span><span class="sxs-lookup"><span data-stu-id="21e6f-161">Newly created instances of a supported resource are represented in the delta query response using their standard representation.</span></span>

- <span data-ttu-id="21e6f-162">Обновленные экземпляры представлены **id** и *по крайней мере* обновленными свойствами, но могут быть включены и другие свойства.</span><span class="sxs-lookup"><span data-stu-id="21e6f-162">Updated instances are represented by their **id** with *at least* the properties that have been updated, but additional properties may be included.</span></span>

- <span data-ttu-id="21e6f-p117">Связи между пользователями и группами представлены в виде заметок к стандартному представлению ресурса. Эти заметки представлены в формате `propertyName@delta`. Они включаются в отклик на исходный разностный запрос.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p117">Relationships on users and groups are represented as annotations on the standard resource representation. These annotations use the format `propertyName@delta`. The annotations are included in the response of the initial delta query request.</span></span>

<span data-ttu-id="21e6f-p118">Удаленные экземпляры представлены только **id** и объектом `@removed`. Объект `@removed` может содержать дополнительные сведения о том, почему удален экземпляр. Например, "@removed": {"reason": "changed"}.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p118">Removed instances are represented by their **id** and an `@removed` object. The `@removed` object may include additional information about why the instance was removed. For example,  "@removed": {"reason": "changed"}.</span></span>

<span data-ttu-id="21e6f-169">Возможные причины @removed: *changed* или *deleted*.</span><span class="sxs-lookup"><span data-stu-id="21e6f-169">Possible @removed reasons can be *changed* or *deleted*.</span></span>

- <span data-ttu-id="21e6f-170">*changed* указывает, что элемент удален и может быть восстановлен из [deletedItems](/graph/api/resources/directory).</span><span class="sxs-lookup"><span data-stu-id="21e6f-170">*Changed* indicates the item was deleted and can be restored from [deletedItems](/graph/api/resources/directory).</span></span>

- <span data-ttu-id="21e6f-171">*deleted* указывает, что элемент удален и не может быть восстановлен.</span><span class="sxs-lookup"><span data-stu-id="21e6f-171">*Deleted* indicates the item is deleted and cannot be restored.</span></span>

<span data-ttu-id="21e6f-p119">Объект `@removed` может возвращаться в отклике на исходный разностный запрос и в отслеживаемых откликах (deltaLink). Клиенты, использующие разностные запросы, должны иметь возможность обрабатывать эти объекты в откликах.</span><span class="sxs-lookup"><span data-stu-id="21e6f-p119">The `@removed` object can be returned in the initial delta query response and in tracked (deltaLink) responses. Clients using delta query requests should be designed to handle these objects in the responses.</span></span>

><span data-ttu-id="21e6f-174">**Примечание:** Возможно, что одна сущность будет содержаться в ответе несколько раз, если эта сущность менялась несколько раз и при определенных условиях.</span><span class="sxs-lookup"><span data-stu-id="21e6f-174">**Note:** It's possible that a single entity will be contained multiple times in the response, if that entity was changed multiple times and under certain conditions.</span></span> <span data-ttu-id="21e6f-175">Запрос изменений позволяют вашему приложению перечислять все изменения, но не могут гарантировать, что объекты объединены в одном ответе.</span><span class="sxs-lookup"><span data-stu-id="21e6f-175">Delta queries enable your application to list all the changes, but can't ensure that entities are unified in a single response.</span></span>

## <a name="supported-resources"></a><span data-ttu-id="21e6f-176">Поддерживаемые ресурсы</span><span class="sxs-lookup"><span data-stu-id="21e6f-176">Supported resources</span></span>

<span data-ttu-id="21e6f-177">Разностные запросы поддерживаются для указанных ниже ресурсов.</span><span class="sxs-lookup"><span data-stu-id="21e6f-177">Delta query is currently supported for the following resources.</span></span> <span data-ttu-id="21e6f-178">Обратите внимание, что у некоторых ресурсов, доступных в версии 1.0, соответствующие функции **delta** по-прежнему находятся в предварительном состоянии (как указано).</span><span class="sxs-lookup"><span data-stu-id="21e6f-178">Note that some resources which are available in v1.0 have their corresponding **delta** functions still in preview status, as indicated.</span></span>

| <span data-ttu-id="21e6f-179">**Коллекция ресурсов**</span><span class="sxs-lookup"><span data-stu-id="21e6f-179">**Resource collection**</span></span>                                        | <span data-ttu-id="21e6f-180">**API**</span><span class="sxs-lookup"><span data-stu-id="21e6f-180">**API**</span></span>                                                                                                                                                      |
| :------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <span data-ttu-id="21e6f-181">Приложения</span><span class="sxs-lookup"><span data-stu-id="21e6f-181">Applications</span></span>                                                   | <span data-ttu-id="21e6f-182">Функция [delta](/graph/api/application-delta) ресурса [application](/graph/api/resources/application)</span><span class="sxs-lookup"><span data-stu-id="21e6f-182">[delta](/graph/api/application-delta) function of the [application](/graph/api/resources/application) resource</span></span>                                               |
| <span data-ttu-id="21e6f-183">Административные единицы (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="21e6f-183">Administrative units (preview)</span></span>                                 | <span data-ttu-id="21e6f-184">Функция [delta](/graph/api/administrativeunit-delta) (предварительная версия) ресурса [administrativeUnit](/graph/api/resources/administrativeunit)</span><span class="sxs-lookup"><span data-stu-id="21e6f-184">[delta](/graph/api/administrativeunit-delta) function (preview) of the [administrativeUnit](/graph/api/resources/administrativeunit) resource</span></span>                |
| <span data-ttu-id="21e6f-185">Сообщения чата в канале</span><span class="sxs-lookup"><span data-stu-id="21e6f-185">Chat messages in a channel</span></span>                                     | <span data-ttu-id="21e6f-186">Функция [delta](/graph/api/chatmessage-delta) (предварительная версия) ресурса [chatMessage](/graph/api/resources/chatmessage)</span><span class="sxs-lookup"><span data-stu-id="21e6f-186">[delta](/graph/api/chatmessage-delta) function (preview) of the [chatMessage](/graph/api/resources/chatmessage)</span></span>                                              |
| <span data-ttu-id="21e6f-187">Объекты каталога</span><span class="sxs-lookup"><span data-stu-id="21e6f-187">Directory objects</span></span>                                              | <span data-ttu-id="21e6f-188">Функция [delta](/graph/api/directoryobject-delta) (предварительная версия) ресурса [directoryObject](/graph/api/resources/directoryobject)</span><span class="sxs-lookup"><span data-stu-id="21e6f-188">[delta](/graph/api/directoryobject-delta) function (preview) of the [directoryObject](/graph/api/resources/directoryobject) resource</span></span>                         |
| <span data-ttu-id="21e6f-189">Перечисление ролей каталога</span><span class="sxs-lookup"><span data-stu-id="21e6f-189">Directory roles</span></span>                                                | <span data-ttu-id="21e6f-190">Функция [delta](/graph/api/directoryrole-delta?view=graph-rest-1.0) ресурса [directoryObjects](/graph/api/resources/directoryrole?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-190">[delta](/graph/api/directoryrole-delta?view=graph-rest-1.0) function of the [directoryRole](/graph/api/resources/directoryrole?view=graph-rest-1.0) resource</span></span> |
| <span data-ttu-id="21e6f-191">Элементы на диске\*</span><span class="sxs-lookup"><span data-stu-id="21e6f-191">Drive items\*</span></span>                                                  | <span data-ttu-id="21e6f-192">Функция [delta](/graph/api/driveitem-delta?view=graph-rest-1.0) ресурса [driveItem](/graph/api/resources/driveitem?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-192">[delta](/graph/api/driveitem-delta?view=graph-rest-1.0) function of the [driveItem](/graph/api/resources/driveitem?view=graph-rest-1.0) resource</span></span>             |
| <span data-ttu-id="21e6f-193">Классы образовательных учреждений</span><span class="sxs-lookup"><span data-stu-id="21e6f-193">Education Classes</span></span>                                              | <span data-ttu-id="21e6f-194">Функция [delta](/graph/api/educationclass-delta) ресурса [educationClass](/graph/api/resources/educationclass)</span><span class="sxs-lookup"><span data-stu-id="21e6f-194">[delta](/graph/api/educationclass-delta) function of the [educationClass](/graph/api/resources/educationclass) resource</span></span>                                      |
| <span data-ttu-id="21e6f-195">Пользователи образовательных учреждений</span><span class="sxs-lookup"><span data-stu-id="21e6f-195">Education Users</span></span>                                                | <span data-ttu-id="21e6f-196">Функция [delta](/graph/api/educationuser-delta) ресурса [educationUser](/graph/api/resources/educationuser)</span><span class="sxs-lookup"><span data-stu-id="21e6f-196">[delta](/graph/api/educationuser-delta) function of the [educationUser](/graph/api/resources/educationuser) resource</span></span>                                         |
| <span data-ttu-id="21e6f-197">Учебные заведения</span><span class="sxs-lookup"><span data-stu-id="21e6f-197">Education Schools</span></span>                                              | <span data-ttu-id="21e6f-198">Функция [delta](/graph/api/educationschool-delta) ресурса [educationSchool](/graph/api/resources/educationschool)</span><span class="sxs-lookup"><span data-stu-id="21e6f-198">[delta](/graph/api/educationschool-delta) function of the [educationSchool](/graph/api/resources/educationschool) resource</span></span>                                   |
| <span data-ttu-id="21e6f-199">События в представлении (диапазоне дат) основного календаря</span><span class="sxs-lookup"><span data-stu-id="21e6f-199">Events in a calendar view (date range) of the primary calendar</span></span> | <span data-ttu-id="21e6f-200">Функция [delta](/graph/api/event-delta?view=graph-rest-1.0) ресурса [event](/graph/api/resources/event?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-200">[delta](/graph/api/event-delta?view=graph-rest-1.0) function of the [event](/graph/api/resources/event?view=graph-rest-1.0) resource</span></span>                         |
| <span data-ttu-id="21e6f-201">Группы</span><span class="sxs-lookup"><span data-stu-id="21e6f-201">Groups</span></span>                                                         | <span data-ttu-id="21e6f-202">Функция [delta](/graph/api/group-delta?view=graph-rest-1.0) ресурса [group](/graph/api/resources/group?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-202">[delta](/graph/api/group-delta?view=graph-rest-1.0) function of the [group](/graph/api/resources/group?view=graph-rest-1.0) resource</span></span>                         |
| <span data-ttu-id="21e6f-203">Папки почты</span><span class="sxs-lookup"><span data-stu-id="21e6f-203">Mail folders</span></span>                                                   | <span data-ttu-id="21e6f-204">Функция [delta](/graph/api/mailfolder-delta?view=graph-rest-1.0) ресурса [mailFolder](/graph/api/resources/mailfolder?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-204">[delta](/graph/api/mailfolder-delta?view=graph-rest-1.0) function of the [mailFolder](/graph/api/resources/mailfolder?view=graph-rest-1.0) resource</span></span>          |
| <span data-ttu-id="21e6f-205">Сообщения в папке</span><span class="sxs-lookup"><span data-stu-id="21e6f-205">Messages in a folder</span></span>                                           | <span data-ttu-id="21e6f-206">Функция [delta](/graph/api/message-delta?view=graph-rest-1.0) ресурса [message](/graph/api/resources/message?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-206">[delta](/graph/api/message-delta?view=graph-rest-1.0) function of the [message](/graph/api/resources/message?view=graph-rest-1.0) resource</span></span>                   |
| <span data-ttu-id="21e6f-207">Контакты организации</span><span class="sxs-lookup"><span data-stu-id="21e6f-207">Organizational contacts</span></span>                                        | <span data-ttu-id="21e6f-208">функция[delta](/graph/api/orgcontact-delta?view=graph-rest-1.0) ресурса [orgContact](/graph/api/resources/orgcontact?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-208">[delta](/graph/api/orgcontact-delta?view=graph-rest-1.0) function of the [orgContact](/graph/api/resources/orgcontact?view=graph-rest-1.0) resource</span></span>          |
| <span data-ttu-id="21e6f-209">OAuth2PermissionGrants</span><span class="sxs-lookup"><span data-stu-id="21e6f-209">OAuth2PermissionGrants</span></span>                                         | <span data-ttu-id="21e6f-210">Функция [delta](/graph/api/oauth2permissiongrant-delta) ресурса [oauth2permissiongrant](/graph/api/resources/oauth2permissiongrant)</span><span class="sxs-lookup"><span data-stu-id="21e6f-210">[delta](/graph/api/oauth2permissiongrant-delta) function of the [oauth2permissiongrant](/graph/api/resources/oauth2permissiongrant) resource</span></span>                 |
| <span data-ttu-id="21e6f-211">Папки личных контактов</span><span class="sxs-lookup"><span data-stu-id="21e6f-211">Personal contact folders</span></span>                                       | <span data-ttu-id="21e6f-212">Функция [delta](/graph/api/contactfolder-delta?view=graph-rest-1.0) ресурса [contactFolder](/graph/api/resources/contactfolder?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-212">[delta](/graph/api/contactfolder-delta?view=graph-rest-1.0) function of the [contactFolder](/graph/api/resources/contactfolder?view=graph-rest-1.0) resource</span></span> |
| <span data-ttu-id="21e6f-213">Личные контакты в папке</span><span class="sxs-lookup"><span data-stu-id="21e6f-213">Personal contacts in a folder</span></span>                                  | <span data-ttu-id="21e6f-214">Функция [delta](/graph/api/contact-delta?view=graph-rest-1.0) ресурса [contact](/graph/api/resources/contact?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-214">[delta](/graph/api/contact-delta?view=graph-rest-1.0) function of the [contact](/graph/api/resources/contact?view=graph-rest-1.0) resource</span></span>                   |
| <span data-ttu-id="21e6f-215">Элементы Planner\*\* (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="21e6f-215">Planner items\*\* (preview)</span></span>                                    | <span data-ttu-id="21e6f-216">Функция [delta](/graph/api/planneruser-list-delta) (предварительная версия) всего сегмента ресурса [plannerUser](/graph/api/resources/planneruser)</span><span class="sxs-lookup"><span data-stu-id="21e6f-216">[delta](/graph/api/planneruser-list-delta) function (preview) of the all segment of [plannerUser](/graph/api/resources/planneruser) resource</span></span>                 |
| <span data-ttu-id="21e6f-217">Субъекты-службы</span><span class="sxs-lookup"><span data-stu-id="21e6f-217">Service principals</span></span>                                             | <span data-ttu-id="21e6f-218">Функция [delta](/graph/api/serviceprincipal-delta) ресурса [servicePrincipal](/graph/api/resources/serviceprincipal)</span><span class="sxs-lookup"><span data-stu-id="21e6f-218">[delta](/graph/api/serviceprincipal-delta) function of the [servicePrincipal](/graph/api/resources/serviceprincipal) resource</span></span>                                |
| <span data-ttu-id="21e6f-219">Задачи в списке задач</span><span class="sxs-lookup"><span data-stu-id="21e6f-219">Tasks in a task list</span></span>                                           | <span data-ttu-id="21e6f-220">Функция [delta](/graph/api/todotask-delta) ресурса [todoTask](/graph/api/resources/todotask)</span><span class="sxs-lookup"><span data-stu-id="21e6f-220">[delta](/graph/api/todotask-delta) function of the [todoTask](/graph/api/resources/todotask) resource</span></span>                                                        |
| <span data-ttu-id="21e6f-221">Списки задач</span><span class="sxs-lookup"><span data-stu-id="21e6f-221">Task lists</span></span>                                                     | <span data-ttu-id="21e6f-222">Функция [delta](/graph/api/todotasklist-delta) ресурса [todoTaskList](/graph/api/resources/todotasklist)</span><span class="sxs-lookup"><span data-stu-id="21e6f-222">[delta](/graph/api/todotasklist-delta) function of the [todoTaskList](/graph/api/resources/todotasklist) resource</span></span>                                            |
| <span data-ttu-id="21e6f-223">Пользователи</span><span class="sxs-lookup"><span data-stu-id="21e6f-223">Users</span></span>                                                          | <span data-ttu-id="21e6f-224">Функция [delta](/graph/api/user-delta?view=graph-rest-1.0) ресурса [user](/graph/api/resources/user?view=graph-rest-1.0)</span><span class="sxs-lookup"><span data-stu-id="21e6f-224">[delta](/graph/api/user-delta?view=graph-rest-1.0) function of the [user](/graph/api/resources/user?view=graph-rest-1.0) resource</span></span>                            |


> <span data-ttu-id="21e6f-p122">\* Небольшие различия в использовании ресурсов OneDrive и других поддерживаемых ресурсов касаются синтаксиса. Разностный запрос для дисков будет обновлен в соответствии с запросами для других типов ресурсов. Дополнительные сведения о текущем синтаксисе см. в статье [Отслеживание изменений на диске](/graph/api/driveitem-delta?view=graph-rest-1.0).</span><span class="sxs-lookup"><span data-stu-id="21e6f-p122">\* The usage pattern for OneDrive resources is similar to the other supported resources with some minor syntax differences. Delta query for drives will be updated in the future to be consistent with other resource types. For more detail about the current syntax, see [Track changes for a drive](/graph/api/driveitem-delta?view=graph-rest-1.0).</span></span>

> <span data-ttu-id="21e6f-228">\*\* Шаблон использования ресурсов Planner незначительно отличается от шаблонов использования других поддерживаемых ресурсов.</span><span class="sxs-lookup"><span data-stu-id="21e6f-228">\*\* The usage pattern for Planner resources is similar to other supported resources with a few differences.</span></span>  <span data-ttu-id="21e6f-229">Дополнительные сведения см. в [этой статье](/graph/api/planneruser-list-delta).</span><span class="sxs-lookup"><span data-stu-id="21e6f-229">For details, see [Track changes for Planner](/graph/api/planneruser-list-delta).</span></span>

## <a name="limitations"></a><span data-ttu-id="21e6f-230">Ограничения</span><span class="sxs-lookup"><span data-stu-id="21e6f-230">Limitations</span></span>

### <a name="properties-stored-outside-of-the-main-data-store"></a><span data-ttu-id="21e6f-231">Свойства, хранящиеся вне основного хранилища данных</span><span class="sxs-lookup"><span data-stu-id="21e6f-231">Properties stored outside of the main data store</span></span>

<span data-ttu-id="21e6f-232">Некоторые ресурсы содержат свойства, которые хранятся вне основного хранилища данных для ресурса (например, ресурс user в основном хранится в системе Azure AD, в то время как некоторые свойства, такие как **skills**, хранятся в SharePoint Online).</span><span class="sxs-lookup"><span data-stu-id="21e6f-232">Some resources contain properties that are stored outside of the main data store for the resource (for example, the user resource is mostly stored in the Azure AD system, while some properties, like **skills**, are stored in SharePoint Online).</span></span> <span data-ttu-id="21e6f-233">В настоящее время эти свойства не поддерживаются как часть отслеживания изменений; изменение одного из этих свойств не приведет к отображению объекта в отклике на разностный запрос.</span><span class="sxs-lookup"><span data-stu-id="21e6f-233">Currently, those properties are not supported as part of change tracking; a change to one of those properties will not result in an object showing up in the delta query response.</span></span> <span data-ttu-id="21e6f-234">В настоящее время только свойства, хранящиеся в главном хранилище данных, активируют изменения в разностном запросе.</span><span class="sxs-lookup"><span data-stu-id="21e6f-234">Currently, only the properties stored in the main data store trigger changes in the delta query.</span></span>

<span data-ttu-id="21e6f-235">Чтобы проверить, можно ли использовать свойство в разностном запросе, попробуйте выполнить обычную операцию `GET` в коллекции ресурсов и выберите интересующее вас свойство.</span><span class="sxs-lookup"><span data-stu-id="21e6f-235">To verify that a property can be used in delta query, try to perform a regular `GET` operation on the resource collection, and select the property you're interested in.</span></span> <span data-ttu-id="21e6f-236">Например, вы можете попробовать использовать свойство **skills** в коллекции пользователей.</span><span class="sxs-lookup"><span data-stu-id="21e6f-236">For example, you can try the **skills** property on the users collection.</span></span>

```msgraph-interactive
GET https://graph.microsoft.com/v1.0/users/?$select=skills
```

<span data-ttu-id="21e6f-237">Так как свойство **skills** хранится вне Azure AD, отклик будет следующим.</span><span class="sxs-lookup"><span data-stu-id="21e6f-237">Because the **skills** property is stored outside of Azure AD, the following is the response.</span></span>

<!-- {
  "blockType": "response",
  "truncated": true,
  "@odata.type": "microsoft.graph.user",
  "isCollection": true
} -->

```http
HTTP/1.1 501 Not Implemented
Content-type: application/json

{
    "error": {
        "code": "NotImplemented",
        "message": "This operation target is not yet supported.",
        "innerError": {
            "request-id": "...",
            "date": "2019-09-20T21:47:50"
        }
    }
}
```

<span data-ttu-id="21e6f-238">Это говорит о том, что свойство **skills** не поддерживается для разностного запроса в ресурсе **user**.</span><span class="sxs-lookup"><span data-stu-id="21e6f-238">This tells you that the **skills** property is not supported for delta query on the **user** resource.</span></span>

### <a name="navigation-properties"></a><span data-ttu-id="21e6f-239">Свойства навигации</span><span class="sxs-lookup"><span data-stu-id="21e6f-239">Navigation properties</span></span>

<span data-ttu-id="21e6f-240">Свойства навигации не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="21e6f-240">Navigation properties are not supported.</span></span> <span data-ttu-id="21e6f-241">Например, вы не можете отслеживать изменения в коллекции пользователей, включающие изменения их свойства **photo**; **photo** — это свойство навигации, которое хранится вне сущности пользователя, и внесенные в него изменения не приводят к включению объекта "пользователь" в отклик с различиями.</span><span class="sxs-lookup"><span data-stu-id="21e6f-241">For example, you cannot track changes to the users collection that would include changes to their **photo** property; **photo** is a navigation property stored outside of the user entity, and changes to it do not cause the user object to be included in the delta response.</span></span>

### <a name="processing-delays"></a><span data-ttu-id="21e6f-242">Задержка обработки</span><span class="sxs-lookup"><span data-stu-id="21e6f-242">Processing delays</span></span>

<span data-ttu-id="21e6f-243">Ожидайте различные задержки между моментом, когда изменения вносятся в экземпляр ресурса, который может быть через интерфейс приложения или API, и временем, когда отслеживаемое изменение отражается в ответе запроса изменений.</span><span class="sxs-lookup"><span data-stu-id="21e6f-243">Expect varying delays between the time a change is made to a resource instance, which can be through an app interface or API, and the time the tracked change is reflected in a delta query response.</span></span>

### <a name="national-clouds"></a><span data-ttu-id="21e6f-244">Национальные облачные развертывания</span><span class="sxs-lookup"><span data-stu-id="21e6f-244">National clouds</span></span>

<span data-ttu-id="21e6f-245">Запросы изменений доступны для клиентов, размещенных в общедоступном облаке и Microsoft Graph China, управляемых только 21Vianet.</span><span class="sxs-lookup"><span data-stu-id="21e6f-245">Delta queries are available for customers hosted on the public cloud and Microsoft Graph China operated by 21Vianet only.</span></span>

### <a name="replays"></a><span data-ttu-id="21e6f-246">Повторения</span><span class="sxs-lookup"><span data-stu-id="21e6f-246">Replays</span></span>

<span data-ttu-id="21e6f-247">Ваше приложение должно быть готово к повторениям, которые происходят, когда одинаковое изменение возникает в последующих откликах.</span><span class="sxs-lookup"><span data-stu-id="21e6f-247">Your application must be prepared for replays, which occur when the same change appears in subsequent responses.</span></span> <span data-ttu-id="21e6f-248">Хотя разностный запрос является оптимальным средством сокращения повторений, они по-прежнему возможны.</span><span class="sxs-lookup"><span data-stu-id="21e6f-248">While delta query makes a best effort to reduce replays, they are still possible.</span></span>

### <a name="synchronization-reset"></a><span data-ttu-id="21e6f-249">Сброс синхронизации</span><span class="sxs-lookup"><span data-stu-id="21e6f-249">Synchronization reset</span></span>

<span data-ttu-id="21e6f-250">Разностный запрос может возвращать код отклика `410 (gone)` и заголовок **Location**, содержащий URL-адрес запроса с пустым разностным маркером (аналогично исходному запросу).</span><span class="sxs-lookup"><span data-stu-id="21e6f-250">Delta query can return a response code of `410 (gone)` and a **Location** header containing a request URL with an empty delta token (same as the initial query).</span></span> <span data-ttu-id="21e6f-251">Это означает, что приложение требуется перезапустить с полной синхронизацией целевого клиента.</span><span class="sxs-lookup"><span data-stu-id="21e6f-251">This is an indication that the application must restart with a full synchronization of the target tenant.</span></span> <span data-ttu-id="21e6f-252">Обычно это происходит, чтобы предотвратить несоответствие данных из-за внутреннего обслуживания или миграции целевого клиента.</span><span class="sxs-lookup"><span data-stu-id="21e6f-252">This usually happens to prevent data inconsistency due to internal maintenance or migration of the target tenant.</span></span>

### <a name="token-duration"></a><span data-ttu-id="21e6f-253">Длительность маркера</span><span class="sxs-lookup"><span data-stu-id="21e6f-253">Token duration</span></span>

<span data-ttu-id="21e6f-254">Токены изменений действительны только в течение определенного периода, прежде чем клиентскому приложению потребуется снова выполнить полную синхронизацию.</span><span class="sxs-lookup"><span data-stu-id="21e6f-254">Delta tokens are only valid for a specific period before the client application needs to run a full synchronization again.</span></span> <span data-ttu-id="21e6f-255">Для объектов каталога (**application**, **administrativeUnit**, **directoryObject**, **directoryRole**, **group**, **orgContact**, **oauth2permissiongrant**, **servicePrincipal** и **user**) ограничение составляет 7 дней.</span><span class="sxs-lookup"><span data-stu-id="21e6f-255">For directory objects (**application**, **administrativeUnit**, **directoryObject**, **directoryRole**, **group**, **orgContact**, **oauth2permissiongrant**, **servicePrincipal**, and **user**), the limit is 7 days.</span></span> <span data-ttu-id="21e6f-256">Для образовательных объектов (**educationSchool**, **educationUser** и **educationClass**) ограничение составляет 7 дней.</span><span class="sxs-lookup"><span data-stu-id="21e6f-256">For education objects (**educationSchool**, **educationUser**, and **educationClass**), the limit is 7 days.</span></span> <span data-ttu-id="21e6f-257">Для объектов Outlook (**message**, **mailFolder**, **event**, **contact**, **contactFolder**, **todoTask** и **todoTaskList**) верхнее ограничение не фиксировано; оно зависит от размера внутреннего кэша разностного маркера.</span><span class="sxs-lookup"><span data-stu-id="21e6f-257">For Outlook entities (**message**, **mailFolder**, **event**, **contact**, **contactFolder**, **todoTask**, and **todoTaskList**), the upper limit is not fixed; it's dependent on the size of the internal delta token cache.</span></span> <span data-ttu-id="21e6f-258">Хотя новые разностные маркеры непрерывно добавляются в кэш, после превышения емкости кэша старые разностные маркеры удаляются.</span><span class="sxs-lookup"><span data-stu-id="21e6f-258">While new delta tokens are continuously added in the cache, after the cache capacity is exceeded, the older delta tokens are deleted.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="21e6f-259">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="21e6f-259">Prerequisites</span></span>

<span data-ttu-id="21e6f-260">Выполнение разностных запросов для определенного ресурса требует тех же [разрешений](./permissions-reference.md), что и его чтение.</span><span class="sxs-lookup"><span data-stu-id="21e6f-260">The same [permissions](./permissions-reference.md) that are required to read a specific resource are also required to perform delta query on that resource.</span></span>

## <a name="delta-query-request-examples"></a><span data-ttu-id="21e6f-261">Примеры разностных запросов</span><span class="sxs-lookup"><span data-stu-id="21e6f-261">Delta query request examples</span></span>

- [<span data-ttu-id="21e6f-262">Получение добавочных изменений для событий в представлении календаря</span><span class="sxs-lookup"><span data-stu-id="21e6f-262">Get incremental changes to events in a calendar view</span></span>](delta-query-events.md)
- [<span data-ttu-id="21e6f-263">Получение добавочных изменений сообщений в папке</span><span class="sxs-lookup"><span data-stu-id="21e6f-263">Get incremental changes to messages in a folder</span></span>](./delta-query-messages.md)
- [<span data-ttu-id="21e6f-264">Получение добавочных изменений групп</span><span class="sxs-lookup"><span data-stu-id="21e6f-264">Get incremental changes to groups</span></span>](./delta-query-groups.md)
- [<span data-ttu-id="21e6f-265">Получение добавочных изменений пользователей</span><span class="sxs-lookup"><span data-stu-id="21e6f-265">Get incremental changes to users</span></span>](./delta-query-users.md)
