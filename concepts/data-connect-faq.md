---
title: 'Подключение к данным Microsoft Graph: часто задаваемые вопросы'
description: Советы, помогающие воспользоваться преимуществами подключения к данным Microsoft Graph.
author: fercobo-msft
ms.localizationpriority: high
ms.prod: data-connect
ms.openlocfilehash: 24a740efea421b18b1044401f0252102262da6b7
ms.sourcegitcommit: 4ef29d4a2cfa1ccc4a3da649e683377b17b90108
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2022
ms.locfileid: "65125887"
---
# <a name="microsoft-graph-data-connect-frequently-asked-questions"></a>Подключение к данным Microsoft Graph: часто задаваемые вопросы

Подключение к данным Microsoft Graph позволяет разработчикам создавать приложения, которые пользователи смогут использовать для предоставления управляемого доступа к масштабным наборам данных Microsoft Graph. Эта статья содержит советы, помогающие воспользоваться преимуществами функции подключения к данным. Для знакомства с подключением к данным Microsoft Graph см. [обзорную статью](data-connect-concept-overview.md).

## <a name="is-microsoft-graph-data-connect-right-for-me"></a>Подходит ли мне функция подключения к данным Microsoft Graph?

Подключение к данным и API Microsoft Graph обеспечивают доступ к одинаковым базовым данным, но очень разными способами. Подключение к данным предназначено для массового извлечения больших объемов данных, а API Microsoft Graph больше подходит для доступа к отдельным наборам данных в режиме реального времени. В некоторых случаях можно даже объединить их. Например, может потребоваться использовать подключение к данным, чтобы выполнить начальное извлечение данных электронной почты за последний год, а затем применить API Microsoft Graph для дальнейшего анализа писем в режиме реального времени. Подключение к данным и API Microsoft Graph — это разные средства для разных задач. Важно продумать, какой метод лучше подходит к вашему сценарию. Дополнительные сведения см. в статье [Когда следует использовать API Microsoft Graph или подключение к данным?](/graph/overview#when-should-i-use-microsoft-graph-api-or-data-connect).

## <a name="is-there-any-initial-overhead"></a>Есть ли первоначальные затраты времени?

Так как подключение к данным предназначено для массового извлечения больших объемов данных, возникают дополнительные затраты времени перед тем, как можно будет извлечь данные. Эти затраты составляют около 45 минут. Это означает, что этот период требуется для всех конвейеров вне зависимости от размера данных. Этими затратами можно пренебречь для больших объемов данных, но если такой промежуток времени недопустим в вашем сценарии, API Microsoft Graph может обеспечить более подходящий способ.

## <a name="how-much-do-i-have-to-pay-for-data-connect"></a>Сколько нужно платить за функцию подключения к данным?

Плата за использование функции подключения к данным Microsoft Graph взимается ежемесячно с оплатой по мере использования. Единица измерения выставления счетов за функцию подключения к данным — тысяча объектов, где 1 объект соответствует 1 отдельному экземпляру сущности в Microsoft 365. Например, 1 сообщение электронной почты == 1 объект, 1 файл == 1 объект, 1 сообщение чата Teams == 1 объект и так далее. Плата рассчитывается по фиксированной ставке, основанной на количестве объектов на 1000, извлеченных через соединитель. За извлечение объектов из следующих наборов данных плата не взимается:

- BasicDataSet_v0.User
- BasicDataSet_v0.MailboxSettings
- BasicDataSet_v0.Manager
- BasicDataSet_v0.DirectReport

## <a name="in-what-regions-is-data-connect-available"></a>В каких регионах доступно подключение к данным?

Подключение к данным Microsoft Graph в настоящее время доступно в следующих регионах: Северная Америка, Европа, Азиатско-Тихоокеанский регион и Австралия. В будущем появится доступ и в других регионах.

## <a name="what-datasets-are-available-through-data-connect"></a>Какие наборы данных доступны через подключение к данным?

Подключение к данным Microsoft Graph в настоящее время включает следующие наборы данных:

* Teams: 1:1, 1:N и сообщения чата собрания
* Outlook: сообщения, события, контакты, отправленные элементы, сущность пользователя, параметры почтового ящика, представление календаря, руководители и прямые подчиненные, а также почтовые папки

В будущем мы планируем добавить новые наборы данных и при необходимости расскажем о сроках выхода. Однако мы вряд ли будем выставлять все наборы данных Microsoft Graph через подключение к данным Microsoft Graph.

## <a name="what-scenarios-does-data-connect-best-address"></a>В каких сценариях лучше всего подходит подключение к данным?

Организации, которые могут использовать большие наборы данных, используемых их инструментами для повышения производительности, могут получить прекрасные аналитические данные о трудностях и возможностях, с которыми они могут столкнуться. Во время действия нашей открытой предварительной версии мы видели клиентов, заинтересованных в производительности продаж, архивировании данных и управлении ими, оптимизации организации, интеллектуальных бизнес-процессах и обеспечении соответствия требованиям.

## <a name="is-it-possible-for-my-data-to-stay-within-the-organizations-subscription-with-data-connect"></a>Могут ли мои данные остаться в рамках подписки организации с помощью подключения к данным?

Конвейеры подключения к данным Microsoft Graph управляются фабрикой данных Azure, являющейся службой интеграции данных, работающей в рамках подписки Azure. Подписка Azure [связана только с одним клиентом Microsoft 365](/azure/active-directory/fundamentals/active-directory-how-subscriptions-associated-directory). Таким образом, данные должны сначала направляться в связанную подписку Azure. После дальнейшей минимизации и агрегации данные можно использовать в другом месте.

Если нужно создать приложение для других пользователей, чтобы извлекать данные Microsoft 365, можно упаковать приложение как [управляемое приложение Azure](/azure/managed-applications/overview) и опубликовать его в Azure Marketplace. Затем другой пользователь сможет развернуть ваше приложение в своей подписке Azure, и приложение получит доступ к данным в клиенте.

## <a name="are-service-principals-required-with-data-connect"></a>Требуются ли для подключения к данным субъекты службы?

При создании конвейера фабрики данных необходимо предоставить субъект-службу для связанной службы Microsoft 365. В Azure субъект-служба — это объект безопасности, представляющий приложение или службу (в отличие от пользователя). Подключение к данным Microsoft Graph использует этот субъект-службу в качестве удостоверения при получении авторизованного доступа к вашим данным Microsoft 365.

Если вы создаете управляемое приложение Azure для других пользователей с целью применения в клиентах, вам также нужно предоставить субъект-службу для использования приложением. Этот субъект-служба существует в вашем клиенте (клиенте издателя). Но если приложению требуются другие субъекты-службы, пользователю (установщику) нужно создать их в собственном клиенте. Например, вашему конвейеру фабрики данных, скорее всего, требуется доступ к ресурсу хранилища в Azure. Пользователю требуется создать субъект-службу с разрешениями на доступ к учетной записи хранилища для использования конвейером.

## <a name="how-can-i-check-for-pending-privileged-access-management-requests"></a>Как проверить наличие ожидающих запросов Privileged Access Management?

Прежде чем подключение к данным Microsoft Graph сможет скопировать ваши данные администратор должен утвердить запрос на управление привилегированным доступом (PAM). Управление привилегированным доступом — это механизм, используемый для разрешения доступа вашего конвейера данных к данным в Microsoft 365. При первом запуске конвейера ожидается утверждение запроса на доступ администратором Microsoft 365 (или назначенным делегатом). Хотя состояние конвейера отображается как **Выполняется**, базовому действию копирования будет соответствовать состояние **ConsentPending** до получения утверждения, как показано на снимке экрана ниже.

![Снимок экрана: область состояния работы конвейера с состоянием ConsentPending](images/data-connect-tips.png)

При разработке рекомендуется проверять, что канал не застрял в состоянии **ConsentPending**, особенно после внесения изменений в конвейер. Например, при добавлении дополнительного поля в схему следующий запуск конвейера приводит к созданию запроса PAM, требующего утверждения. Не теряйте время с конвейером, ожидающим вашего утверждения.

## <a name="how-can-i-approve-pam-requests-via-the-microsoft-365-admin-center"></a>Как утвердить запросы PAM в Центре администрирования Microsoft 365?

В документации по подключению данных показано, как использовать PowerShell и пользовательский интерфейс PAM, чтобы утверждать запросы PAM. Для утверждения с помощью пользовательского интерфейса PAM откройте пользовательский интерфейс PAM в [Центре администрирования Microsoft 365](https://admin.microsoft.com/Adminportal/Home?source=applauncher#/Settings/PrivilegedAccess). Центр администрирования предоставляет простой и понятный способ просмотра, утверждения, отклонения или отзыва запросов PAM. Ссылка на надстройку подключения к данным Microsoft Graph находится в разделе **Параметры** > **Службы и надстройки** > **Подключение к данным Microsoft Graph**.

## <a name="can-i-have-a-second-user-to-approve-pam-requests"></a>Можно ли использовать второго пользователя для утверждения запросов PAM?

Если вы запускаете конвейер и запрос PAM, запрос вкладывается в вашу учетную запись, которой принадлежит субъект-служба, используемая конвейером. Но даже если эта учетная запись состоит в настроенной вами группе утверждающих, вы не сможете использовать ее для утверждения запроса PAM, так как самостоятельные утверждения не разрешаются. При попытке появится сообщение об ошибке в портале PAM: "Запрашивающий и утверждающий совпадают. Самостоятельное утверждение запрещено". При разработке рекомендуется использовать вторую учетную запись помимо администратора, утверждающего запросы. Как отправитель, так и утверждающий должны иметь активные учетные записи Exchange Online.

## <a name="can-i-deduplicate-emails-when-needed"></a>Можно ли при необходимости выполнять дедупликацию сообщений электронной почты?

При извлечении сообщений электронной почты из набора данных `Message` часто создается несколько объектов JSON одного сообщения. Эти дубликаты существуют, так как при отправке сообщения нескольким пользователям создается его копия в почтовом ящике каждого получателя. Так как набор данных извлекается из каждого почтового ящика, он содержит все копии от разных пользователей. В некоторых случаях может требоваться сохранение всех копий, но в остальных случаях рекомендуется удалять дубликаты.

Выполнить дедупликацию экспортированных объектов JSON можно на основе параметра `internetMessageId` сообщений: два сообщения с одинаковым значением `internetMessageId` являются копиями одного экземпляра. Так как дубликаты могут существовать в разных BLOB-объектах, дедупликацию необходимо выполнять во всех BLOB-объектах, а не в отдельных BLOB-объектах.

## <a name="can-i-use-the-puser-field-to-determine-the-relevant-user"></a>Можно ли использовать поле "Puser" для определения соответствующего пользователя?

Извлеченные данные содержат некоторые свойства Meta, не существующие при использовании соответствующего API Microsoft Graph. В частности, поле `puser` может быть полезно для определения пользователя, данные о котором извлечены. В сценарии с двумя копиями одного сообщения электронной почты в разных почтовых ящиках вы можете использовать поле `puser`, чтобы определить, из какого почтового ящика получена каждая копия. Поле `puser` также удобно применять для наборов данных, например для набора данных `Manager`. Экспортированные объекты JSON содержат сведения о руководителе, но они полезны, только если вы знаете, кем он руководит. Поле `puser` указывает, чей руководитель соответствует этому объекту JSON.

## <a name="is-hybrid-mode-tenant-setup-supported"></a>Поддерживается ли настройка клиента в гибридном режиме?

Если в вашей настройке Microsoft 365 есть некоторые пользователи в Exchange Online и некоторые пользователи в локальной службе Exchange, то пользователи, которые находятся в локальной службе Exchange, не будут поддерживаться. К сожалению, на данный момент подключение к данным для локальных пользователей Exchange не поддерживается.

## <a name="are-resource-accounts-supported"></a>Поддерживаются ли учетные записи ресурсов?

В настоящее время мы не поддерживаем доступ к сообщениям или событиям из учетных записей ресурсов.

## <a name="why-do-i-sometimes-see-multiple-files-per-adf-pipeline-run-but-other-times-see-only-one-file-per-run"></a>Почему в одном конвейере ADF иногда может быть несколько файлов, а в других случаях на каждый запуск приходится только один файл?

Подключение к данным Microsoft Graph берет список пользователей для каждого запуска устройства, а затем распределяет извлечение набора данных и курирование по нескольким заданиям, которые выполняются параллельно. Для каждого параллельного запуска в определенном вами источнике данных создается один выходной файл. В некоторых случаях, если список пользователей небольшой, его можно сопоставить с одним заданием извлечения и курсирования, и в таких случаях в источнике данных будет создан только один выходной файл.

## <a name="how-is-billing-computed-when-the-count-of-objects-is-not-a-round-number"></a>Каким образом выполняется расчет по выставлению счета, когда количество объектов не является круглым числом?

В целях выставления счетов подключение к данным Microsoft Graph округляет количество извлеченных объектов до ближайшего значения 1000. Например, если вы извлекаете 125 объектов или 999 объектов, вам выставляется счет за 1000 объектов. Аналогичным образом при извлечении от 1001 до 2000 объектов взимается плата за 2000 объектов.

## <a name="why-does-my-microsoft-365-copy-data-activity-always-fail-when-initialized-via-azure-synapse"></a>Почему при инициализации с помощью Azure Synapse всегда происходит сбой копирования данных Microsoft 365?

В настоящий момент мы не поддерживаем инициализацию копирования данных Microsoft 365 с помощью Azure Synapse. Мы работаем над добавлением интеграции для инициализированного действия Azure Synapse и обновим нашу документацию по ее завершению.
