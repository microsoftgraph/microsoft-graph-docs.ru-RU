---
title: Управление сеансами и сохраняемость в Excel
description: Узнайте, как использовать API Excel в Microsoft Graph наиболее эффективным способом. Узнайте о трех режимах вызова API и связанных типах запросов.
ms.localizationpriority: medium
author: lumine2008
ms.prod: excel
ms.openlocfilehash: b2b38c20f3ae1613d9330271cd73af56bb7d33c8
ms.sourcegitcommit: b2b3c3ae00f9e2e0bb2dcff30e97b60ccdebf170
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/29/2022
ms.locfileid: "66440833"
---
# <a name="manage-sessions-and-persistence-in-excel"></a>Управление сеансами и сохраняемость в Excel

Если приложению необходимо выполнить несколько вызовов к API Excel в Microsoft Graph, создайте сеанс и передайте идентификатор сеанса с каждым запросом. Наличие идентификатора сеанса в запросах гарантирует, что вы используете API Excel наиболее эффективным способом.

API Excel вызываются в одном из трех режимов:

- **Постоянный сеанс:** Все изменения, внесенные в книгу, сохраняются в книге. Это наиболее эффективный и производительный способ использования API Excel.

- **Несохраняемый сеанс:** Изменения, внесенные API, не сохраняются в исходном расположении. Вместо этого внутренний сервер Excel сохраняет временную копию файла, в которой отражены изменения, внесенные во время конкретного сеанса API. Когда истечет срок действия сеанса Excel, изменения будут потеряны. Этот режим удобен для приложений, которым нужно выполнять анализ или получать результаты вычислений или изображение диаграммы, не меняя состояние документа.

- **Без сеансов:** Вызовы API не передают идентификатор сеанса. Серверы Excel должны найти копию книги на сервере для каждой операции. Этот способ вызова API Excel неэффективен, но подходит для отправки некоторых изолированных запросов.

Чтобы представить сеанс в API, используйте заголовок `workbook-session-id: {session-id}`.

> [!NOTE]
> Заголовок сеанса не требуется для работы API Excel. Однако для повышения производительности рекомендуется использовать заголовок сеанса. Если вы не используете заголовок сеанса, изменения, внесенные во время вызова API, _сохраняются в_ файле.  

## <a name="request-types"></a>Типы запросов

Рекомендуемая [обработка ошибок](workbook-error-handling.md) для API Excel основана на типе запроса, коде ошибки и коде состояния. Ниже приведены типы запросов.

- **Запрос CreateSession:** Используется для создания сохраняемого или неповстанного сеанса. В успешном ответе идентификатор сеанса будет возвращен в свойстве **id** в тексте отклика. Дополнительные сведения см. в [разделе "Создание сеанса"](/graph/api/workbook-createsession).
- **Запрос с поддержкой сеанса:** Последующие запросы, которые следуют запросу CreateSession. Обычно они включают заголовок `workbook-session-id: {session-id}` . Исключением является запрос состояния опроса, использующий шаблон длительной операции. Дополнительные сведения см [. в статье "Работа с API-интерфейсами, выполнение которых занимает много времени"](./workbook-best-practice.md#work-with-apis-that-take-a-long-time-to-complete).
- **Запрос без сеанса:** Используется в режиме без сеанса. Эти запросы не имеют заголовка `workbook-session-id: {session-id}` .  

## <a name="next-steps"></a>Дальнейшие действия

Сведения о том, как создавать и использовать сеансы, см. в [справочной статье о создании сеанса](/graph/api/workbook-createsession).

## <a name="see-also"></a>См. также

* [Запись в книгу Excel с помощью Microsoft Graph](excel-write-to-workbook.md)
* [Использование функций книг в Excel с помощью Microsoft Graph](excel-use-functions.md)
* [Обновление формата диапазона в Excel с помощью Microsoft Graph](excel-update-range-format.md)
* [Показ изображения диаграммы в Excel с помощью Microsoft Graph](excel-display-chart-image.md)
* [Использование REST API для Excel](/graph/api/resources/excel)