---
title: Получение доступа от имени пользователя
description: Для чтения и записи ресурсов от имени пользователя с помощью Microsoft Graph ваше приложение должно получать маркер доступа из Azure AD и вкладывать этот маркер в запросы для Microsoft Graph.
author: jackson-woods
localization_priority: Priority
ms.prod: applications
ms.custom: graphiamtop20
ms.openlocfilehash: 2ea70d1f18eaf48b8889f924d7306d186d99c6a7
ms.sourcegitcommit: d033e7de12bccf92efcbe40c7b671e419a3e5b94
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2021
ms.locfileid: "51882553"
---
# <a name="get-access-on-behalf-of-a-user"></a><span data-ttu-id="64ad5-103">Получение доступа от имени пользователя</span><span class="sxs-lookup"><span data-stu-id="64ad5-103">Get access on behalf of a user</span></span>

<span data-ttu-id="64ad5-p101">Для чтения и записи ресурсов от имени пользователя с помощью Microsoft Graph приложение должно получать маркер доступа из платформы удостоверений Майкрософт и вкладывать этот маркер в запросы для Microsoft Graph. Поток проверки подлинности, который будет использоваться для получения маркеров доступа, зависит от типа разрабатываемого приложения и от того, хотите ли вы использовать OpenID Connect для обеспечения входа пользователя в приложение. В нативных и мобильных приложениях, а также в некоторых веб-приложениях часто используется поток предоставления кода авторизации OAuth 2.0. В этой статье рассматривается пример использования такого потока.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p101">To use Microsoft Graph to read and write resources on behalf of a user, your app must get an access token from the Microsoft identity platform and attach the token to requests that it sends to Microsoft Graph. The exact authentication flow that you will use to get access tokens will depend on the kind of app you are developing and whether you want to use OpenID Connect to sign the user in to your app. One common flow used by native and mobile apps and also by some Web apps is the OAuth 2.0 authorization code grant flow. This topic  walks through an example using this flow.</span></span>

## <a name="authentication-and-authorization-steps"></a><span data-ttu-id="64ad5-108">Этапы проверки подлинности и авторизации</span><span class="sxs-lookup"><span data-stu-id="64ad5-108">Authentication and Authorization steps</span></span>

<span data-ttu-id="64ad5-109">Ниже перечислены основные действия, необходимые для получения маркера доступа из конечной точки платформы удостоверений Майкрософт с помощью потока предоставления кода авторизации OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="64ad5-109">The basic steps required to use the OAuth 2.0 authorization code grant flow to get an access token from the Microsoft identity platform endpoint are:</span></span>

1. <span data-ttu-id="64ad5-110">Регистрация приложения в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="64ad5-110">Register your app with Azure AD.</span></span>
2. <span data-ttu-id="64ad5-111">Получение авторизации.</span><span class="sxs-lookup"><span data-stu-id="64ad5-111">Get authorization.</span></span>
3. <span data-ttu-id="64ad5-112">Получение маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="64ad5-112">Get an access token.</span></span>
4. <span data-ttu-id="64ad5-113">Вызовы Microsoft Graph с помощью маркера доступа.</span><span class="sxs-lookup"><span data-stu-id="64ad5-113">Call Microsoft Graph with the access token.</span></span>
5. <span data-ttu-id="64ad5-114">Получение нового маркера доступа с помощью маркера обновления.</span><span class="sxs-lookup"><span data-stu-id="64ad5-114">Use a refresh token to get a new access token.</span></span>

## <a name="1-register-your-app"></a><span data-ttu-id="64ad5-115">1. Регистрация приложения</span><span class="sxs-lookup"><span data-stu-id="64ad5-115">1. Register your app</span></span>

<span data-ttu-id="64ad5-p102">Чтобы использовать конечную точку платформы удостоверений Майкрософт, необходимо зарегистрировать приложение с помощью [портала для регистрации приложений](https://go.microsoft.com/fwlink/?linkid=2083908) Azure. Для регистрации приложения можно использовать либо учетную запись Майкрософт, либо рабочую или учебную учетную запись.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p102">To use the Microsoft identity platform endpoint, you must register your app using the Azure [app registration portal](https://go.microsoft.com/fwlink/?linkid=2083908). You can use either a Microsoft account or a work or school account to register an app.</span></span>

<span data-ttu-id="64ad5-118">Чтобы настроить приложение на использование потока предоставления кода авторизации OAuth 2.0, во время регистрации приложения необходимо сохранить следующие значения:</span><span class="sxs-lookup"><span data-stu-id="64ad5-118">To configure an app to use the OAuth 2.0 authorization code grant flow, you'll need to save the following values when registering the app:</span></span>

- <span data-ttu-id="64ad5-119">идентификатор приложения (клиента), назначенный порталом регистрации;</span><span class="sxs-lookup"><span data-stu-id="64ad5-119">The Application (client) ID assigned by the app registration portal.</span></span>
- <span data-ttu-id="64ad5-120">секрет клиента (приложения) — пароль либо открытый и закрытый ключ (сертификат).</span><span class="sxs-lookup"><span data-stu-id="64ad5-120">A Client (application) Secret, either a password or a public/private key pair (certificate).</span></span> <span data-ttu-id="64ad5-121">Это необязательно для нативных приложений;</span><span class="sxs-lookup"><span data-stu-id="64ad5-121">This is not required for native apps.</span></span>
- <span data-ttu-id="64ad5-122">URI перенаправления (или URL-адрес ответа), с помощью которого приложение будет получать отклики от Azure AD.</span><span class="sxs-lookup"><span data-stu-id="64ad5-122">A Redirect URI (or reply URL) for your app to receive responses from Azure AD.</span></span>

<span data-ttu-id="64ad5-123">Инструкции по настройке приложения на портале Azure см. в статье [Регистрация приложения](./auth-register-app-v2.md).</span><span class="sxs-lookup"><span data-stu-id="64ad5-123">For steps on how to configure an app in the Azure portal, see [Register your app](./auth-register-app-v2.md).</span></span>

## <a name="2-get-authorization"></a><span data-ttu-id="64ad5-124">2. Получение авторизации</span><span class="sxs-lookup"><span data-stu-id="64ad5-124">2. Get authorization</span></span>

<span data-ttu-id="64ad5-125">Чтобы получить маркер доступа для многих потоков OpenID Connect и OAuth 2.0, сначала необходимо перенаправить пользователя к конечной точке `/authorize` платформы удостоверений Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="64ad5-125">The first step to getting an access token for many OpenID Connect and OAuth 2.0 flows is to redirect the user to the Microsoft identity platform `/authorize` endpoint.</span></span> <span data-ttu-id="64ad5-126">Azure AD обеспечит вход пользователя и запрашивание его согласия на предоставление приложению необходимых разрешений.</span><span class="sxs-lookup"><span data-stu-id="64ad5-126">Azure AD will sign the user in and ensure their consent for the permissions your app requests.</span></span> <span data-ttu-id="64ad5-127">В потоке предоставления кода авторизации после получения согласия Azure AD возвращает приложению код авторизации, который оно может передать конечной точке `/token` платформы удостоверений Майкрософт, чтобы получить маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="64ad5-127">In the authorization code grant flow, after consent is obtained, Azure AD will return an authorization_code to your app that it can redeem at the Microsoft identity platform `/token` endpoint for an access token.</span></span>

### <a name="authorization-request"></a><span data-ttu-id="64ad5-128">Запрос авторизации</span><span class="sxs-lookup"><span data-stu-id="64ad5-128">Authorization request</span></span>

<span data-ttu-id="64ad5-129">Ниже представлен пример запроса для конечной точки `/authorize`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-129">The following shows an example request to the `/authorize` endpoint.</span></span>

<span data-ttu-id="64ad5-130">При использовании конечной точки платформы удостоверений Майкрософт разрешения запрашиваются с помощью параметра `scope`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-130">With the Microsoft identity platform endpoint, permissions are requested using the `scope` parameter.</span></span> <span data-ttu-id="64ad5-131">В этом примере запрашиваются разрешения Microsoft Graph _User.Read_ и _Mail.Read_, которые позволяют приложению просматривать профиль и почту вошедшего пользователя.</span><span class="sxs-lookup"><span data-stu-id="64ad5-131">In this example, the Microsoft Graph permissions requested are for _User.Read_ and _Mail.Read_, which will allow the app to read the profile and mail of the signed-in user.</span></span> <span data-ttu-id="64ad5-132">Разрешение _offline\_access_ запрашивается, чтобы приложение могло получить маркер обновления, с помощью которого оно сможет получить новый маркер доступа, когда истечет срок действия текущего.</span><span class="sxs-lookup"><span data-stu-id="64ad5-132">The _offline\_access_ permission is requested so that the app can get a refresh token, which it can use to get a new access token when the current one expires.</span></span>

```
// Line breaks for legibility only

https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=offline_access%20user.read%20mail.read
&state=12345
```

| <span data-ttu-id="64ad5-133">Параметр</span><span class="sxs-lookup"><span data-stu-id="64ad5-133">Parameter</span></span>     | <span data-ttu-id="64ad5-134">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-134">Required</span></span>    | <span data-ttu-id="64ad5-135">Описание</span><span class="sxs-lookup"><span data-stu-id="64ad5-135">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------------|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="64ad5-136">tenant</span><span class="sxs-lookup"><span data-stu-id="64ad5-136">tenant</span></span>        | <span data-ttu-id="64ad5-137">обязательно</span><span class="sxs-lookup"><span data-stu-id="64ad5-137">required</span></span>    | <span data-ttu-id="64ad5-p106">С помощью значения `{tenant}` в пути запроса можно указывать, кто может входить в приложение.  Допустимые значения: `common` (для учетных записей Майкрософт, а также рабочих и учебных учетных записей), `organizations` (только для рабочих и учебных учетных записей), `consumers` (только для учетных записей Майкрософт), а также идентификаторы клиентов или доменные имена.  Дополнительные сведения см. в статье, содержащей [основные сведения о протоколах](/azure/active-directory/develop/active-directory-v2-protocols#endpoints).</span><span class="sxs-lookup"><span data-stu-id="64ad5-p106">The `{tenant}` value in the path of the request can be used to control who can sign into the application.  The allowed values are `common` for both Microsoft accounts and work or school accounts, `organizations` for work or school accounts only, `consumers` for Microsoft accounts only, and tenant identifiers such as the tenant ID or domain name.  For more detail, see [protocol basics](/azure/active-directory/develop/active-directory-v2-protocols#endpoints).</span></span> |
| <span data-ttu-id="64ad5-141">client_id</span><span class="sxs-lookup"><span data-stu-id="64ad5-141">client_id</span></span>     | <span data-ttu-id="64ad5-142">обязательно</span><span class="sxs-lookup"><span data-stu-id="64ad5-142">required</span></span>    | <span data-ttu-id="64ad5-143">Идентификатор приложения, назначенный [порталом регистрации](https://go.microsoft.com/fwlink/?linkid=2083908) для приложения.</span><span class="sxs-lookup"><span data-stu-id="64ad5-143">The Application ID that the [registration portal](https://go.microsoft.com/fwlink/?linkid=2083908) assigned your app.</span></span>                                                                                                                                                                                                                                                                                                                                                                                   |
| <span data-ttu-id="64ad5-144">response_type</span><span class="sxs-lookup"><span data-stu-id="64ad5-144">response_type</span></span> | <span data-ttu-id="64ad5-145">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-145">required</span></span>    | <span data-ttu-id="64ad5-146">Должен включать значение `code` для потока кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="64ad5-146">Must include `code` for the authorization code flow.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="64ad5-147">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="64ad5-147">redirect_uri</span></span>  | <span data-ttu-id="64ad5-148">Рекомендуемый</span><span class="sxs-lookup"><span data-stu-id="64ad5-148">recommended</span></span> | <span data-ttu-id="64ad5-p107">URI перенаправления приложения, с помощью которого приложение может отправлять и получать отклики на проверку подлинности.  Он должен в точности совпадать с одним из URI перенаправления, указанных вами на портале регистрации приложений, и быть закодирован как URL-адрес.  Для собственных и мобильных приложений следует использовать значение по умолчанию (`https://login.microsoftonline.com/common/oauth2/nativeclient`).</span><span class="sxs-lookup"><span data-stu-id="64ad5-p107">The redirect_uri of your app, where authentication responses can be sent and received by your app.  It must exactly match one of the redirect_uris you registered in the app registration portal, except it must be URL encoded.  For native and mobile apps, you should use the default value of `https://login.microsoftonline.com/common/oauth2/nativeclient`.</span></span>                                                                                                                                       |
| <span data-ttu-id="64ad5-152">область</span><span class="sxs-lookup"><span data-stu-id="64ad5-152">scope</span></span>         | <span data-ttu-id="64ad5-153">обязательно</span><span class="sxs-lookup"><span data-stu-id="64ad5-153">required</span></span>    | <span data-ttu-id="64ad5-p108">Разделенный пробелами список разрешений Microsoft Graph, на предоставление которых должен согласиться пользователь. Может также включать области OpenID.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p108">A space-separated list of the Microsoft Graph permissions that you want the user to consent to. This may also include OpenID scopes.</span></span>                                                                                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="64ad5-156">response_mode</span><span class="sxs-lookup"><span data-stu-id="64ad5-156">response_mode</span></span> | <span data-ttu-id="64ad5-157">Рекомендуемый</span><span class="sxs-lookup"><span data-stu-id="64ad5-157">recommended</span></span> | <span data-ttu-id="64ad5-p109">Указывает метод, с помощью которого полученный маркер будет возвращаться приложению.  Допустимые значения: `query` и `form_post`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p109">Specifies the method that should be used to send the resulting token back to your app.  Can be `query` or `form_post`.</span></span>                                                                                                                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="64ad5-160">состояние</span><span class="sxs-lookup"><span data-stu-id="64ad5-160">state</span></span>         | <span data-ttu-id="64ad5-161">Рекомендуемый</span><span class="sxs-lookup"><span data-stu-id="64ad5-161">recommended</span></span> | <span data-ttu-id="64ad5-p110">Включенное в запрос значение, которое также будет возвращаться в отклике с маркером.  Это может быть строка с любым содержимым.  Как правило, используется случайное уникальное значение для [предотвращения атак путем подделки межсайтовых запросов](https://tools.ietf.org/html/rfc6749#section-10.12).  Параметр state также используется для кодирования сведений о состоянии пользователя в приложении до запроса проверки подлинности, например о просматриваемых странице и представлении.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p110">A value included in the request that will also be returned in the token response.  It can be a string of any content that you wish.  A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](https://tools.ietf.org/html/rfc6749#section-10.12).  The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span>                                     |

> <span data-ttu-id="64ad5-p111">**Важно!** Microsoft Graph предоставляет разрешения двух типов: разрешения приложения и делегированные разрешения. Для приложений, предусматривающих вход пользователя, с помощью параметра `scope` запрашиваются делегированные разрешения. Эти разрешения передают приложению привилегии вошедшего пользователя, позволяя вызывать Microsoft Graph от имени этого пользователя. Дополнительные сведения о разрешениях, доступных в Microsoft Graph, см. в [справочнике по разрешениям](./permissions-reference.md).</span><span class="sxs-lookup"><span data-stu-id="64ad5-p111">**Important**: Microsoft Graph exposes two kinds of permissions: application and delegated. For apps that run with a signed-in user, you request delegated permissions in the `scope` parameter. These permissions delegate the privileges of the signed-in user to your app, allowing it to act as the signed-in user when making calls to Microsoft Graph. For more detailed information about the permissions available through Microsoft Graph, see the [Permissions reference](./permissions-reference.md).</span></span>

### <a name="consent-experience"></a><span data-ttu-id="64ad5-170">Предоставление согласия</span><span class="sxs-lookup"><span data-stu-id="64ad5-170">Consent experience</span></span>

<span data-ttu-id="64ad5-171">На этом этапе пользователю предлагается указать свои учетные данные для проверки подлинности с помощью Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="64ad5-171">At this point, the user will be asked to enter their credentials to authenticate with Microsoft.</span></span> <span data-ttu-id="64ad5-172">Конечная точка платформы удостоверений Майкрософт версии 2.0 также обеспечивает согласие пользователя на предоставление указанных разрешений с помощью параметра запроса `scope`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-172">The Microsoft identity platform v2.0 endpoint will also ensure that the user has consented to the permissions indicated in the `scope` query parameter.</span></span>  <span data-ttu-id="64ad5-173">Если пользователь не согласился предоставить какое-либо из этих разрешений, а администратор не давал предварительного согласия от имени всех пользователей в организации, пользователям будет предложено согласиться предоставить необходимые разрешения.</span><span class="sxs-lookup"><span data-stu-id="64ad5-173">If the user has not consented to any of those permissions and if an administrator has not previously consented on behalf of all users in the organization, they will be asked to consent to the required permissions.</span></span>

<span data-ttu-id="64ad5-174">Ниже представлен пример диалогового окна согласия для учетной записи Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="64ad5-174">The following is an example of the consent dialog box presented for a Microsoft account user.</span></span>

![Диалоговое окно согласия для учетной записи Майкрософт](./images/v2-consumer-consent.png)

> <span data-ttu-id="64ad5-p113">**Попробуйте сами.** Если у вас есть учетная запись Майкрософт либо рабочая или учебная учетная запись Azure AD, вы можете попробовать это самостоятельно, щелкнув следующую ссылку. После входа браузер должен быть перенаправлен по адресу `https://localhost/myapp/` со значением `code` в адресной строке.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p113">**Try** If you have a Microsoft account or an Azure AD work or school account, you can try this for yourself by clicking the following link. After signing in, your browser should be redirected to `https://localhost/myapp/` with a `code` in the address bar.</span></span>
>
> <span data-ttu-id="64ad5-178"><a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=query&scope=offline_access%20user.read%20mail.read&state=12345" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a></span><span class="sxs-lookup"><span data-stu-id="64ad5-178"><a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=query&scope=offline_access%20user.read%20mail.read&state=12345" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a></span></span>

### <a name="authorization-response"></a><span data-ttu-id="64ad5-179">Отклик на авторизацию</span><span class="sxs-lookup"><span data-stu-id="64ad5-179">Authorization response</span></span>

<span data-ttu-id="64ad5-p114">Если пользователь соглашается предоставить запрашиваемые приложением разрешения, отклик будет содержать код авторизации в параметре `code`. Ниже представлен пример успешного отклика на предыдущий запрос. Так как для параметра `response_mode` запроса задано значение `query`, отклик возвращается в строке запроса URL-адреса перенаправления.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p114">If the user consents to the permissions your app requested, the response will contain the authorization code in the `code` parameter. Here is an example of a successful response to the previous request. Because the `response_mode` parameter in the request was set to `query`, the response is returned in the query string of the redirect URL.</span></span>

```
GET https://localhost/myapp/?
code=M0ab92efe-b6fd-df08-87dc-2c6500a7f84d
&state=12345
```

| <span data-ttu-id="64ad5-183">Параметр</span><span class="sxs-lookup"><span data-stu-id="64ad5-183">Parameter</span></span> | <span data-ttu-id="64ad5-184">Описание</span><span class="sxs-lookup"><span data-stu-id="64ad5-184">Description</span></span>                                                                                                                                                                                                                        |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="64ad5-185">code</span><span class="sxs-lookup"><span data-stu-id="64ad5-185">code</span></span>      | <span data-ttu-id="64ad5-p115">Код авторизации, запрашиваемый приложением. Приложение может использовать код авторизации, чтобы запрашивать маркер доступа для целевого ресурса.  Коды авторизации имеют очень короткий срок действия: как правило, он составляет около 10 минут.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p115">The authorization_code that the app requested. The app can use the authorization code to request an access token for the target resource.  Authorization_codes are very short lived, typically they expire after about 10 minutes.</span></span> |
| <span data-ttu-id="64ad5-189">состояние</span><span class="sxs-lookup"><span data-stu-id="64ad5-189">state</span></span>     | <span data-ttu-id="64ad5-p116">Если в запрос включен параметр state, то же самое значение должно отображаться в отклике. Приложение должно убедиться, что значения параметра state в запросе и отклике совпадают.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p116">If a state parameter is included in the request, the same value should appear in the response. The app should verify that the state values in the request and response are identical.</span></span>                                              |

## <a name="3-get-a-token"></a><span data-ttu-id="64ad5-192">3. Получение маркера</span><span class="sxs-lookup"><span data-stu-id="64ad5-192">3. Get a token</span></span>

<span data-ttu-id="64ad5-193">Приложение использует значение `code` (код авторизации), полученное на предыдущем этапе, чтобы запрашивать маркер доступа путем отправки запроса `POST` конечной точке `/token`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-193">Your app uses the authorization `code` received in the previous step to request an access token by sending a `POST` request to the `/token` endpoint.</span></span>

### <a name="token-request"></a><span data-ttu-id="64ad5-194">Запрос на получение маркера</span><span class="sxs-lookup"><span data-stu-id="64ad5-194">Token request</span></span>

```
// Line breaks for legibility only

POST /{tenant}/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&scope=user.read%20mail.read
&code=OAAABAAAAiL9Kn2Z27UubvWFPbm0gLWQJVzCTE9UkP3pSx1aXxUjq3n8b2JRLk4OxVXr...
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&grant_type=authorization_code
&client_secret=JqQX2PNo9bpM0uEihUPzyrh    // NOTE: Only required for web apps
```

| <span data-ttu-id="64ad5-195">Параметр</span><span class="sxs-lookup"><span data-stu-id="64ad5-195">Parameter</span></span>     | <span data-ttu-id="64ad5-196">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-196">Required</span></span>              | <span data-ttu-id="64ad5-197">Описание</span><span class="sxs-lookup"><span data-stu-id="64ad5-197">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------------|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="64ad5-198">tenant</span><span class="sxs-lookup"><span data-stu-id="64ad5-198">tenant</span></span>        | <span data-ttu-id="64ad5-199">обязательно</span><span class="sxs-lookup"><span data-stu-id="64ad5-199">required</span></span>              | <span data-ttu-id="64ad5-p117">С помощью значения `{tenant}` в пути запроса можно указывать, кто может входить в приложение.  Допустимые значения: `common` (для учетных записей Майкрософт, а также рабочих и учебных учетных записей), `organizations` (только для рабочих и учебных учетных записей), `consumers` (только для учетных записей Майкрософт), а также идентификаторы клиентов или доменные имена.  Дополнительные сведения см. в статье, содержащей [основные сведения о протоколах](/azure/active-directory/develop/active-directory-v2-protocols#endpoints).</span><span class="sxs-lookup"><span data-stu-id="64ad5-p117">The `{tenant}` value in the path of the request can be used to control who can sign into the application.  The allowed values are `common` for both Microsoft accounts and work or school accounts, `organizations` for work or school accounts only, `consumers` for Microsoft accounts only, and tenant identifiers such as the tenant ID or domain name.  For more detail, see [protocol basics](/azure/active-directory/develop/active-directory-v2-protocols#endpoints).</span></span> |
| <span data-ttu-id="64ad5-203">client_id</span><span class="sxs-lookup"><span data-stu-id="64ad5-203">client_id</span></span>     | <span data-ttu-id="64ad5-204">обязательно</span><span class="sxs-lookup"><span data-stu-id="64ad5-204">required</span></span>              | <span data-ttu-id="64ad5-205">Идентификатор приложения, назначенный [порталом регистрации](https://go.microsoft.com/fwlink/?linkid=2083908) для приложения.</span><span class="sxs-lookup"><span data-stu-id="64ad5-205">The Application ID that the [registration portal](https://go.microsoft.com/fwlink/?linkid=2083908)) assigned your app.</span></span>                                                                                                                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="64ad5-206">grant_type</span><span class="sxs-lookup"><span data-stu-id="64ad5-206">grant_type</span></span>    | <span data-ttu-id="64ad5-207">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-207">required</span></span>              | <span data-ttu-id="64ad5-208">Должно быть задано значение `authorization_code` для потока кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="64ad5-208">Must be `authorization_code` for the authorization code flow.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="64ad5-209">scope</span><span class="sxs-lookup"><span data-stu-id="64ad5-209">scope</span></span>         | <span data-ttu-id="64ad5-210">обязательно</span><span class="sxs-lookup"><span data-stu-id="64ad5-210">required</span></span>              | <span data-ttu-id="64ad5-p118">Разделенный пробелами список областей.  Области, запрашиваемые на этом этапе, должны быть эквивалентны областям, запрашиваемым на первом этапе (во время авторизации), или представлять собой их подмножество.  Если указанные в этом запросе области относятся к нескольким серверам ресурсов, то конечная точка версии 2.0 возвращает маркер ресурсу, указанному в первой области.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p118">A space-separated list of scopes.  The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the first (authorization) leg.  If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.</span></span>                                                                                                                                                                      |
| <span data-ttu-id="64ad5-214">code</span><span class="sxs-lookup"><span data-stu-id="64ad5-214">code</span></span>          | <span data-ttu-id="64ad5-215">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-215">required</span></span>              | <span data-ttu-id="64ad5-216">Код авторизации, полученный на первом этапе потока.</span><span class="sxs-lookup"><span data-stu-id="64ad5-216">The authorization_code that you acquired in the first leg of the flow.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span data-ttu-id="64ad5-217">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="64ad5-217">redirect_uri</span></span>  | <span data-ttu-id="64ad5-218">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-218">required</span></span>              | <span data-ttu-id="64ad5-219">То же значение URI перенаправления, которое использовалось для получения кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="64ad5-219">The same redirect_uri value that was used to acquire the authorization_code.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="64ad5-220">client_secret</span><span class="sxs-lookup"><span data-stu-id="64ad5-220">client_secret</span></span> | <span data-ttu-id="64ad5-221">Обязательный для веб-приложений</span><span class="sxs-lookup"><span data-stu-id="64ad5-221">required for web apps</span></span> | <span data-ttu-id="64ad5-p119">Секрет приложения, созданный на портале регистрации приложений.  Его не следует использовать в нативном приложении, так как секреты клиентов невозможно безопасно хранить на устройствах.  Он необходим для веб-приложений и веб-API, которые могут безопасно хранить секрет клиента на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p119">The application secret that you created in the app registration portal for your app.  It should not be used in a native app, because client_secrets cannot be reliably stored on devices.  It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side.</span></span>                                                                                                                                                                                     |

### <a name="token-response"></a><span data-ttu-id="64ad5-225">Ответ с маркером</span><span class="sxs-lookup"><span data-stu-id="64ad5-225">Token response</span></span>

<span data-ttu-id="64ad5-226">Несмотря на то что маркер доступа непрозрачен для приложения, отклик содержит список разрешений, для которых подходит маркер, в параметре `scope`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-226">Although the access token is opaque to your app, the response contains a list of the permissions that the access token is good for in the `scope` parameter.</span></span>

```json
{
    "token_type": "Bearer",
    "scope": "user.read%20Fmail.read",
    "expires_in": 3600,
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "refresh_token": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4..."
}
```

| <span data-ttu-id="64ad5-227">Параметр</span><span class="sxs-lookup"><span data-stu-id="64ad5-227">Parameter</span></span>     | <span data-ttu-id="64ad5-228">Описание</span><span class="sxs-lookup"><span data-stu-id="64ad5-228">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                  |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="64ad5-229">token_type</span><span class="sxs-lookup"><span data-stu-id="64ad5-229">token_type</span></span>    | <span data-ttu-id="64ad5-p120">Указывает значение типа маркера. Единственный тип, поддерживаемый Azure AD, — носитель.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p120">Indicates the token type value. The only type that Azure AD supports is Bearer.</span></span>                                                                                                                                                                                                                                                                                                              |
| <span data-ttu-id="64ad5-232">область</span><span class="sxs-lookup"><span data-stu-id="64ad5-232">scope</span></span>         | <span data-ttu-id="64ad5-233">Разделенный пробелами список разрешений Microsoft Graph, для которых действителен маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="64ad5-233">A space separated list of the Microsoft Graph permissions that the access_token is valid for.</span></span>                                                                                                                                                                                                                                                                                                |
| <span data-ttu-id="64ad5-234">expires_in</span><span class="sxs-lookup"><span data-stu-id="64ad5-234">expires_in</span></span>    | <span data-ttu-id="64ad5-235">Срок действия маркера доступа (в секундах).</span><span class="sxs-lookup"><span data-stu-id="64ad5-235">How long the access token is valid (in seconds).</span></span>                                                                                                                                                                                                                                                                                                                                             |
| <span data-ttu-id="64ad5-236">access_token</span><span class="sxs-lookup"><span data-stu-id="64ad5-236">access_token</span></span>  | <span data-ttu-id="64ad5-p121">Запрашиваемый маркер доступа. С его помощью приложение может вызывать Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p121">The requested access token. Your app can use this token to call Microsoft Graph.</span></span>                                                                                                                                                                                                                                                                                                             |
| <span data-ttu-id="64ad5-239">refresh_token</span><span class="sxs-lookup"><span data-stu-id="64ad5-239">refresh_token</span></span> | <span data-ttu-id="64ad5-240">Маркер обновления OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="64ad5-240">An OAuth 2.0 refresh token.</span></span> <span data-ttu-id="64ad5-241">С его помощью приложение сможет запрашивать дополнительные маркеры доступа, когда истечет срок действия текущего.</span><span class="sxs-lookup"><span data-stu-id="64ad5-241">Your app can use this token to acquire additional access tokens after the current access token expires.</span></span>  <span data-ttu-id="64ad5-242">Маркеры обновления имеют большие сроки действия, и с их помощью можно сохранять доступ к ресурсам в течение длительного времени.</span><span class="sxs-lookup"><span data-stu-id="64ad5-242">Refresh tokens are long-lived, and can be used to retain access to resources for extended periods of time.</span></span>  <span data-ttu-id="64ad5-243">Дополнительные сведения см. в [справочнике по маркерам версии 2.0](/azure/active-directory/develop/active-directory-v2-tokens).</span><span class="sxs-lookup"><span data-stu-id="64ad5-243">For more detail, refer to the [v2.0 token reference](/azure/active-directory/develop/active-directory-v2-tokens).</span></span> |

## <a name="4-use-the-access-token-to-call-microsoft-graph"></a><span data-ttu-id="64ad5-244">4. Вызов Microsoft Graph с помощью маркера доступа</span><span class="sxs-lookup"><span data-stu-id="64ad5-244">4. Use the access token to call Microsoft Graph</span></span>

<span data-ttu-id="64ad5-p123">Получив маркер доступа, вы можете вызвать Microsoft Graph, включив его в заголовок `Authorization` запроса. Приведенный ниже запрос получает профиль вошедшего пользователя.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p123">After you have an access token, you can use it to call Microsoft Graph by including it in the `Authorization` header of a request. The following request gets the profile of the signed-in user.</span></span>

```
GET https://graph.microsoft.com/v1.0/me
Authorization: Bearer eyJ0eXAiO ... 0X2tnSQLEANnSPHY0gKcgw
Host: graph.microsoft.com

```

<span data-ttu-id="64ad5-247">Успешный ответ выглядит приблизительно следующим образом (некоторые заголовки были удалены).</span><span class="sxs-lookup"><span data-stu-id="64ad5-247">A successful response will look similar to the following (some response headers have been removed).</span></span>

```
HTTP/1.1 200 OK
Content-Type: application/json;odata.metadata=minimal;odata.streaming=true;IEEE754Compatible=false;charset=utf-8
request-id: f45d08c0-6901-473a-90f5-7867287de97f
client-request-id: f45d08c0-6901-473a-90f5-7867287de97f
OData-Version: 4.0
Duration: 727.0022
Date: Thu, 20 Apr 2017 05:21:18 GMT
Content-Length: 407

{
    "@odata.context":"https://graph.microsoft.com/v1.0/$metadata#users/$entity",
    "id":"12345678-73a6-4952-a53a-e9916737ff7f",
    "businessPhones":[
        "+1 555555555"
    ],
    "displayName":"Chris Green",
    "givenName":"Chris",
    "jobTitle":"Software Engineer",
    "mail":null,
    "mobilePhone":"+1 5555555555",
    "officeLocation":"Seattle Office",
    "preferredLanguage":null,
    "surname":"Green",
    "userPrincipalName":"ChrisG@contoso.onmicrosoft.com"
}
```

## <a name="5-use-the-refresh-token-to-get-a-new-access-token"></a><span data-ttu-id="64ad5-248">5. Получение нового маркера доступа с помощью маркера обновления</span><span class="sxs-lookup"><span data-stu-id="64ad5-248">5. Use the refresh token to get a new access token</span></span>

<span data-ttu-id="64ad5-p124">Маркеры доступа имеют короткие сроки действия, а по истечении этого срока их необходимо обновлять, чтобы сохранить доступ к ресурсам.  Для этого можно отправить еще один запрос `POST` конечной точке `/token`, на этот раз указав `refresh_token` вместо параметра `code`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p124">Access tokens are short lived, and you must refresh them after they expire to continue accessing resources.  You can do so by submitting another `POST` request to the `/token` endpoint, this time providing the `refresh_token` instead of the `code`.</span></span>

### <a name="request"></a><span data-ttu-id="64ad5-251">Запрос</span><span class="sxs-lookup"><span data-stu-id="64ad5-251">Request</span></span>

```
// Line breaks for legibility only

POST /common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&scope=user.read%20mail.read
&refresh_token=OAAABAAAAiL9Kn2Z27UubvWFPbm0gLWQJVzCTE9UkP3pSx1aXxUjq...
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&grant_type=refresh_token
&client_secret=JqQX2PNo9bpM0uEihUPzyrh      // NOTE: Only required for web apps
```

| <span data-ttu-id="64ad5-252">Параметр</span><span class="sxs-lookup"><span data-stu-id="64ad5-252">Parameter</span></span>     | <span data-ttu-id="64ad5-253">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-253">Required</span></span>              | <span data-ttu-id="64ad5-254">Описание</span><span class="sxs-lookup"><span data-stu-id="64ad5-254">Description</span></span>                                                                                                                                                                                                                                                                                                         |
|---------------|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="64ad5-255">client_id</span><span class="sxs-lookup"><span data-stu-id="64ad5-255">client_id</span></span>     | <span data-ttu-id="64ad5-256">обязательно</span><span class="sxs-lookup"><span data-stu-id="64ad5-256">required</span></span>              | <span data-ttu-id="64ad5-257">Идентификатор приложения, назначенный [порталом регистрации](https://go.microsoft.com/fwlink/?linkid=2083908) для приложения.</span><span class="sxs-lookup"><span data-stu-id="64ad5-257">The Application ID that the [registration portal](https://go.microsoft.com/fwlink/?linkid=2083908) assigned your app.</span></span>                                                                                                                                                                                               |
| <span data-ttu-id="64ad5-258">grant_type</span><span class="sxs-lookup"><span data-stu-id="64ad5-258">grant_type</span></span>    | <span data-ttu-id="64ad5-259">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-259">required</span></span>              | <span data-ttu-id="64ad5-260">Должно быть задано значение `refresh_token`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-260">Must be `refresh_token`.</span></span>                                                                                                                                                                                                                                                                                            |
| <span data-ttu-id="64ad5-261">scope</span><span class="sxs-lookup"><span data-stu-id="64ad5-261">scope</span></span>         | <span data-ttu-id="64ad5-262">обязательно</span><span class="sxs-lookup"><span data-stu-id="64ad5-262">required</span></span>              | <span data-ttu-id="64ad5-p125">Разделенный пробелами список разрешений (областей).  Запрашиваемые разрешения должны быть эквивалентны подмножеству разрешений, указанных в первоначальном запросе кода авторизации, или представлять собой их подмножество.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p125">A space-separated list of permissions (scopes).  The permissions requested must be equivalent to or a subset of the permissions requested in the original authorization_code request.</span></span>                                                                                                                               |
| <span data-ttu-id="64ad5-265">refresh_token</span><span class="sxs-lookup"><span data-stu-id="64ad5-265">refresh_token</span></span> | <span data-ttu-id="64ad5-266">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-266">required</span></span>              | <span data-ttu-id="64ad5-267">Маркер обновления, полученный с помощью запроса на получение маркера.</span><span class="sxs-lookup"><span data-stu-id="64ad5-267">The refresh_token that you acquired during the token request.</span></span>                                                                                                                                                                                                                                                       |
| <span data-ttu-id="64ad5-268">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="64ad5-268">redirect_uri</span></span>  | <span data-ttu-id="64ad5-269">Обязательный</span><span class="sxs-lookup"><span data-stu-id="64ad5-269">required</span></span>              | <span data-ttu-id="64ad5-270">То же значение URI перенаправления, которое использовалось для получения кода авторизации.</span><span class="sxs-lookup"><span data-stu-id="64ad5-270">The same redirect_uri value that was used to acquire the authorization_code.</span></span>                                                                                                                                                                                                                                        |
| <span data-ttu-id="64ad5-271">client_secret</span><span class="sxs-lookup"><span data-stu-id="64ad5-271">client_secret</span></span> | <span data-ttu-id="64ad5-272">Обязательный для веб-приложений</span><span class="sxs-lookup"><span data-stu-id="64ad5-272">required for web apps</span></span> | <span data-ttu-id="64ad5-p126">Секрет приложения, созданный на портале регистрации приложений.  Его не следует использовать в нативном приложении, так как секреты клиентов невозможно безопасно хранить на устройствах.  Он необходим для веб-приложений и веб-API, которые могут безопасно хранить секрет клиента на стороне сервера.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p126">The application secret that you created in the app registration portal for your app.  It should not be used in a native app, because client_secrets cannot be reliably stored on devices.  It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side.</span></span> |

### <a name="response"></a><span data-ttu-id="64ad5-276">Отклик</span><span class="sxs-lookup"><span data-stu-id="64ad5-276">Response</span></span>

<span data-ttu-id="64ad5-277">Успешный отклик с маркером будет выглядеть примерно так:</span><span class="sxs-lookup"><span data-stu-id="64ad5-277">A successful token response will look similar to the following.</span></span>

```
{
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "token_type": "Bearer",
    "expires_in": 3599,
    "scope": "user.read%20mail.read",
    "refresh_token": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4...",
}
```
| <span data-ttu-id="64ad5-278">Параметр</span><span class="sxs-lookup"><span data-stu-id="64ad5-278">Parameter</span></span>     | <span data-ttu-id="64ad5-279">Описание</span><span class="sxs-lookup"><span data-stu-id="64ad5-279">Description</span></span>                                                                                                                                                                        |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="64ad5-280">access_token</span><span class="sxs-lookup"><span data-stu-id="64ad5-280">access_token</span></span>  | <span data-ttu-id="64ad5-p127">Запрашиваемый маркер доступа. Приложение может использовать его в вызовах Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p127">The requested access token. The app can use this token in calls to Microsoft Graph.</span></span>                                                                                                |
| <span data-ttu-id="64ad5-283">token_type</span><span class="sxs-lookup"><span data-stu-id="64ad5-283">token_type</span></span>    | <span data-ttu-id="64ad5-p128">Указывает значение типа маркера. Единственный тип, поддерживаемый Azure AD, — носитель.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p128">Indicates the token type value. The only type that Azure AD supports is Bearer</span></span>                                                                                                     |
| <span data-ttu-id="64ad5-286">expires_in</span><span class="sxs-lookup"><span data-stu-id="64ad5-286">expires_in</span></span>    | <span data-ttu-id="64ad5-287">Срок действия маркера доступа (в секундах).</span><span class="sxs-lookup"><span data-stu-id="64ad5-287">How long the access token is valid (in seconds).</span></span>                                                                                                                                   |
| <span data-ttu-id="64ad5-288">scope</span><span class="sxs-lookup"><span data-stu-id="64ad5-288">scope</span></span>         | <span data-ttu-id="64ad5-289">Разрешения (области), для которых действителен маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="64ad5-289">The permissions (scopes) that the access_token is valid for.</span></span>                                                                                                                       |
| <span data-ttu-id="64ad5-290">refresh_token</span><span class="sxs-lookup"><span data-stu-id="64ad5-290">refresh_token</span></span> | <span data-ttu-id="64ad5-p129">Новый маркер обновления OAuth 2.0. Старый маркер обновления следует заменить на новый, чтобы гарантировать, что он останется действительным как можно дольше.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p129">A new OAuth 2.0 refresh token. You should replace the old refresh token with this newly acquired refresh token to ensure your refresh tokens remain valid for as long as possible.</span></span> |

## <a name="supported-app-scenarios-and-additional-resources"></a><span data-ttu-id="64ad5-293">Поддерживаемые сценарии приложений и дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="64ad5-293">Supported app scenarios and additional resources</span></span>

<span data-ttu-id="64ad5-294">Вы можете вызывать Microsoft Graph от имени пользователя из приложений следующих типов:</span><span class="sxs-lookup"><span data-stu-id="64ad5-294">You can call Microsoft Graph on behalf of a user from the following kinds of apps:</span></span>

- [<span data-ttu-id="64ad5-295">Нативные или мобильные приложения</span><span class="sxs-lookup"><span data-stu-id="64ad5-295">Native/Mobile apps</span></span>](/azure/active-directory/develop/scenario-mobile-overview)
- [<span data-ttu-id="64ad5-296">Веб-приложения</span><span class="sxs-lookup"><span data-stu-id="64ad5-296">Web apps</span></span>](/azure/active-directory/develop/scenario-web-app-call-api-overview)
- [<span data-ttu-id="64ad5-297">Одностраничные приложения (SPA)</span><span class="sxs-lookup"><span data-stu-id="64ad5-297">Single page apps (SPA)</span></span>](/azure/active-directory/develop/scenario-spa-overview)
- <span data-ttu-id="64ad5-298">[Внутренние веб-API](/azure/active-directory/develop/scenario-web-app-call-api-overview) (к примеру, когда клиентское приложение, например нативное, реализует функции в серверной части веб-API).</span><span class="sxs-lookup"><span data-stu-id="64ad5-298">[Back-end Web APIs](/azure/active-directory/develop/scenario-web-app-call-api-overview): For example, in scenarios where a client app, like a native app, implements functionality in a Web API back end.</span></span> <span data-ttu-id="64ad5-299">При использовании конечной точки платформы удостоверений Майкрософт у клиентского приложения и внутреннего веб-API должны быть одинаковые идентификаторы приложения.</span><span class="sxs-lookup"><span data-stu-id="64ad5-299">With the Microsoft identity platform endpoint, both the client app and the back-end Web API must have the same Application ID.</span></span>

<span data-ttu-id="64ad5-300">Дополнительные сведения о поддерживаемых сценариях приложений с конечной точкой платформы удостоверений Майкрософт см. в статье [Сценарии приложений и потоки проверки подлинности](/azure/active-directory/develop/authentication-flows-app-scenarios).</span><span class="sxs-lookup"><span data-stu-id="64ad5-300">For more information about supported app scenarios with the Microsoft identity platform endpoint, see [App scenarios and authentication flows](/azure/active-directory/develop/authentication-flows-app-scenarios).</span></span>

> <span data-ttu-id="64ad5-301">**Примечание**. Вызов Microsoft Graph из отдельного веб-API в настоящее время не поддерживается конечной точкой платформы удостоверений Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="64ad5-301">**Note**: Calling Microsoft Graph from a standalone web API is not currently supported by the Microsoft identity platform endpoint.</span></span> <span data-ttu-id="64ad5-302">Для этого сценария необходимо использовать конечную точку Azure AD.</span><span class="sxs-lookup"><span data-stu-id="64ad5-302">For this scenario, you need to use the Azure AD endpoint.</span></span>

<span data-ttu-id="64ad5-303">Дополнительные сведения о получении доступа к Microsoft Graph от имени пользователя из конечной точки платформы удостоверений Майкрософт:</span><span class="sxs-lookup"><span data-stu-id="64ad5-303">For more information about getting access to Microsoft Graph on behalf of a user from the Microsoft identity platform endpoint:</span></span>

- <span data-ttu-id="64ad5-304">Ссылки на документацию по протоколам и руководства по началу работы для различных типов приложений см. в [документации по конечным точкам платформы удостоверений Майкрософт](/azure/active-directory/develop/active-directory-appmodel-v2-overview).</span><span class="sxs-lookup"><span data-stu-id="64ad5-304">For links to protocol documentation and getting started articles for different kinds of apps, see the [Microsoft identity platform endpoint documentation](/azure/active-directory/develop/active-directory-appmodel-v2-overview).</span></span>
- <span data-ttu-id="64ad5-305">Дополнительные сведения о поддерживаемых типах приложений и потоках проверки подлинности см. в статье [Типы приложений версии 2.0](/azure/active-directory/develop/v2-app-types).</span><span class="sxs-lookup"><span data-stu-id="64ad5-305">For detailed explanations of supported application types and authentication flows, see [v2.0 app types](/azure/active-directory/develop/v2-app-types).</span></span>
- <span data-ttu-id="64ad5-306">Дополнительные сведения о рекомендуемых библиотеках проверки подлинности и серверном ПО промежуточного слоя (как от корпорации Майкрософт, так и от сторонних разработчиков) для платформы удостоверений Майкрософт см. в статье [Библиотеки проверки подлинности Azure Active Directory версии 2.0](/azure/active-directory/develop/active-directory-v2-libraries).</span><span class="sxs-lookup"><span data-stu-id="64ad5-306">For more information about recommended Microsoft and third-party authentication libraries and server middleware for the Microsoft identity platform, see [Azure Active Directory v2.0 authentication libraries](/azure/active-directory/develop/active-directory-v2-libraries).</span></span>

## <a name="endpoint-considerations"></a><span data-ttu-id="64ad5-307">Рекомендации, связанные с конечной точкой</span><span class="sxs-lookup"><span data-stu-id="64ad5-307">Endpoint considerations</span></span>

<span data-ttu-id="64ad5-308">Корпорация Майкрософт продолжает поддерживать конечную точку Azure AD.</span><span class="sxs-lookup"><span data-stu-id="64ad5-308">Microsoft continues to support the Azure AD endpoint.</span></span> <span data-ttu-id="64ad5-309">Существует [ряд отличий](/azure/active-directory/develop/azure-ad-endpoint-comparison) между конечной точкой платформы удостоверений Майкрософт и конечной точкой Azure AD.</span><span class="sxs-lookup"><span data-stu-id="64ad5-309">There are [several differences](/azure/active-directory/develop/azure-ad-endpoint-comparison) between using the Microsoft identity platform endpoint and the Azure AD endpoint.</span></span> <span data-ttu-id="64ad5-310">При использовании конечной точки Azure AD:</span><span class="sxs-lookup"><span data-stu-id="64ad5-310">When using the Azure AD endpoint:</span></span>

- <span data-ttu-id="64ad5-311">Для каждой платформы приложению потребуется отдельный идентификатор (идентификатор клиента).</span><span class="sxs-lookup"><span data-stu-id="64ad5-311">Your app will require a different application ID (client ID) for each platform.</span></span>
- <span data-ttu-id="64ad5-312">Если приложение поддерживается несколькими клиентами, необходимо в явной форме настроить его в таком качестве на [портале Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="64ad5-312">If your app is a multi-tenant app, you must explicitly configure it to be multi-tenant at the [Azure portal](https://portal.azure.com).</span></span>
- <span data-ttu-id="64ad5-313">Все разрешения, необходимые приложению, должен настроить разработчик.</span><span class="sxs-lookup"><span data-stu-id="64ad5-313">All permissions that your app needs must be configured by the developer.</span></span> <span data-ttu-id="64ad5-314">Конечная точка Azure AD не поддерживает динамическое (добавочное) согласие.</span><span class="sxs-lookup"><span data-stu-id="64ad5-314">The Azure AD endpoint does not support dynamic (incremental) consent.</span></span>
- <span data-ttu-id="64ad5-p134">Конечная точка Azure AD использует параметр `resource` при авторизации и в запросах на получение маркеров, чтобы указать ресурс (например, Microsoft Graph), для которого требуются разрешения. Конечная точка не поддерживает параметр `scope`.</span><span class="sxs-lookup"><span data-stu-id="64ad5-p134">The Azure AD endpoint uses a `resource` parameter in authorization and token requests to specify the resource, such as Microsoft Graph, for which it wants permissions. The endpoint does not support the `scope` parameter.</span></span>
- <span data-ttu-id="64ad5-p135">Конечная точка Azure AD не предоставляет отдельную конечную точку для согласия администратора. Вместо этого приложения используют параметр `prompt=admin_consent` в запросе на авторизацию, чтобы получить согласие администратора для организации. Дополнительные сведения см. в разделе **Активация инфраструктуры согласия Azure AD во время выполнения** статьи [Интеграция приложений с Azure Active Directory](/azure/active-directory/develop/active-directory-integrating-applications).</span><span class="sxs-lookup"><span data-stu-id="64ad5-p135">The Azure AD endpoint does not expose a specific endpoint for administrator consent. Instead apps use the `prompt=admin_consent` parameter in the authorization request to obtain administrator consent for an organization. For more information, see **Triggering the Azure AD consent framework at runtime** in [Integrating applications with Azure Active Directory](/azure/active-directory/develop/active-directory-integrating-applications).</span></span>

<span data-ttu-id="64ad5-320">Дополнительные сведения о получении доступа к Microsoft Graph от имени пользователя из конечной точки Azure AD:</span><span class="sxs-lookup"><span data-stu-id="64ad5-320">For more information about getting access to Microsoft Graph on behalf of a user from the Azure AD endpoint:</span></span>

- <span data-ttu-id="64ad5-321">Дополнительные сведения об использовании конечной точки платформы удостоверений Майкрософт для различных типов приложений см. по ссылкам **Начало работы** в [документации для разработчиков по платформе удостоверений Майкрософт](/azure/active-directory/develop/active-directory-developers-guide).</span><span class="sxs-lookup"><span data-stu-id="64ad5-321">For information about using the Microsoft identity platform endpoint with different kinds of apps, see the **Get Started** links in the [Microsoft identity platform developer documentation](/azure/active-directory/develop/active-directory-developers-guide).</span></span> <span data-ttu-id="64ad5-322">Документация содержит ссылки на обзорные статьи, краткие руководства, учебники, примеры кода и документацию по протоколам для различных типов приложений, поддерживаемых конечной точкой платформы удостоверений Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="64ad5-322">The documentation contains links to overview topics, quickstarts, tutorials, code samples and protocol documentation for different kinds of apps supported by the Microsoft identity platform endpoint.</span></span>
- <span data-ttu-id="64ad5-323">Сведения о библиотеке проверки подлинности Майкрософт (MSAL) и серверном ПО промежуточного слоя, доступном для использования с конечной точкой платформы удостоверений Майкрософт, см. в статье [Библиотеки проверки подлинности Майкрософт](/azure/active-directory/develop/msal-overview).</span><span class="sxs-lookup"><span data-stu-id="64ad5-323">For information about the Microsoft Authentication Library (MSAL) and server middleware available for use with the Microsoft identity platform endpoint, see [Microsoft Authentication Libraries](/azure/active-directory/develop/msal-overview).</span></span>

## <a name="see-also"></a><span data-ttu-id="64ad5-324">См. также</span><span class="sxs-lookup"><span data-stu-id="64ad5-324">See also</span></span>

<span data-ttu-id="64ad5-325">Пример веб-приложения, размещаемого в службе приложений Azure, которое вызывает Microsoft Graph в качестве приложения (с помощью управляемых удостоверений), см. в разделе [Учебник. Доступ к Microsoft Graph из защищенного приложения](/azure/app-service/scenario-secure-app-access-microsoft-graph-as-app).</span><span class="sxs-lookup"><span data-stu-id="64ad5-325">For an example of a web app hosted on Azure App Service calling Microsoft Graph as the app (using managed identities), see [Tutorial: Access Microsoft Graph from a secured app as the app](/azure/app-service/scenario-secure-app-access-microsoft-graph-as-app).</span></span> <span data-ttu-id="64ad5-326">В этом руководстве показано, как создать в веб-приложении управляемое удостоверение, назначенное системой, добавить разрешения API Microsoft Graph к управляемому удостоверению и вызвать Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="64ad5-326">This tutorial shows you how to create a system-assigned managed identity on a web app, add Microsoft Graph API permissions to a managed identity, and call Microsoft Graph.</span></span>
